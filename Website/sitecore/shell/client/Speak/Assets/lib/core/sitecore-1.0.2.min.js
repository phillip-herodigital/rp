/*! SPEAK.js, 1.0.2 - generated on 2014-02-13 */
!function(){for(var a,b=function(){},c=["assert","clear","count","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","table","time","timeEnd","timeStamp","trace","warn"],d=c.length,e=window.console=window.console||{};d--;)a=c[d],e[a]||(e[a]=b)}(),function(){"use strict";var a,b,c,d,e,f,g,h=this,i=h.Sitecore,j=h.__SITECOREDEBUG||!1,k={},l=window._sc;b=a="undefined"!=typeof exports?exports:h.Sitecore=h._sc={};var m=h.jQuery,n=h._,o=h.ko;n||"undefined"==typeof require||(n=require("underscore")),Backbone||"undefined"==typeof require||(n=require("backbone")),o||"undefined"==typeof require||(o=require("knockout")),b.VERSION="1.0.1",b.__SITECOREDEBUG=j,b.__info=k,b.Pipelines={},b.Factories={},b.Commands={},b.Behaviors={},b.Definitions={Models:{},Views:{},Data:{}},c=b.Definitions.Models,d=b.Definitions.Views,e=b.Definitions.Data,f=b.Commands,g=b.Factories,b.Web={},b.SiteInfo={},b.SiteInfo.virtualFolder="/",b.debug=function(){if(j){switch(arguments.length){case 1:return void console.log(arguments[0]);case 2:return void console.log(arguments[0],arguments[1]);case 3:console.log(arguments[0],arguments[1],arguments[2]);case 4:return void console.log(arguments[0],arguments[1],arguments[2],arguments[3])}console.log(arguments)}};var p=function(a,b){var c=new o.bindingProvider,d=c.nodeHasBindings;return c.exclusionSelector=a,c.nodeHasBindings=function(a){return 8===a.nodeType||m(a).is(c.exclusionSelector)||0!==m(a).closest(b).length?8!==a.nodeType||a.registered?!1:d.call(this,a):d.call(this,a)},c};o.bindingProvider.instance=new p(".data-sc-registered",".data-sc-waiting"),o.bindingHandlers.readonly={update:function(a,b){var c=o.utils.unwrapObservable(b());c?a.setAttribute("readOnly",!0):a.removeAttribute("readOnly")}},h.dialogClose=function(a){b.trigger("sc-frame-message",a)},h.receiveMessage=function(a,c){b.trigger("sc-frame-message",a,c)},h.getParameterByName=function(a){return a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"),regexS="[\\?&]"+a+"=([^&#]*)",regex=new RegExp(regexS),results=regex.exec(window.location.href),null==results?"":decodeURIComponent(results[1].replace(/\+/g," "))},function(a){a.Model.extend=a.Collection.extend=a.Router.extend=a.View.extend=function(a,b){var d=c(this,a,b);return d.extend=this.extend,d};var b=function(){},c=function(c,d,e){var f,g=c.prototype,h=/xyz/.test(function(){})?/\b_super\b/:/.*/;if(f=d&&d.hasOwnProperty("constructor")?d.constructor:function(){c.apply(this,arguments)},n.extend(f,c),b.prototype=c.prototype,f.prototype=new b,d){n.extend(f.prototype,d);var i=d.nestedlayout||f.prototype.nestedlayout,j=f.prototype.modelType===a.Model;j||d.render||i||(d.render=function(){}),j||d.afterRender||i||(d.afterRender=function(){}),j||d.beforeRender||i||(d.beforeRender=function(){});for(var k in d)"function"==typeof d[k]&&"function"==typeof g[k]&&h.test(d[k])&&(f.prototype[k]=function(a,b){return function(){var c=this._super;this._super=g[a];var d=b.apply(this,arguments);return this._super=c,d}}(k,d[k])),i||j||"render"!==k&&"beforeRender"!==k&&"afterRender"!==k||(f.prototype[k]=function(a,b){return function(){if(b.apply(this,arguments),this.hasBehavior){var c=[];"render"===a&&(c=this.behaviorsRender),"afterRender"===a&&(c=this.behaviorsAfterRender),"beforeRender"===a&&(c=this.behaviorsBeforeRender),n.each(c,function(a){a.apply(this,arguments)},this)}}}(k,d[k]))}return e&&n.extend(f,e),f.prototype.constructor=f,f.__super__=c.prototype,f}}(Backbone),c.Model=Backbone.Model.extend({ko:!0,modelType:Backbone.Model,set:function(){var a=arguments[2];arguments[2]||(arguments[2]={});var b=(n.clone(arguments[2].silent),arguments[2].force);if(Backbone.Model.prototype.set.apply(this,arguments),a&&a.computed&&(this.computed=this.computed||{},this.computed[arguments[0]]=a),n.isObject(arguments[0])||a&&a.local||this.updateViewModel(arguments[0],b),n.isObject(arguments[0])&&(!a||!a.local)){var c=arguments[0],d=n.keys(c);n.each(d,function(a){this.updateViewModel(a)},this)}},constructor:function(b){this.ko&&(this.viewModel={}),this.defaults&&b&&n.isObject(b)&&(this.defaults=n.extend(this.defaults,b)),this.ko&&this.defaults&&(this._removeComputed(),this._creatingViewModelFromDefaults()),this.useLocalStorage&&(this.localStorage=new a.Definitions.Data.LocalStorage(b.name)),Backbone.Model.apply(this,[b]),this.ko&&(this._setComputed(),this._preventDefaultFunction(),this._creatingViewModel())},_preventDefaultFunction:function(){var a=["_creatingViewModel","_creatingViewModelFromDefaults","_setComputed","_findAppropriateAndApplyBinding","_removeComputed","_super","_preventDefaultFunction","_validate","bind","change","changedAttributes","clear","clone","constructor","destroy","escape","fetch","get","has","hasChanged","initialize","isNew","isValid","observable","off","on","parse","previous","previousAttributes","save","set","toJSON","trigger","unbind","unset","url"],b=n.functions(this);this.applicableFunctionsFromModel=n.reject(b,function(b){return n.indexOf(a,b)>=0})},_creatingViewModelFromDefaults:function(){var a=this,b=n.keys(this.defaults);n.each(b,function(a){this._findAppropriateAndApplyBinding(a,this.defaults)},this);var c={};this.applicableFunctionsFromModel&&n.each(this.applicableFunctionsFromModel,function(b){c[b]=function(){a[b].apply(a,arguments)}}),n.extend(this.viewModel,c)},_removeComputed:function(){var a=n.keys(this.defaults),b=this.defaults,c=this,d=[];n.each(a,function(a){var c=b[a];if(n.isObject(c)&&c.computed){var e=n.clone(c),f={computed:!0,read:e.read};e.write&&(f=n.extend(f,{write:e.write})),e.owner&&(f=n.extend(f,{owner:e.owner})),d.push({key:a,value:e.value,computed:f}),delete b[a]}}),c.computeds=d},_setComputed:function(){n.each(this.computeds,function(a){var b=a.value||"",c=n.extend(a.computed,{local:!0});this.set(a.key,b,a.computed,c)},this)},updateViewModel:function(a,b){(this.viewModel&&!this.viewModel[a]||b)&&this._findAppropriateAndApplyBinding(a,this.attributes,b)},_findAppropriateAndApplyBinding:function(a,b,c){var d=this.viewModel||{};if(!d[a]||c){if(n.isArray(b[a]))if(b[a].length>0&&b[a][0]&&b[a][0].modelType===Backbone.Model){var e=[];n.each(b[a],function(a){e.push(a.viewModel)}),d[a]=o.observableArray(e),d[a].nested=!0}else d[a]=o.observableArray(b[a]);else b[a]&&b[a].constructor&&n.isObject(b[a].constructor.__super__)&&b[a].ko?(d[a]=b[a].viewModel,d[a].nested=!0):this.computed&&this.computed[a]||(d[a]=o.observable(b[a]));this._registerComputed(a),this._registerSubscribe(a)}},_registerSubscribe:function(a){var b=this,c=this.subscriptions||[],d=this.viewModel||{};d[a].nested||(d[a].isComputed||b.on("change:"+a,function(){if(n.isArray(b.get(a))&&b.get(a).length>0&&b.get(a)[0]&&b.get(a)[0].modelType&&b.get(a)[0].modelType===Backbone.Model){var c=[];n.each(b.get(a),function(a){c.push(a.viewModel)}),d[a](c)}else d[a](b.get(a))}),d[a].subscribe&&(c[a]=d[a].subscribe(function(c){b.set(a,c)})))},_registerComputed:function(a){var b=this,c=this.viewModel||{};if(b.computed&&b.computed[a]){this.computed[a].write&&!this.computed[a].owner&&(b.computed[a].owner=this.viewModel);var d=n.pick(b.computed[a],"write","owner","read");c[a]=d.write?o.computed(d):o.computed(d.read,this.viewModel),c[a].isComputed=!0}},_creatingViewModel:function(){var a=n.keys(this.attributes);n.each(a,function(a){this._findAppropriateAndApplyBinding(a,this.attributes)},this),n.each(a,this._registerComputed,this),n.each(a,this._registerSubscribe,this)}}),c.Model.extend=Backbone.Model.extend,d.View=function(b){b&&(this.app=b.app?b.app:"No parent for this app",delete b.app);var c=this;b&&b.behaviors&&n.each(b.behaviors.split(" "),function(b){c.addBehavior(a.Behaviors[b])}),Backbone.View.apply(this,[b]),this.model&&this.$el&&!this.model.viewModel.$el&&(this.model.viewModel.$el=this.$el),this.model&&this.app&&!this.model.viewModel.app&&(this.model.viewModel.app=this.app),this.setupFunctionWhichCouldBeDataBound(),this.sync()},n.extend(a.Definitions.Views.View.prototype,Backbone.View.prototype,{setupFunctionWhichCouldBeDataBound:function(){var a=["$","_configure","_ensureElement","setupFunctionWhichCouldBeDataBound","applyBindingsIfApplicable","bind","constructor","delegateEvents","initialize","make","off","on","remove","render","setElement","trigger","unbind","undelegateEvents","afterRender","beforeRender","sync"],b=n.functions(this);this.applicableFunctionsFromView=n.reject(b,function(b){return n.indexOf(a,b)>=0});var c=this;n.each(this.applicableFunctionsFromView,function(a){if(this.model&&this.model.viewModel[a])throw"Conflicted names between Model and View, please provide different names: "+a;this.model&&(this.model.viewModel[a]=function(){return c[a].apply(c,arguments)})},this)},sync:function(){this.model&&this.model.ko&&(j&&console.log("Applying Binding for the element which has the data-sc-id: "+this.$el.data("sc-id")+". The viewModel you are trying to apply is:",this.model.viewModel),o.applyBindings(this.model.viewModel?this.model.viewModel:this.model,this.$el.get(0)))},listen:{}}),d.View.extend=Backbone.View.extend,a.Definitions.App=Backbone.Model.extend({appId:void 0,modelType:"application",initialize:function(){this.Controls=[],this.localStorage=this.appId?new a.Definitions.Data.LocalStorage(this.appId):"you need to provide a appID in order to use localStorage"},run:function(a,c,d){var e=b.Factories.createApp(a,c,d,this);return"undefined"!=typeof this.initialized&&this.initialized(),e.trigger("app:loaded"),e},insertControl:function(a,b,c){var d=this;m.post("/api/rendering",a,function(a){d.insertMarkups(a,name,b,c)})},insertRendering:function(a,b,c){var d,e,f=this,g={database:"core",path:"/"},c=c;n.isFunction(b)?c=b:b&&(g=n.extend(g,b),d=b.selector?b.selector:void 0,e=b.$el?b.$el:void 0),g.name||(g.name=n.uniqueId("subapp_")),m.get(g.path+"?sc_itemid="+a+"&sc_database="+g.database,function(a){f.insertMarkups(a,g.name,{selector:d,$el:e},c)})},insertMarkups:function(a,c,d,e){var f,g={prepend:!1,selector:void 0,parent:void 0,$el:void 0},d=n.extend(g,d),h="<div id='"+c+"' data-sc-app style='display:none;'>"+a+"</div>";f=d.$el?d.$el:m(d.selector?d.selector:"body"),d.prepend?f.prepend(h):f.append(h),b.load(window,f.find("#"+c),function(a){a.ScopedEl.show(),e&&e(a)})},destroy:function(){var b=this;n.each(b.Controls,function(a){a.view.$el.data("sc-app",null),a.view.$el.removeClass("data-sc-registered")});for(var c in b)b[c]instanceof a.Definitions.App&&n.each(b[c].Controls,function(a){a.view.$el.data("sc-app",null),a.view.$el.removeClass("data-sc-registered")});n.each(b.Controls,function(a){o.cleanNode(a.view.$el.get(0)),delete a.model,delete a.view});for(var c in b)delete b[c];return void 0},closeDialog:function(a){window.top.returnValue=a,window.top.dialogClose(a)},sendMessage:function(a){window.top.receiveMessage(a,h.getParameterByName("sp"))}}),a.Definitions.App.extend=Backbone.View.extend,n.extend(a,Backbone.Events),n.extend(d.View.prototype,{addBehavior:function(a){if(this.hasBehavior=!0,this.behaviors=this.behaviors||[],this.behaviorsBeforeRender=this.behaviorsBeforeRender||[],this.behaviorsAfterRender=this.behaviorsAfterRender||[],this.behaviorsRender=this.behaviorsRender||[],!(a.initialize||a.afterRender||a.render||a.beforeRender))throw"behavior should have an initialize or an after Render method";a.events&&(this.events?n.extend(this.events,a.events):this.events=a.events),a.initialize&&this.behaviors.push(a.initialize),a.afterRender&&this.behaviorsAfterRender.push(a.afterRender),a.render&&this.behaviorsRender.push(a.render),a.beforeRender&&this.behaviorsBeforeRender.push(a.beforeRender);var b=n.omit(a,"initialize","events","afterRender","render","beforeRender");n.extend(this,b)}}),n.extend(b,{destroy:function(b){if(!b&&!b.destroy)throw"you need an app to be destroy";var c=b.name;b.destroy(),delete a[c]},noConflict:function(b){return h._sc===a&&(h._sc=l),b&&h.Sitecore===a&&(h.Sitecore=i),a}}),n.extend(b,{load:function(c,d,e){var f=[],g=!1;d||(d=m("html"),g=!0),m(d).find("[data-sc-require]").each(function(){var a=m(this);a.is("[data-sc-app]")||m.each(a.data("sc-require").split(","),function(a,b){n.indexOf(f,b)<0&&f.push(b)})});var h=[],i=c.__sc_define;c.__sc_define=function(a,b,c){"string"==typeof a&&h.push(a),i&&i(a,b,c)},m(d).find("script[type='text/x-sitecore-pagescript']").each(function(){c.__sc_define(m(this).attr("src"))}),require(f,function(){var f=m(d).find("script[type='text/x-sitecore-pagecode']"),j=m(d),k=f.attr("src"),l=f.data("sc-behaviors"),n=null;j.attr("data-sc-behaviors",l);var o=function(){if(0==h.length){c.__sc_define=i;var a=new n;e?e(a.run(d.attr("id"),d.attr("id"))):a.run(),g&&b.Helpers.overlay.loadOverlays(a)}else{var f=h;h=[],b.debug("Requiring files: ",f),require(f,o)}},p=function(){if(0===h.length)if(k)b.debug("Requiring page code: ",[k]),require([k],function(a){n=a,o()});else{c.__sc_define=i;var f;f=g?a.Factories.createApp():a.Factories.createApp(d.attr("id"),d.attr("id")),g&&(b.Helpers.overlay.loadOverlays(f),"undefined"!=typeof f.initialized&&f.initialized(),f.trigger("app:loaded")),e&&e(f)}else{var j=h;h=[],b.debug("Requiring files: ",j),require(j,p)}};p()})}}),n.extend(f,{resolve:function(a){if(!n.isString(a))throw"provied a correct Path to resolve";for(var b=a.split("."),c=h||window,d=0;d<b.length;d++)if(c=c[b[d]],null==c)throw"Reference '"+a+"' not found";return c},executeCommand:function(a,b){if(!a||!n.isString(a))throw"cannot execute command without commandName";var c=f.getCommand(a);c.canExecute(b)&&c.execute(b)},getCommand:function(a){return f.resolve(a)}});var q=function(){var a=this._scAttrs;n.each(a,function(a){if(a.value&&-1!==a.value.indexOf("$el.")){var b=a.value.substring("$el.".length);if(-1!==b.indexOf(":")){var c=b.split(":");if(2===c.length){var d=this.$el[c[0]](c[1]);"undefined"!=typeof d?this.model.set(a.name,d):a.defaultValue&&this.model.set(a.name,a.defaultValue)}}else this.model.set(a.name,this.$el[b]())}},this),n.each(a,function(a){a.on&&this.model.on("change:"+a.name,this[a.on],this)},this)},r=function(){this._scAttrs&&n.each(this._scAttrs,function(a){var b=n.keys(a),c=this.localStorage.get(a.name);c?this.set(a.name,c):-1===b.indexOf("defaultValue")&&a.value&&-1!==a.value.indexOf("$el.")?this.set(a.name,null):-1===b.indexOf("defaultValue")&&-1===a.value.indexOf("$el.")?this.set(a.name,a.value):b.indexOf("defaultValue")>-1?this.set(a.name,a.defaultValue):this.set(a.name,void 0)},this)},s=function(){this._scAttrs&&n.each(this._scAttrs,function(a){var b=n.keys(a);-1===n.indexOf(b,"defaultValue")&&a.value&&-1!==a.value.indexOf("$el.")?this.set(a.name,null):-1===n.indexOf(b,"defaultValue")&&-1===a.value.indexOf("$el.")?this.set(a.name,a.value):n.indexOf(b,"defaultValue")>-1?this.set(a.name,a.defaultValue):this.set(a.name,void 0)},this)},t=function(a){var b=a;return function(){b.prototype.set.apply(this,arguments);var a=arguments[2];if(n.isObject(arguments[0])&&(!a||!a.local)){var c=arguments[0],d=n.keys(c);n.each(d,function(a){this.localStorage.set(a,c[a])},this)}n.isObject(arguments[0])||a&&a.computed||this.localStorage.set(arguments[0],arguments[1])}};n.extend(g,{createBehavior:function(a,c){if(b.Behaviors=b.Behaviors||{},b.Behaviors[a])throw"There is already a behavior with the same name";return b.Behaviors[a]=c,b.Behaviors[a]},createBaseComponent:function(a){if(!a.name||!a.selector)throw"provide a name and/or a selector";var e,f,g=a.name,h=a.selector,i=a.attributes,j=a.initialize,k=a.base,l=["attributes","name","selector","base","plugin","initialize","listenTo","_scInitFromObject","extendModel","_scInit","_scInitDefaultValue"],m=n.omit(a,l),o=c.Model,p=d.View,u=a.localStorage,v=a.extendModel||{},w=a.collection;k&&(e=n.find(b.Components,function(a){return a.type===k})),e&&(o=e.model,p=e.view);var x;u?(v=n.extend(v,{initialize:function(){this._super(),this._scInitDefaultValueFromLocalStorage()},set:t(o)},{useLocalStorage:!0}),x=o.extend(v)):(v=n.extend(v,{initialize:function(){this._super(),this._scInitDefaultValue()}}),x=o.extend(v));var y=p.extend({initialize:function(){b.debug("initialize - "+g),this._super(),this.model.componentName==g&&(this._scInitFromObject?(this._scInit(),this._scInitFromObject()):this._scInit())}});if(x=x.extend({_scAttrs:i,_scInitDefaultValue:s,_scInitDefaultValueFromLocalStorage:r}),f=n.extend(m,{_scAttrs:i,_scInit:q,_scInitFromObject:j}),a.listenTo){var z={},A=p.prototype.listen,B=a.listenTo,C=n.keys(B);n.each(C,function(a){z[a+":$this"]=B[a]}),z=n.extend(A,z),y=n.extend(y,z)}var D;return w&&(D=Backbone.Collection.extend({model:w})),y=y.extend(f),b.Factories.createComponent(g,x,y,h,D)},createComponent:function(a,c,d,e,f){var g;if(!(n.isString(a)&&c&&d&&n.isString(e)))throw"please provide a correct: type (str), model, view and el (html class or id)";return b.Components=b.Components||[],b.Definitions.Models[a]=c,b.Definitions.Views[a]=d,f&&(b.Definitions.Collections[a]=f),n.each(b.Components,function(a){if(a.el===e)throw"you are trying to add compoment with the same el (.class or #id)"}),g={type:a,model:c,view:d,el:e,collection:f},b.Components.push(g),g},createApp:function(a,c,d,e){var f={};return n.isObject(a)?(f=a,b.Pipelines.Application.execute(f),f.current):(f.name=a,f.id=c,f.mainApp=d,f.app=e,f.aborted=!1,b.Pipelines.Application.execute(f),f.current)},createPageCode:function(a,c){var d;return d=b.Definitions.App.extend(c),d=d.extend({appId:a})},createBindingConverter:function(a){if(!a.name||!a.convert)throw"invalid binding converter";if(b.BindingConverters&&b.BindingConverters[a.name])throw"already a converter with the same name";b.BindingConverters=b.BindingConverters||{},b.BindingConverters[a.name]=a.convert}}),c.ComponentModel=c.Model.extend({initialize:function(){}}),c.ControlModel=c.ComponentModel.extend({initialize:function(){this._super(),this.set("isVisible",!0)},toggle:function(){this.set("isVisible",!this.get("isVisible"))}}),c.BlockModel=c.ControlModel.extend({initialize:function(){this._super(),this.set("width",0),this.set("height",0)}}),c.InputModel=c.ControlModel.extend({initialize:function(){this._super(),this.set("isEnabled",!0)}}),c.ButtonBaseModel=c.ControlModel.extend({initialize:function(){this._super(),this.set("isEnabled",!0)}});var u=a.Definitions.Views;u.ComponentView=u.View.extend({listen:n.extend({},a.Definitions.Views.View.prototype.listen,{"set:$this":"set"}),initialize:function(){if(!this.model)throw"Model required in order to instantiate ComponentView";if(!this.el)throw"Element required in order to instantiate ComponentView";var a=this.$el.data("init");if(a){var b=n.keys(a);n.each(b,function(b){this.set(b,a[b])},this.model)}},set:function(a){a&&n.each(n.keys(a),function(b){this.model.set(b,a[b])},this)}}),u.ControlView=u.ComponentView.extend({listen:n.extend({},a.Definitions.Views.ComponentView.prototype.listen,{"toggle:$this":"toggle","focus:$this":"focus","show:$this":"show","hide:$this":"hide"}),initialize:function(){this._super(),this.model.set("isVisible","none"!==this.$el.css("display"))},focus:function(){this.$el.focus()},hide:function(){this.model.set("isVisible",!1)},show:function(){this.model.set("isVisible",!0)},toggle:function(){this.model.toggle()}}),u.BlockView=u.ControlView.extend({initialize:function(){this._super(),this.model.set("width",this.$el.width()),this.model.set("height",this.$el.height())}}),u.InputView=u.ControlView.extend({listen:n.extend({},a.Definitions.Views.ComponentView.prototype.listen,{"enable:$this":"enable","disable:$this":"disable"}),initialize:function(){this._super(),this.model.set("isEnabled","disabled"!=m(this.el).attr("disabled"))},disable:function(){this.model.set("isEnabled",!1)},enable:function(){this.model.set("isEnabled",!0)}}),u.ButtonBaseView=u.ControlView.extend({listen:n.extend({},a.Definitions.Views.ControlView.prototype.listen,{"enable:$this":"enable","disable:$this":"disable"}),initialize:function(){this._super(),this.model.set("isEnabled","disabled"!=m(this.el).attr("disabled"))},click:function(){if(this.model.get("isEnabled")){var b=this.$el.attr("data-sc-click");b&&a.Helpers.invocation.execute(b,{control:this,app:this.app}),this.model._events&&this.model._events.click&&n.each(this.model._events.click,function(a){a.callback&&a.context&&a.callback.call(a.context)})}},disable:function(){this.model.set("isEnabled",!1)},enable:function(){this.model.set("isEnabled",!0)}}),b.Definitions.Collections=b.Definitions.Collections||[],g.createComponent("ComponentBase",c.ComponentModel,d.ComponentView,".sc-componentbase"),g.createComponent("ControlBase",c.ControlModel,d.ControlView,".sc-controlbase"),g.createComponent("BlockBase",c.BlockModel,d.BlockView,".sc-blockbase"),g.createComponent("ButtonBase",c.ButtonBaseModel,d.ButtonBaseView,".sc-buttonBase"),g.createComponent("InputBase",c.InputModel,d.InputView,".sc-inputbase"),g.createComponent("PageBase",c.Model,d.View,"body"),g.createBindingConverter({name:"Has",convert:function(a){return a&&a[0]?n.isArray(a[0])?0===a[0].length?!1:!0:!0:!1}}),g.createBindingConverter({name:"Not",convert:function(a){return!(a&&a[0])}});var v={combine:function(){if(0===arguments.length)return"";var a=n.reduce(arguments,function(a,b){return b&&n.isString(b)?a+"/"+n.compact(b.split("/")).join("/"):a});return a?0===a.indexOf("/")?a:"/"+a:""},isParameterNameAlreadyInUrl:function(a,b){return a.indexOf("?"+b+"=")>=0||a.indexOf("&"+b+"=")>=0},addQueryParameters:function(a,b){var c,d=n.pairs(b),e="([\\?&])({{param}}=[^&]+)",f=a;return n.each(d,function(a){v.isParameterNameAlreadyInUrl(f,a[0])?(c=new RegExp(e.replace("{{param}}",encodeURIComponent(a[0])),"i"),f=f.replace(c,"$1"+a[0]+"="+a[1])):(f=f+=~f.indexOf("?")?"&":"?",f+=encodeURIComponent(a[0])+"="+encodeURIComponent(a[1]))}),f},getQueryParameters:function(a){var b,c={};return n.isString(a)?(b=a.split("?"),(b=b.length>1?b[1].split("&"):b[0].split("&"))?(n.each(b,function(a){var b=a.split("=");2===b.length&&(c[b[0]]=decodeURIComponent(b[1].replace(/\+/g," ")))}),c):void 0):c}},w={parseISO:function(a){var b,c,d,e,f,g;return n.isString(a)?(b=parseInt(a.substr(0,4),10),c=parseInt(a.substr(4,2),10)-1,d=parseInt(a.substr(6,2),10),8!==a.indexOf("T")?new Date(Date.UTC(b,c,d,0,0,0,0)):(e=parseInt(a.substr(9,2),10),f=parseInt(a.substr(11,2),10),g=parseInt(a.substr(13,2),10),new Date(Date.UTC(b,c,d,e,f,g)))):null},toISO:function(a){var b;return n.isDate(a)?(b="",b+=a.getUTCFullYear(),b+=this.ensureTwoDigits(a.getUTCMonth()+1),b+=this.ensureTwoDigits(a.getUTCDate()),b+="T",b+=this.ensureTwoDigits(a.getUTCHours()),b+=this.ensureTwoDigits(a.getUTCMinutes()),b+=this.ensureTwoDigits(a.getUTCSeconds())):b},isISO:function(a){var b;return!n.isString(a)||8!=a.length&&15!=a.length?!1:(b=this.parseISO(a),"[object Date]"===Object.prototype.toString.call(b)?isNaN(b.getYear())?!1:!0:!1)},ensureTwoDigits:function(a){return 10>a?"0"+a.toString():a.toString()}},x={isId:function(a){return n.isString(a)?/^\{?[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}\}?$/i.test(a):!1},toId:function(a){return a&&32===a.length?"{"+a.substr(0,8)+"-"+a.substr(8,4)+"-"+a.substr(12,4)+"-"+a.substr(16,4)+"-"+a.substr(20,12)+"}":a},toShortId:function(a){return n.isString(a)&&x.isId(a)?a.replace(/-|\{|\}/g,""):void 0}},y={endsWith:function(a,b){return b&&a?a.lastIndexOf(b)===a.length-b.length:!1},equals:function(a,b,c){return n.isString(a)&&n.isString(b)?c?n.isBoolean(c)?a===b:void 0:a.toLowerCase()===b.toLowerCase():void 0},format:function(a){return a?(n.each(arguments,function(b,c){a=a.replace(new RegExp("\\{"+(c-1)+"\\}","gi"),b)}),a):a},formatByTemplate:function(a,b){if("function"!=typeof b)return a;if("string"!=typeof a)return"";var c=/{{(.*?)}}/gi,d=a.match(c);return n.each(d,function(c){var d=c.replace("{{","").replace("}}",""),e=b(d);"undefined"!=typeof e&&null!=e&&(a=a.replace(c,e))}),a}},z={getOwnProperties:function(a){var b,c=[];for(b in a)a.hasOwnProperty(b)&&c.push(b);return c}},A={execute:function(a,c){if(a){var d=a.indexOf(":");if(0>=d)throw"Invocation is malformed (missing 'handler:')";c=c||{};var e=a.substr(0,d),f=a.substr(d+1),g=n.extend({},{handler:e,target:f},c);b.Pipelines.Invoke.execute(g)}}},B={loadOverlays:function(a){var c=m("script[type='text/x-sitecore-overlays']");if(0!=c.length){var d=c.data("sc-overlays").split("|"),e=c.data("sc-parameters");for(var f in d){var g=d[f]+"?speak="+b.VERSION+"&"+e;m.ajax({url:g,dataType:"json"}).done(function(c){b.Helpers.overlay.processOverlays(a,c,d[f])}).fail(function(a){console.log("Overlay url failed: "+g,a)})}}},processOverlays:function(a,b,c){var d=b.overlays;for(var e in d)this.processOverlay(a,d[e],c)},processOverlay:function(a,b,c){var d,e=b.command,f=b.selector,g=b.placement,h=b.html;if("component:"==f.substr(0,10)){var i=f.substr(10),j=n.find(a.Controls,function(a){return a.name==i});if(null==j)return void console.log("Overlay selector not found: "+f);d=j.view.$el}else d=m(f);if(null==d||0==d.length)return void console.log("Overlay selector not found: "+f);switch(e){case"insert":this.insert(a,d,g,h,c);break;case"remove":this.remove(a,d);break;case"replace":this.replace(a,d,h,c);break;default:console.log("Unknow overlay command: "+e)}},insert:function(a,c,d,e,f){e="<div data-sc-app id='"+n.uniqueId("overlay-")+"' >"+e,e+="</div>";var g=m(m.parseHTML(e));switch(d){case"before":g.insertBefore(c);break;case"after":g.insertAfter(c);break;case"prepend":c.prepend(e);break;case"append":c.append(e);break;default:console.log("Unknow overlay insert placement: "+d)}b.load(window,g,function(a){b.trigger("overlay-loaded",{app:a,url:f})})},remove:function(a,b){b.remove()},replace:function(a,c,d,e){d=m.parseHTML(d),$html=m(d),c.replaceWith($html),b.load(window,$html,function(a){b.trigger("overlay-loaded",{app:a,url:e})})}},C={init:function(){m(window).resize(function(){b.trigger("window:resize",m(window).width(),m(window).height())})},loaded:function(){b.trigger("window:loaded")}};n.extend(b,{Helpers:{url:v,date:w,id:x,string:y,object:z,invocation:A,overlay:B,window:C}}),b.Helpers.window.init();var D=b.Helpers,E={_current:0,converters:[],aborted:!1},F=function(){return E.converters.length},G=function(a){if(a=a||{},!(n.isFunction(a.canConvert)&&n.isFunction(a.convert)&&n.isFunction(a.reConvert)&&n.isString(a.name)))throw"invalid converter";E.converters.push(a)},H=function(a){E.converters=n.reject(E.converters,function(b){return b.name===a})},I=function(a){return n.find(E.converters,function(b){return b.name===a})},J=function(){return E.converters},K={name:"date",canConvert:function(a){return D.string.equals(a.type,this.name)||D.string.equals(a.type,"datetime")},convert:function(a){var b="",c=a.value;if(c)try{return D.date.parseISO(c).toLocaleDateString()}catch(d){return b}return b},reConvert:function(a){if(!a)return"";try{var b=new Date(a);return D.toISO(b)}catch(c){return a||""}},toStringWithFormat:function(a,b){if(D.date.isISO(a))try{var c=D.date.parseISO(a),d={mmss:{expression:"(\\W|^)mm(\\W+s{1,2}\\W|\\W+s{1,2}$)",value:D.date.ensureTwoDigits(c.getUTCMinutes())},mss:{expression:"(\\W|^)m(\\W+s{1,2}\\W|\\W+s{1,2}$)",value:c.getUTCMinutes().toString()},hmm:{expression:"(\\Wh{1,2}\\W+|^h{1,2}\\W+)mm(\\W|$)",value:D.date.ensureTwoDigits(c.getUTCMinutes())},hm:{expression:"(\\Wh{1,2}\\W+|^h{1,2}\\W+)m(\\W|$)",value:c.getUTCMinutes().toString()},ms:{expression:"(\\Wss\\W|^ss\\W)00(\\W|$)",value:D.date.ensureTwoDigits(c.getUTCMilliseconds())},ampm:{expression:"(\\W|^)AM/PM(\\W|$)",value:c.getUTCHours()>=12?"PM":"AM"},ap:{expression:"(\\W|^)A/P(\\W|$)",value:c.getUTCHours()>=12?"P":"A"},yyyy:{expression:"(\\W|^)yyyy(\\W|$)",value:c.getUTCFullYear().toString()},yy:{expression:"(\\W|^)yy(\\W|$)",value:D.date.ensureTwoDigits(c.getUTCFullYear()%100)},mm:{expression:"(\\W|^)mm(\\W|$)",value:D.date.ensureTwoDigits(c.getUTCMonth()+1)},m:{expression:"(\\W|^)m(\\W|$)",value:(c.getUTCMonth()+1).toString()},dd:{expression:"(\\W|^)dd(\\W|$)",value:D.date.ensureTwoDigits(c.getUTCDate())},d:{expression:"(\\W|^)d(\\W|$)",value:c.getUTCDate().toString()},hh:{expression:"(\\W|^)hh(\\W|$)",value:D.date.ensureTwoDigits(c.getUTCHours())},h:{expression:"(\\W|^)h(\\W|$)",value:c.getUTCHours()>12?(c.getUTCHours()-12).toString():(0==c.getUTCHours()?12:c.getUTCHours()).toString()},ss:{expression:"(\\W|^)ss(\\W|$)",value:D.date.ensureTwoDigits(c.getUTCSeconds())},s:{expression:"(\\W|^)s(\\W|$)",value:c.getUTCSeconds().toString()}};for(var e in d){var f=d[e]?d[e].expression:"",g="$1"+d[e].value+"$2";if(""!=f){var h=new RegExp(f,"g");b=b.replace(h,g)}}return b}catch(i){return a}return a}},L={name:"Icon",baseUrl:D.url.combine(b.SiteInfo.virtualFolder,"~/icon/"),canConvert:function(a){return D.string.equals(a.type,this.name)},convert:function(a){if(this.canConvert(a)){var b=a.value||"/sitecore/images/blank.gif";return 0!==b.indexOf("/sitecore/")&&(b=D.url.combine(this.baseUrl,b)),D.string.format('<img src="{0}" alt="" />',b)}},reConvert:function(){}},M={length:F,add:G,remove:H,get:I,getAll:J};M.add(K),M.add(L),n.extend(b,{Converters:M});var N=a.Pipelines=function(){var b=[];return{add:function(a){if(!a||!a.name||!n.isObject(a))throw new"invalid pipeline";b.push(a),this[a.name]=a},remove:function(c){b=n.reject(b,function(a){return a.name===c}),delete a.Pipelines[c]},length:function(){return b.length}}}();N.Pipeline=function(a){var b={name:a,processors:[],add:function(a){if(!(a&&a.priority&&a.execute&&n.isNumber(a.priority)&&n.isFunction(a.execute)))throw"not valid step";this.processors.push(a)},length:function(){return this.processors.length},remove:function(a){this.processors=n.reject(this.processors,function(b){return b===a})},execute:function(a){var b=n.sortBy(this.processors,function(a){return a.priority});n.each(b,function(b){return a.aborted?!1:void b.execute(a)})}};return b};var O=function(a,b){var c=a.split("."),d=c[0];if("this"===d)new Function(a).call(b.control.model);else if(b.app&&"app"===d){var e=a.replace("app","this");new Function(e).call(b.app)}else new Function(a)()},P={priority:1e3,execute:function(a){"javascript"===a.handler&&(a.target.indexOf(";")>0?n.each(a.target.split(";"),function(b){O(b,a)}):O(a.target,a))}},Q={priority:2e3,execute:function(b){"command"===b.handler&&a.executeCommand(b.target)}},R={priority:3e3,execute:function(b){if("serverclick"===b.handler){var c={url:b.target,type:"POST",dataType:"json"},d=function(c){a.Pipelines.ServerInvoke.execute({data:c,model:b.model})};m.ajax(c).done(d)}}},S={priority:4e3,execute:function(a){if("trigger"===a.handler){var b=a.app;if(!b)throw"An application is a required when triggering events";var c=a.target,d={},e=c.indexOf("(");if(e>=0){if(-1==c.indexOf(")",c.length-1))throw"Missing ')'";var f=c.substr(e+1,c.length-e-2);d=m.parseJSON(f),c=c.substr(0,e)}d.sender=a.control,b.trigger(c,d)}}},T={priority:1e3,execute:function(a){var b=a.data.ViewModel;null!=b&&o.mapping.fromJS(b,{},a.model)}},U=new a.Pipelines.Pipeline("Invoke");U.add(P),U.add(Q),U.add(R),U.add(S),a.Pipelines.add(U);var V=new a.Pipelines.Pipeline("ServerInvoke");V.add(T),a.Pipelines.add(V);var W=new N.Pipeline("Application"),X=function(){return{}},Y=function(a,b,c,d,e,f,g,h,i){var j,k,l,o,p,q=m(b);if(i){var r=q.find("[data-sc-app]");r.length>0&&m.each(r,function(){m(this).addClass("data-sc-waiting")})}if(!q.data("sc-app")){j=n.uniqueId("sc_"+a.type+"_"),k=q.attr("data-sc-id"),g.appId&&(k=g.appId+":"+k);var s=n.filter(q.prop("class").split(" "),function(a){return-1===a.indexOf("sc_")});if(q.prop("class",s.join(" ")),q.addClass(j),d&&m("[data-sc-exclude] ."+j).length)return{};if(e&&q.closest("[data-sc-app]").attr("id")&&"#"+q.closest("[data-sc-app]").attr("id")!=f)return{};l=new a.model({type:j,name:k}),l.componentName=a.type,q.data("sc-app",c),q.addClass("data-sc-registered"),a.collection&&(o=new a.collection);var t=q.data("sc-behaviors");if(p=new a.view({el:"."+j,model:l,collection:o,app:g,behaviors:t}),n.each(p.$el.find("[data-bind]"),function(a){var b=m(a);0==b.closest(".data-sc-waiting").length&&b.addClass("data-sc-registered")},this),p.$el.find("*").contents().each(function(){try{this.registered=8===this.nodeType?!0:!1}catch(a){}}),g[k]=l,o&&n.extend(g[k],X(o,a.collection.prototype.defaults)),h.Controls.push({name:k,model:l,view:p,collection:o}),i){var u=q.find(".data-sc-waiting");
u.each(function(){m(this).removeClass("data-sc-waiting")})}}return g},Z=function(a,b){return a||(b="body",a="app"),b||(b=a),"body"!==b&&b.indexOf("#")<0&&(b="#"+b),{name:a,el:b,$el:m(b)}},$=function(a,b){0===a.find("[data-sc-hasnested]").length?b(a):(n.each(a.find("[data-sc-hasnested]"),function(a){$(m(a),b)}),b(a))},_={priority:1e3,execute:function(c){c=c||{};var d=c.name,e=c.id,f=c.mainApp,g=c.app,h=Z(d,e),i=m(h.$el).find("[data-sc-exclude]"),k=i.length||!1,l=m(h.$el).find("[data-sc-app]").length||!1,o=[];if(c.Controls=[],g=g||new a.Definitions.App,f||(f=a),f[h.name])throw"already an app with this name";g.ScopedEl=h.$el,g.name=h.name,b.Components&&b.Components.length>0&&n.each(b.Components,function(a){m(h.$el).find(a.el+":not(.data-sc-registered)").each(function(){m(this).data("sc-hasnested")?o.push(a):Y(a,this,h.name,k,l,h.$el.selector,g,c)})}),o.length>0&&n.each(o,function(a){m(h.$el).find(a.el+":not(.data-sc-registered)").each(function(){var a=m(this);$(a,function(a){var b=n.find(o,function(b){return a.hasClass(b.el.substring(1))});Y(b,a.get(0),h.name,k,l,h.$el.selector,g,c,!0)})})}),n.each(c.Controls,function(a){if(a.view.listen){var b=n.keys(a.view.listen);n.each(b,function(b){var c=b;if(c.indexOf(":$this")>=0){var d=a.view.$el.attr("data-sc-id");if(!d)return;c=c.replace("$this",d)}g.on(c,a.view[a.view.listen[b]],a.view)})}}),f===a?f[h.name]=j?g:"application":(f[h.name]=g,f.nested=f.nested||[],f.nested.push(g)),g.Controls=c.Controls,h.$el.find("[data-sc-app]").each(function(){var a=m(this),c=a.attr("id"),d=a.attr("data-sc-require");d?require(d.split(","),function(a){var b=new a;b.run(c,c,g)}):b.Factories.createApp({name:c,id:c,mainApp:g,aborted:!1})}),c.current=g}},ab=function(a){var c=b.BindingConverters[a];return c?c:void 0},bb=function(a){if(a.converter){var b=[];return n.each(a.from,function(a){b.push(a.model.get(a.attribute))}),a.converter(b)}var c=a.from[0].model,d=a.from[0].attribute;return c.get(d)},cb=function(a){n.each(a.from,function(b){b.model.on("change:"+b.attribute,function(){a.model.set(a.to,bb(a))})}),a.model.set(a.to,bb(a))},db=function(a,b){var c=n.keys(a.attributes),d=n.find(c,function(a){return a===b});return d?b:b.charAt(0).toLowerCase()+b.slice(1)},eb=function(a,b){var c=n.keys(a),d=n.find(c,function(a){return a===b});return d?a[b]:a[b.charAt(0).toUpperCase()+b.slice(1)]},fb=function(a,b,c){var d=c,e=a.attr("data-sc-bindings"),f=[],g=b[d];if(0!=e.indexOf("{")){var h=[];n.each(e.split(","),function(a){var b=[];n.each(a.split(":"),function(a){b.push('"'+a+'"')}),h.push(b.join(":"))}),e="{"+h.join(",")+"}"}try{var i=JSON.parse(e);n.each(n.keys(i),function(a){var c,d,e={from:[],to:a,converter:void 0,model:g},h=i[a];e.to=db(g,a),n.isObject(h)?(e.converter=ab(h.converter),n.each(h.parameters,function(a){c=eb(b,a.split(".")[0]),d=db(c,a.split(".")[1]),e.from.push({model:c,attribute:d})})):(c=b[h.split(".")[0]],d=db(c,h.split(".")[1]),e.from.push({model:c,attribute:d})),f.push(e)}),n.each(f,cb)}catch(j){throw"Failed to data-bind: "+c+"\n"+j}},gb={priority:1500,execute:function(a){0!==a.current.Controls.length&&n.each(a.current.Controls,function(b){b.view.$el.attr("data-sc-bindings")&&fb(b.view.$el,a.current,b.view.$el.attr("data-sc-id"))})}},hb={priority:2e3,execute:function(a){n.each(a.Controls,function(a){a.view.beforeRender&&a.view.beforeRender()})}},ib={priority:3e3,execute:function(a){n.each(a.Controls,function(a){a.view.render&&a.view.render()})}},jb={priority:4e3,execute:function(a){n.each(a.Controls,function(a){a.view.afterRender&&a.view.afterRender()})}};W.add(_),W.add(gb),W.add(hb),W.add(ib),W.add(jb),a.Pipelines.add(W),n.extend(b.Web,{itemWebApi:{takeValidScope:function(a){switch(a){case"self":return"s";case"children":return"c";case"parent":return"p";default:throw"Unsupported scope. It must be either 'self', 'children' or 'parent'"}},addScope:function(a,c){if(c&&n.isArray(c)){var d=n.compact(n.map(c,b.Web.itemWebApi.takeValidScope)).join("|");a=b.Helpers.url.addQueryParameters(a,{scope:d})}return a},addDatabase:function(a,c){return c&&n.isString(c)&&(a=b.Helpers.url.addQueryParameters(a,{sc_database:c})),a},addContentDatabase:function(a,c){return c&&n.isString(c)&&(a=b.Helpers.url.addQueryParameters(a,{sc_content:c})),a},addItemSelectorUrlPortion:function(c,d,e){return d&&n.isString(d)&&(e&&e.facetsRootItemId&&(c=b.Helpers.url.addQueryParameters(c,{facetsRootItemId:e.facetsRootItemId})),0===d.indexOf("search:")?(c=b.Helpers.url.addQueryParameters(c,{search:d.substr("search:".length)}),e&&e.root&&a.Helpers.id.isId(e.root)&&(c=b.Helpers.url.addQueryParameters(c,{root:e.root})),e&&e.searchConfig&&(c=b.Helpers.url.addQueryParameters(c,{searchConfig:e.searchConfig}))):c=0===d.indexOf("query:")?b.Helpers.url.addQueryParameters(c,{query:d.substr("query:".length)}):b.Helpers.id.isId(d)?b.Helpers.url.addQueryParameters(c,{sc_itemid:d}):b.Helpers.url.combine(c,d)),c},addLanguage:function(a,c){return c&&(a=b.Helpers.url.addQueryParameters(a,{language:c})),a},addItemVersion:function(a,c){return c&&(a=b.Helpers.url.addQueryParameters(a,{sc_itemversion:c})),a},getUrl:function(a,c){c=c||{};var d="/-/item/v1",e="";c.webApi&&(d=c.webApi),c.virtualFolder&&(e=c.virtualFolder);var f=b.Helpers.url.combine(d,e);return f=this.addItemSelectorUrlPortion(f,a,c),c.scope&&(f=this.addScope(f,c.scope)),c.database&&""!=a&&0===a.indexOf("search:")?f=this.addContentDatabase(f,c.database):c.database&&(f=this.addDatabase(f,c.database)),c.language&&(f=this.addLanguage(f,c.language)),c.version&&(f=this.addItemVersion(f,c.version)),c.payLoad&&(f=b.Helpers.url.addQueryParameters(f,{payload:"full"})),c.formatting&&(f=b.Helpers.url.addQueryParameters(f,{format:c.formatting})),c.sorting&&(f=b.Helpers.url.addQueryParameters(f,{sorting:c.sorting})),c.fields&&(f=b.Helpers.url.addQueryParameters(f,{fields:c.fields.join("|")})),c.pageSize&&c.pageSize>0&&(f=b.Helpers.url.addQueryParameters(f,{pageIndex:c.pageIndex,pageSize:c.pageSize})),f}}}),function(b){var c,d=b.Backbone,e=b._,f=b.$,g=d.View.prototype._configure,h=(d.View.prototype.render,Array.prototype.push),i=Array.prototype.concat,j=Array.prototype.splice,k=a.Definitions.Views.View.extend({constructor:function(a){a=a||{},k.setupView(this,a),d.View.call(this,a)},nestedlayout:!0,insertView:function(a,b){return b?this.setView(a,b,!0):this.setView(a,!0)},insertViews:function(a){return e.isArray(a)?this.setViews({"":a}):(e.each(a,function(b,c){a[c]=e.isArray(b)?b:[b]}),this.setViews(a))},getView:function(a){return this.getViews(a).first().value()},getViews:function(a){var b=e.chain(this.views).map(function(a){return e.isArray(a)?a:[a]},this).flatten().value();return"string"==typeof a?e.chain([this.views[a]]).flatten():e.chain("function"==typeof a?e.filter(b,a):b)},setView:function(a,b,c){var d,f,g,h=this;if("string"!=typeof a&&(c=b,b=a,a=""),this.views=this.views||{},d=b.__manager__,f=this.views[a],!d)throw new Error("Please set `View#manage` property with selector '"+a+"' to `true`.");return g=b._options(),d.parent=h,d.selector=a,c?(this.views[a]=i.call([],f||[],b),d.append=!0,b):(d.hasRendered&&g.partial(h.el,d.selector,b.el,d.append),f&&e.each(i.call([],f),function(a){a.remove()}),this.views[a]=b)},setViews:function(a){return e.each(a,function(a,b){return e.isArray(a)?e.each(a,function(a){this.insertView(b,a)},this):void this.setView(b,a)},this),this},render:function(){function a(){function a(){var a=d.afterRender;a&&a.call(c,c),c.trigger("afterRender",c)}var b,e;return g&&(d.contains(g.el,c.el)||d.partial(g.el,f.selector,c.el,f.append)),c.delegateEvents(),f.hasRendered=!0,j.resolveWith(c,[c]),(b=f.queue.shift())?b():delete f.queue,i&&i.queue?(e=function(){g.off("afterRender",e,this),a()},g.on("afterRender",e,c)):void a()}function b(){{var b=c._options(),d=c.__manager__,f=d.parent;f&&f.__manager__}c._render(k._viewRender,b).done(function(){if(!e.keys(c.views).length)return a();var d=e.map(c.views,function(a){var c=e.isArray(a);return c&&a.length?a[0].render().pipe(function(){return b.when(e.map(a.slice(1),function(a){return a.render()}))}):c?a:a.render()});b.when(d).done(function(){a()})})}var c=this,d=c._options(),f=c.__manager__,g=f.parent,i=g&&g.__manager__,j=d.deferred();return f.queue?h.call(f.queue,function(){b()}):(f.queue=[],b(c,j)),j.view=c,j},remove:function(){return k._removeView(this,!0),this._remove.apply(this,arguments)},_options:function(){return k.augment({},this,k.prototype.options,this.options)}},{_cache:{},_makeAsync:function(a,b){var c=a.deferred();return c.async=function(){return c._isAsync=!0,b},c},_viewRender:function(a,b){function c(c){c&&b.html(a.$el,c),h.resolveWith(a,[a])}function d(a,d){var e,g=k._makeAsync(b,function(a){c(a)});k.cache(f,d),d&&(e=b.render.call(g,d,a)),g._isAsync||c(e)}{var f,g,h;a.__manager__}return{render:function(){var c=a.serialize||b.serialize,i=a.data||b.data,j=c||i,l=a.template||b.template,m="";return a.parent&&a.parent.$el&&(m=a.parent.$el.data("sc-id")),e.isFunction(j)&&(j=j.call(a)),h=k._makeAsync(b,function(a){d(j,a)}),"string"==typeof l&&(f=b.prefix+l),(g=k.cache(f+m))?(d(j,g,f),h):("string"==typeof l?g=b.fetch.call(h,b.prefix+l,m):null!=l&&(g=b.fetch.call(h,l)),h._isAsync||d(j,g),h)}}},_removeViews:function(a,b){"boolean"==typeof a&&(b=a,a=this),a=a||this,a.getViews().each(function(a){(a.__manager__.hasRendered||b)&&k._removeView(a,b)})},_removeView:function(a,b){var c,d=a.__manager__,f="boolean"==typeof a.keep?a.keep:a.options.keep;if(!f&&(d.append===!0||b)){if(k.cleanViews(a),a._removeViews(!0),a.$el.remove(),!d.parent)return;if(c=d.parent.views[d.selector],e.isArray(c))return e.each(e.clone(c),function(a,b){a&&a.__manager__===d&&j.call(c,b,1)});delete d.parent.views[d.selector]}},cleanViews:function(a){e.each(i.call([],a),function(a){a.unbind(),a.model instanceof d.Model&&a.model.off(null,null,a),a.collection instanceof d.Collection&&a.collection.off(null,null,a),a.cleanup&&a.cleanup.call(a)})},cache:function(a,b){return a in this._cache?this._cache[a]:null!=a&&null!=b?this._cache[a]=b:void 0},configure:function(a){this.augment(k.prototype.options,a),a.manage&&(d.View.prototype.manage=!0)},augment:e.forIn?function(a){return e.reduce(Array.prototype.slice.call(arguments,1),function(a,b){return e.forIn(b,function(b,c){a[c]=b}),a},a)}:e.extend,setupView:function(a,b){if(!a.__manager__){var f,g,h,j=d.LayoutManager.prototype,l=e.pick(a,c);e.defaults(a,{views:{},__manager__:{},_removeViews:k._removeViews,_removeView:k._removeView},k.prototype),b=a.options=e.defaults(b||{},a.options,j.options),h=e.pick(b,i.call(["events"],e.values(b.events))),k.augment(a,h),(l.render===k.prototype.render||l.render===d.View.prototype.render)&&delete l.render,k.augment(b,l),a._remove=d.View.prototype.remove,a._render=function(a,b){var c=this,d=c.__manager__,e=b.beforeRender;return d.hasRendered&&this._removeViews(),e&&e.call(this,this),this.trigger("beforeRender",this),a(this,b).render()},a.render=k.prototype.render,a.remove!==j.remove&&(a._remove=a.remove,a.remove=j.remove),f=b.views||a.views,e.keys(f).length&&(g=f,a.views={},a.setViews(g)),a.options.template?a.options.template=b.template:a.template&&(b.template=a.template,delete a.template)}}});a.Definitions.Views.CompositeView=d.Layout=d.LayoutView=d.LayoutManager=k,k.VERSION="0.7.5",d.View.prototype._configure=function(){var a=g.apply(this,arguments);return this.manage&&k.setupView(this),a},k.prototype.options={prefix:"",deferred:function(){return f.Deferred()},fetch:function(a){return e.template(f(a).html())},partial:function(a,b,c,d){var e=b?f(a).find(b):f(a);this[d?"append":"html"](e,c)},html:function(a,b){a.html(b)},append:function(a,b){a.append(b)},when:function(a){return f.when.apply(null,a)},render:function(a,b){return a(b)},contains:function(a,b){return f.contains(a,b)}},c=e.keys(k.prototype.options),k.prototype.options=e.extend(k.prototype.options,{fetch:function(a,b){var c="[data-layout-"+a+"]";b&&(c="[data-layout-"+a+"='"+b+"']");var d=f(c).html();if(void 0===d)throw"missing template data-layout-"+a+" in order to work";return e.template(d)}})}(this),e.DatabaseUri=function(a){if(!a)throw"Parameter 'databaseName' is null or empty";this.databaseName=a,this.webApi="",this.virtualFolder="/sitecore/shell"},n.extend(e.DatabaseUri.prototype,{getDatabaseName:function(){return this.databaseName}}),e.ItemUri=function(a,b){if(!a)throw"Parameter 'databaseUri' is null or empty";if(!b)throw"Parameter 'itemId' is null or empty";this.databaseUri=a,this.itemId=b},n.extend(e.ItemUri.prototype,{getDatabaseName:function(){return this.databaseUri.databaseName},getDatabaseUri:function(){return this.databaseUri},getItemId:function(){return this.itemId}}),e.ItemVersionUri=function(a,b,c){if(!a)throw"Parameter 'itemUri' is null";if(!b)throw"Parameter 'language' is null or empty";if(!n.isNumber(c))throw"Parameter 'version' is null or not a number";this.itemUri=a,this.language=b,this.version=c},n.extend(e.ItemVersionUri.prototype,{getDatabaseUri:function(){return this.itemUri.getDatabaseUri()},getDatabaseName:function(){return this.itemUri.getDatabaseName()},getItemUri:function(){return this.itemUri},getItemId:function(){return this.itemUri.getItemId()},getLanguage:function(){return this.language},getVersion:function(){return this.version}}),e.FieldUri=function(a,b){if(!a)throw"Parameter 'itemVersionUri' is null or empty";if(!b)throw"Parameter 'fieldId' is null or empty";this.itemVersionUri=a,this.fieldId=b},n.extend(e.FieldUri.prototype,{getDatabaseUri:function(){return this.itemVersionUri.getDatabaseUri()},getDatabaseName:function(){return this.itemVersionUri.getDatabaseName()},getItemUri:function(){return this.itemVersionUri.getItemUri()},getItemId:function(){return this.itemVersionUri.getItemId()},getLanguage:function(){return this.itemVersionUri.getLanguage()},getVersion:function(){return this.itemVersionUri.getVersion()},getFieldId:function(){return this.fieldId}}),e.Database=function(a){if(!a)throw"Parameter 'databaseUri' is null";this.databaseUri=a,this.ajaxOptions={dataType:"json"}},n.extend(e.Database.prototype,{convertToItem:function(a){return a.result?a.result.items?0===a.result.items.length?null:a.result.items.length>1?(console.debug("ERROR: Expected a single item"),null):new b.Definitions.Data.Item(a.result.items[0]):(console.debug("ERROR: No items from server"),null):(console.debug("ERROR: No data from server"),null)},convertToItems:function(a){if(!a.result)return console.debug("ERROR: No data from server"),{items:[],totalCount:0,data:a};if(!a.result.items)return console.debug("ERROR: No items from server"),{items:[],totalCount:0,data:a};var c=n.map(a.result.items,function(a){return new b.Definitions.Data.Item(a)});return{items:c,total:a.result.totalCount,data:a.result}},getItem:function(a,c,d){if(!a)throw"Parameter 'id' is null";if(!c)throw"Parameter 'completed' is null";d=d||{},a instanceof b.Definitions.Data.ItemUri&&(d.database=a.getDatabaseName(),a=a.getItemId()),a instanceof b.Definitions.Data.ItemVersionUri&&(d.database=a.getDatabaseName(),d.language=a.getLanguage(),d.version=a.getVersion(),a=a.getItemId());var e=this.getUrl(a,d);this.get(e).pipe(this.convertToItem).done(c).fail(function(a){c(null,a)})},search:function(a,b,c){if(!b)throw"Parameter 'completed' is null";var d=this.getUrl("search:"+a,c);this.get(d).pipe(this.convertToItems).done(function(a){b(a.items,a.total,a.data)}).fail(function(a){b([],0,a)})},query:function(a,b,c){if(!a)throw"Parameter 'queryExpression' is null";if(!b)throw"Parameter 'completed' is null";var d=this.getUrl("query:"+a,c);this.get(d).pipe(this.convertToItems).done(function(a){b(a.items,a.total,a.data)}).fail(function(a){b([],0,a)})},getChildren:function(a,b,c){if(!a)throw"Parameter 'id' is null";if(!b)throw"Parameter 'completed' is null";c=c||{},c.scope||(c.scope=["children"]);var d=this.getUrl(a,c);this.get(d).pipe(this.convertToItems).done(function(a){b(a.items,a.total,a.data)}).fail(function(a){b([],0,a)})},getUrl:function(b,c){c=c||{},c.database||(c.database=this.databaseUri.getDatabaseName()),c.webApi||(c.webApi=this.databaseUri.webApi),c.virtualFolder||(c.virtualFolder=this.databaseUri.virtualFolder);var d=a.Web.itemWebApi.getUrl(b,c);return d},get:function(a){return m.ajax({url:a,dataType:this.ajaxOptions.dataType})}}),e.Field=function(a,b,c,d,f){if(!a)throw"Parameter 'item' is null";if(!(b instanceof e.FieldUri))throw"Parameter 'fieldUri' is null";this.item=a,this.fieldUri=b,this.fieldName=c||"",this.value=d||"",this.type=f||"Single-Line Text"},n.extend(e.Field.prototype,{toModel:function(){return this.$model||(this.$model=new b.Definitions.Models.Model(this)),this.$model},toViewModel:function(){var a={fieldId:this.fieldUri.getFieldId(),fieldName:this.fieldName,type:this.type,value:new o.observable(this.value)},b=this;return a.value.subscribe(function(a){b.item[b.fieldName]=a,b.value=a}),a}}),e.LocalStorage=function(a){if(!a)throw"you need to provide a unique key";this.appID=a,this.fullKey=this.prefix+this.appID,this.localStorageLibrary=m.jStorage},n.extend(e.LocalStorage.prototype,{prefix:"#sc#",get:function(a){var b=this.fullKey+a;return this.localStorageLibrary.get(b)},getAll:function(){var a,b=this.localStorageLibrary.index(),c={};return a=n.filter(b,function(a){return a.indexOf(this.fullKey)>=0},this),n.each(a,function(a){var b=a.substring(this.fullKey.length,a.length);c[b]=this.localStorageLibrary.get(a)},this),c},deleteRecord:function(a){var b=this.fullKey+a;return this.localStorageLibrary.deleteKey(b)},set:function(a,b,c){var d=this.fullKey+a;return this.localStorageLibrary.set(d,b,c)},flush:function(){var a=this.localStorageLibrary.index(),b=n.filter(a,function(a){return a.indexOf(this.fullKey)>=0},this);n.each(b,function(a){this.localStorageLibrary.deleteKey(a)},this)}});var kb={options:function(a,b){return{dataType:"json",type:a,data:b}},convertResponse:function(a){return 200!==a.statusCode?m.Deferred().reject({readyState:4,status:a.statusCode,responseText:a.error.message}):a.result},createItem:function(a){return new b.Definitions.Data.Item(a.items[0])},triggerCreated:function(a){return b.trigger("item:created",a),a}},lb=function(a,c,d){var e=a;if(!a.name||!a.templateId||!a.parentId)throw"Provide valid parameter in order to create an Item";a.database||(a.database="core");var f=b.Web.itemWebApi.getUrl(e.parentId,{webApi:"/-/item/v1/sitecore/shell",database:a.database});return f=b.Helpers.url.addQueryParameters(f,{name:a.name}),f=b.Helpers.url.addQueryParameters(f,{template:a.templateId}),m.when(m.ajax(f,kb.options("POST",c))).pipe(kb.convertResponse).pipe(kb.createItem).pipe(kb.triggerCreated).done(d)},mb=function(a,c){var d;this.$fields?d=n.map(this.$fields,function(a){return{name:a.fieldName,value:this[a.fieldName]}},this):(d=n.map(this.attributes.$fields,function(a){var b;return this.attributes[a.fieldName]!==a.value?b={name:a.fieldName,value:this.attributes[a.fieldName]}:void 0},this),d=n.filter(d,function(a){return"undefined"!=typeof a}));var e=this.getUrl(),f={dataType:"json",type:"PUT",data:d},g=function(a){return b.trigger("item:updated",this),a};return m.when(m.ajax(e,f)).pipe(this.convertResponse).pipe(g).done(m.proxy(a,c))},nb=function(b,c){var d=this.getUrl(),e={dataType:"json",type:"GET"},f=function(b){if(!b.items)return this;if(0===b.items.length)throw"Item not found";if(date.items.length>1)throw"Expected a single item";var c=b.items[0];return n.each(c.Fields,function(b,c){this[b.Name]=b.Value;var d=this.getFieldById(c);null!=d?d.value=b.Value:this.$fields.push(this,new a.Definitions.Data.Field(fieldUri,b.Name,b.Value,b.Type))},this),this};return m.when(m.ajax(d,e)).pipe(this.convertResponse).pipe(f).done(m.proxy(b,c))},H=function(a,c){var d=this.getUrl(),e={dataType:"json",type:"DELETE"},f=function(a){return b.trigger("item:deleted",this),a};return m.when(m.ajax(d,e)).pipe(this.convertResponse).pipe(f).done(m.proxy(a,c))},ob=function(a,c,d){var e=[{name:"__itemName",value:a}],f=this.getUrl(),g={dataType:"json",type:"PUT",data:e},h=function(a){return b.trigger("item:renamed",this),a};return m.when(m.ajax(f,g)).pipe(this.convertResponse).pipe(h).done(m.proxy(c,d))};e.createItem=lb;var pb=function(a,b,c){var d=this;c=c||{};var e=c.success||function(){b&&b(d)};switch(a){case"read":this.read(this).pipe(e);break;case"create":throw"The 'create' operation is not supported";case"update":this.update(this,c).pipe(e);break;case"delete":this.remove(this).pipe(e)}},qb=a.Definitions.Models.Model.extend({idAttribute:"itemId",getUrl:function(){var a=this.get("itemUri"),b=new e.Database(a.getDatabaseUri());return b.getUrl(a.getItemId())},read:nb,remove:H,rename:ob,update:mb});if(e.Item=function(a,b){if(!b)if(b=a,b.itemUri)a=b.itemUri;else{var c=new e.DatabaseUri(b.Database);a=new e.ItemUri(c,b.ID)}return b instanceof e.Item?void this.shallowCopy(b):(this.$fields=[],n.each(b.Fields,function(b,c){this[b.Name]=b.Value;var d=new e.FieldUri(a,c),f=new e.Field(this,d,b.Name,b.Value,b.Type);b.FormattedValue&&(f.formattedValue=b.FormattedValue),b.LongDateValue&&(f.longDateValue=b.LongDateValue),b.ShortDateValue&&(f.shortDateValue=b.ShortDateValue),this.$fields.push(f)},this),this.itemUri=a,this.itemId=a.getItemId(),this.itemName=b.Name||"",this.$displayName=b.DisplayName||"",this.$database=b.Database||"",this.$language=b.language||"",this.$version=b.version||0,this.$templateName=b.TemplateName||"",this.$templateId=b.TemplateId||"",this.$hasChildren=b.HasChildren||!1,this.$path=b.Path||"",this.$url=b.Url||"",this.$mediaurl=b.MediaUrl||"",void(this.$icon=b.Icon||""))},n.extend(e.Item.prototype,{getFieldById:function(a){return n.find(this.$fields,function(b){return b.fieldUri.getFieldId()==a},this)},shallowCopy:function(a){this.$fields=a.$fields,n.each(a.$fields,function(a){this[a.Name]=a.Value},this),this.itemUri=a.itemUri,this.itemId=a.itemId,this.itemName=a.itemName,this.$displayName=a.$displayName,this.$language=a.$language,this.$version=a.$version,this.$templateName=a.$templateName,this.$templateId=a.$templateId,this.$hasChildren=a.$hasChildren,this.$path=a.$path,this.$url=a.$url,this.$mediaurl=a.$mediaurl},toModel:function(){if(!this.$model){var a=new qb(this);return a.sync=pb,a}return this.$model},toViewModel:function(){return this.toModel().viewModel},convertResponse:kb.convertResponse}),n.extend(b.Factories,{createJQueryUIComponent:function(a,b,c){var d=a.ControlModel.extend({initialize:function(){this._super(),c.model&&n.each(n.keys(c.model),function(a){this.model[a]=c.model[a]},this),n.each(c.attributes,function(a){var b="undefined"!=typeof a.defaultValue?a.defaultValue:null;this.set(a.name,b)},this),"undefined"!=typeof this.initialized&&this.initialized()}}),e=b.ControlView.extend({initialize:function(a){this._super();var b;a=a||{},c.view&&n.each(n.keys(c.view),function(a){this[a]=c.view[a]},this),n.each(c.attributes,function(c){var d="undefined"!=typeof c.defaultValue?c.defaultValue:null;"undefined"!=typeof d&&null!==d&&(b="undefined"!=typeof c.pluginProperty?c.pluginProperty:c.name,a[b]=d);var e=this.$el.attr("data-sc-option-"+b);e&&("true"==e&&(e=!0),"false"==e&&(e=!1),this.model.set(c.name,e),b="undefined"!=typeof c.pluginProperty?c.pluginProperty:c.name,a[b]=e)},this),n.each(c.events,function(b){if("undefined"==typeof a[b.name]){var c=this;a[b.name]=function(a,d){c.raiseEvent(b,a,d)}}},this),this.$el[c.control](a),this.widget=this.$el[c.control],this.widget=this.widget||this.$el.data(c.control),this.widget=this.widget||this.$el.data(c.namespace+c.control),n.each(c.functions,function(a){var b=this;this[a.name]=function(){if(!b.widget[a.name]){var c=b.widget;return c.apply(b.$el,[a.name,arguments[0]])}return b.widget[a.name].apply(b.widget,arguments)}},this),this.model.on("change",function(a){var b,d,e={};a.changed&&(n.each(n.keys(a.changed),function(f){n.find(c.attributes,function(a){return a.name==f&&1==a.added})||(d=n.find(c.attributes,function(a){return a.name==f}),b=d&&"undefined"!=typeof d.pluginProperty?d.pluginProperty:f,e[b]=a.get(f))}),this.$el[c.control]("option",e))},this),"undefined"!=typeof this.initialized&&this.initialized()},raiseEvent:function(a,b,c){a.on&&this[a.on](b,c);var d=this.$el.attr("data-sc-id"),e=this.app[d];e&&"undefined"!=typeof e[a.name]&&e[a.name](e,b,c),d&&this.app.trigger(a.name+":"+d,b,c)}});g.createComponent(c.componentName,d,e,c.selector)}}),j){var rb=0,sb=0,tb=0,ub=[],vb=function(a){var b=0,c=[],d=0;for(var e in a)if(a[e]&&"application"===a[e].modelType){var a=a[e];tb+=1,b+=1,n.each(a.Controls,function(a){sb+=1,d+=1,ub.push(a)}),c.push(vb(a[e]))}return{numberOfNestedApp:rb,nestedApps:c,nbControlInThisApp:d}},wb=function(){var b=vb(a);return{numberOfApps:rb,totalNumberOfControls:sb,totlaNumberOfApp:tb,alltheControls:ub,allApplications:b}};b.__info=function(){return{Components:{totalComponents:a.Components.length,compontentList:a.Components},Pipelines:{totalPipelines:a.Pipelines.length()},Applications:wb()}}}}.call(window);