/**!
 *
 * scBindingPlugin
 *
 * Built: Tue Oct 28 2014 11:25:38 GMT+0000 (GMT Standard Time)
 * PackageVersion: 0.1.1
 *
 */

!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=c[g]={exports:{}};b[g][0].call(j.exports,function(a){var c=b[g][1][a];return e(c?c:a)},j,j.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b){b.exports=function(b,c){var d=a("./utils")(c),e=function(a){this.bindingConfiguration=a},f=function(a,b){if(-1===b.indexOf("."))return{component:a,lastProperty:b};for(var c=b.split("."),d=c.pop(),e=c.length,f=a,g=0;e>g;g++)f=f[c[g]];return{component:f,lastProperty:d}};return e.prototype.getValue=function(a){if(a.converter){var b=[];return a.from.forEach(function(a){b.push(a.component[a.attribute])}),a.converter(b)}var c=a.from[0].component,e=a.from[0].attribute;if(d.isComponentProperty(c,e))c.depricated&&(e=d.lowerCaseFirstLetter(e)),value=c.get(e);else{var g=f(c,e);value=g.component[g.lastProperty]}return d._printDebug("      we set the value to: "+value),value},e.prototype._synchronizeProperty=function(a){if(d.isComponentProperty(a.component,a.to))return a.component.set(a.to,this.getValue(a));var b=f(a.component,a.to);b.component[b.lastProperty]=this.getValue(a)},e.prototype._registerChanges=function(a,b){var c=this,d=function(){c._synchronizeProperty(a)};if(b.component.subscribe)b.component.subscribe("change:"+b.attribute,d);else{if(b.component.subscribe||!b.component.on)throw new Error("Component "+b.component.id+" not suited for Bindings");b.component.on("change:"+b.attribute,d)}},e.prototype.syncAndRegisterChanges=function(){var a=this;this.bindingConfiguration.forEach(function(b){d._printDebug("Applying bindings for the component: "+(b.component.id?b.component.id:"$app")),d._printDebug("  for the property: "+b.to),b.from.forEach(function(c){d._printDebug("    We initialize the value from the component: "+(c.component?c.component.id:"a piece of $data")),a._synchronizeProperty(b),a._registerChanges(b,c)})})},e}},{"./utils":5}],2:[function(a,b){b.exports=function(b,c,d){var e=a("./utils")(d),f=function(a,b,c,d,e){this.component=a,this.bindingConfiguration=b,this.isTwoWay=c,this.isData=d,this.isApp=e};return f.prototype._createBindingConfigurationForProperty=function(a,c){var d=[];if(!b.is.an.object(c)){var e={parameters:[c]};c=e}return d=d.concat(this._createBindingConfigurationForPropertyFromObject(a,c))},f.prototype._createBindingConfigurationForPropertyFromObject=function(a,b){var d=[],g=[],h=c.getConverter(b.converter),i=this.isApp?this.component:this.component.app,j=this;return b.parameters.forEach(function(c){var k=e.getComponentAndBindingMetaData(c,i,j.isData?j.bindingConfiguration.$data:void 0);if(g.push({component:k.component,attribute:k.attribute}),j.isTwoWay||b.mode&&"twoway"===b.mode.toLowerCase()){var l={},m=j.isApp?"$app":e.getFullComponentNameFromComponent(j.component),n=!1,o="$app"===k.fullCompName?!0:!1;m?l[k.attribute]=m+"."+a:(l[k.attribute]="$data."+a,l.$data=j.component,n=!0);var p=new f(k.component,l,!1,n,o);d=d.concat(p.generate())}d.push({from:g,to:a,converter:h,component:j.component})}),d.reverse()},f.prototype.generate=function(){var a=[],c=this;return this.bindingConfiguration?(e.forEachPropertyWithBinding(this.bindingConfiguration,function(d,f){c.component.depricated&&(d=e.lowerCaseFirstLetter(d)),b.is.an.array(f)?f.forEach(function(b){a=a.concat(c._createBindingConfigurationForProperty(d,b))}):a=a.concat(c._createBindingConfigurationForProperty(d,f))}),a):a},f}},{"./utils":5}],3:[function(a,b){var c={},d={getConverter:function(a){var b=c[a];return b?b:void 0},createBindingConverter:function(a){if(!a.name||!a.convert)throw"invalid binding converter";if(c[a.name])throw"already a converter with the same name";c[a.name]=a.convert}};b.exports=d},{}],4:[function(a){!function(){var b="undefined"!=typeof window,c=b&&window.Sitecore?window.Sitecore.Speak:requirejs("boot"),d=c.utils,e=Sitecore.Speak.isDebug(),f=a("./converter"),g=a("./bindingConfiguration")(d,f,e),h=a("./binding")(d,e),i=(a("./utils")(e),function(a,b,c){var d=new g(a,b,c),e=d.generate();if(0!==e.length){var f=new h(e);f.syncAndRegisterChanges()}});Sitecore.Speak.module("bindings",{applyBindings:function(a,b,c){a.app=c,i(a,b,!0,!0)},createBindingConverter:function(a){f.createBindingConverter(a)}}),Sitecore.Speak.module("bindings").createBindingConverter({name:"Has",convert:function(a){return a&&a[0]?Array.isArray(a[0])&&0===a[0].length?!1:!0:!1}}),Sitecore.Speak.module("bindings").createBindingConverter({name:"Not",convert:function(a){return!(a&&a[0])}}),Sitecore.Speak.plugin({name:"bindings",extendApplication:function(a){a.components.forEach(function(a){var b=a.el.getAttribute("data-sc-bindings");b&&i(a,JSON.parse(b))})}})}(this)},{"./binding":1,"./bindingConfiguration":2,"./converter":3,"./utils":5}],5:[function(a,b){b.exports=function(a){return{_printDebug:function(b,c){c||(c="log"),a&&console[c](b)},isComponentProperty:function(a,b){return a.set&&b in a.__properties?!0:!1},lowerCaseFirstLetter:function(a){return a.charAt(0).toLowerCase()+a.slice(1)},findComponent:function(a,b){var c=b.split("."),d=a,e=c.length;if(1===c.length)return a[b];for(var f=0;e>f;f++)d=d[c[f]];return d},getComponentAndBindingMetaData:function(a,b,c){var d,e=this.getFullComponentNameAndAttribute(a),f=e.fullCompName.split("."),g=f.length,h=[];if(c)return{component:c,attribute:e.attribute,fullCompName:e.fullCompName};if("$app"===e.fullCompName)return{component:b,attribute:e.attribute,fullCompName:e.fullCompName};for(;g--&&(d=this.findComponent(b,f.join(".")),!d.app);)h.push(f.pop());return{component:d,attribute:h.length>0?h.reverse().join(".")+"."+e.attribute:e.attribute,fullCompName:f?f.join("."):void 0}},getFullComponentNameAndAttribute:function(a,b){var c=a.split("."),d=c.pop();return compName=Array.isArray(c)&&c.length>1?c.join("."):c[0],{fullCompName:compName,attribute:b?utils.lowerCaseFirstLetter(source.attribute):d}},getFullComponentNameFromComponent:function(a){for(var b=a,c=a.id;b.parent;)c=a.parent.id+"."+c,b=a.parent;return c},forEachPropertyWithBinding:function(a,b){Object.keys(a).forEach(function(c){"$data"!==c&&b(c,a[c])})}}}},{}]},{},[4]);