@using EmailCampaign.Controls
@using Sitecore.Mvc
@using Sitecore.Web.UI.Controls.Common.Renderings
@using Sitecore.Web.UI.Controls.Common.UserControls
@using UserControl = Sitecore.Web.UI.Controls.Common.UserControls.UserControl
@using Bcl = EmailCampaign.Controls.Constants.Renderings.Bcl
@using DataSources = EmailCampaign.Controls.Card.DataSources;
@model Sitecore.Mvc.Presentation.RenderingModel
@{
    UserControl rendering = Html.Sitecore().Controls().GetUserControl(Model.Rendering);
    rendering.Class = "sc-exm-Card";
    rendering.Requires.Css("ecm", "Card.css");
    rendering.Requires.Script("ecm", "Card.js");
    string title = rendering.GetString("Title");
    string height = rendering.GetString("Height");
    string isBusy = rendering.GetString("IsBusy").ToLower();
    rendering.SetAttribute("data-sc-isbusy", isBusy);
    rendering.SetAttribute("data-sc-height", height);
}

@helper RenderMessageVariant(UserControl rendering)
{
    RenderingHelper helper = new RenderingHelper(this.Html, rendering.ControlId);
    string actions = rendering.GetString("Actions");
    string bottomLink = rendering.GetString("BottomLink");
    string usePadding = rendering.GetString("UsePadding");
    string isBusy = rendering.GetString("IsBusy").ToLower();

    if (@actions.Length > 0)
    {
        helper.CreateRenderingAt(
            Bcl.ActionControl,
            "Actions",
            rendering.ControlId + "Expander",
            null,
            @actions,
            ".ActionBar"
            );
    }

    helper.CreateRenderingAt(
        Bcl.HyperlinkButton,
        "HyperlinkButton",
        rendering.ControlId + "BottomLinkBorder",
        null,
        @bottomLink);

    helper.CreateRenderingAt(
        Bcl.ProgressIndicator,
        "ProgressIndicator",
        rendering.ControlId,
        new
        {
            TargetControl = rendering.ControlId + "Wrapper",
            IsBusy = isBusy
        },
        DataSources.ProgressIndicator,
        "Wrapper.Content");

    if (@bottomLink.Length > 0)
    {
        helper.CreateRenderingAt(
            Bcl.Border,
            "BottomLinkBorder",
            rendering.ControlId + "Expander",
            new
            {
                UsePadding = true,
                ContentAlignment = "Center",
                Height = "50px"
            },
            "",
            ".Body");
    }
    else
    {
        rendering.Class += " nobottomlink";
    }

    helper.CreateRenderingAt(
        Bcl.Border,
        "Wrapper",
        rendering.ControlId + "Expander",
        new
        {
            UsePadding = @usePadding
        },
        "",
        ".Body");
}
@RenderMessageVariant(rendering)
<div @rendering.HtmlAttributes data-sc-hasnested="true">
    @(this.Html.Sitecore().Controls().Rendering(this.Html, Bcl.AdvancedExpander, rendering.ControlId + "Expander", DataSources.AdvancedExpander, new
      {
          Header = @title,
          ContentHeight = @height
      }))
</div>