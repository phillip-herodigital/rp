require.config({ paths: { d3: "/-/speak/v1/pathanalyzer/libs/d3.min" } }); define("spiderApp", ["d3"], function (d3){return function(t){function e(n){if(i[n])return i[n].exports;var a=i[n]={exports:{},id:n,loaded:!1};return t[n].call(a.exports,a,a.exports,e),a.loaded=!0,a.exports}var i={};return e.m=t,e.c=i,e.p="",e(0)}([function(t,e,i){"use strict";var n=i(2)["default"],a=i(1)["default"];Object.defineProperty(e,"__esModule",{value:!0});var r=i(23),s=i(24),o=i(10),c=i(6),l=i(11),u=i(3),d=i(4),f=i(5),h=i(22),p=i(17),v=function(){function t(e,i,n,r,o){a(this,t),this.width=e,this.height=i,this.dispatch=n,this.live=r,this.translate=new s.Translate(o)}return n(t,[{key:"init",value:function(){u.defaults.width=this.width,u.defaults.height=this.height;var t=new f.State(this.dispatch),e=new r.ServiceUriResolver(this.live,this.dispatch);new d.Scales,new l.Spider(d3.selectAll("#viz"),this.dispatch,t,this.translate),new c.FilterBar("#filterBar",this.dispatch,t),new h.PathSetBuilder(this.dispatch),new o.DataService(e,this.dispatch),new p.PopOver(d3.select("body"),this.dispatch,this.translate)}}]),t}();e.Application=v},function(t,e){"use strict";e["default"]=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},e.__esModule=!0},function(t,e,i){"use strict";var n=i(25)["default"];e["default"]=function(){function t(t,e){for(var i=0;i<e.length;i++){var a=e[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),n(t,a.key,a)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),e.__esModule=!0},function(t,e,i){"use strict";var n=i(2)["default"],a=i(1)["default"];Object.defineProperty(e,"__esModule",{value:!0});var r={colorRange:["#da3b1f","#ec9d8d","#90b67d","#698e57"],noDetailsColor:"#969696",dimColor:"#F7F7F7",selectedColor:"#3FAED9",maxEntryPathWidth:250,minEntryPathWidth:15,minLineStroke:5,maxLineStroke:25,minLineHeight:5,maxLineHeight:15,minRadius:3,maxRadius:12,midPadding:115,rightPadding:20,topPadding:15,width:900,height:600,domainStartRange:15,domainPadding:12,maxIncomingNodes:8,mouseOverDelay:500,dimmedLabelOpacity:.55,nodeColors:["#da3b1f","#ec9d8d","#90b67d","#698e57"],clipLenghts:[50,25,10,10,5],clipLenghtsTresholds:[1,3,6,8,11],topPaddings:[300,200,150,100,15],topPaddingThresholds:[2,3,4,6,30]},s={efficiencyFormat:d3.format(".2f"),valueFormat:function(t){return t>100?o(t):d3.round(t,2)}},o=d3.format(".2s"),c=function(){function t(){a(this,t)}return n(t,null,[{key:"getDomainEndRange",value:function(){return r.width/2-1.25*r.midPadding+r.domainPadding}},{key:"getRightBoundary",value:function(){return r.width/2+r.midPadding+r.rightPadding}},{key:"getVerticalRange",value:function(t){return t||(t=r.topPadding),[t,r.height-t]}}]),t}();e.defaults=r,e.metricsFormat=s,e.Config=c},function(t,e,i){"use strict";var n=i(2)["default"],a=i(1)["default"];Object.defineProperty(e,"__esModule",{value:!0});var r=i(3),s=(i(7),null),o=function(){function t(e){if(a(this,t),s)return s;this.clipLengthScale=d3.scale.threshold().domain(r.defaults.clipLenghtsTresholds).range(r.defaults.clipLenghts),this.topPaddingScale=d3.scale.threshold().domain(r.defaults.topPaddingThresholds).range(r.defaults.topPaddings),this.inTopPadding=r.defaults.topPadding,this.outTopPadding=r.defaults.topPadding,s=this}return n(t,[{key:"init",value:function(t){var e=this,i=t.paths,n=t.getVisiblePaths(),a=n.filter(function(t){return!t.isLanding}),s=d3.merge(n.map(function(t){return t.next})),o=i.map(function(t){return d3.round(t.getEfficiency(),0)}).filter(function(t,e,i){return i.indexOf(t)==e}),c=s.map(function(t){return d3.round(t.getEfficiency(),0)}).filter(function(t,e,i){return i.indexOf(t)==e});o=o.concat(c);var l=d3.min(o),u=d3.max(o),d=d3.mean(o);if(l===u)this.efficiencyScale=function(){return r.defaults.noDetailsColor};else{var f=[l+.001,d,u-.001];this.efficiencyScale=d3.scale.threshold().domain(f).range(r.defaults.nodeColors)}var h=Math.min(0,d3.min(i,function(t){return t.visits})),p=d3.max(i,function(t){return t.visits});this.strokeScale=d3.scale.linear().domain([h,p]).range([r.defaults.minLineStroke,r.defaults.maxLineStroke]);var v=[r.defaults.domainStartRange,r.Config.getDomainEndRange()],g=d3.max(i.map(function(t){return t.previous.length})),y=d3.range(g).reverse();this.inXScale=d3.scale.ordinal().domain(y).rangePoints(v),this.clipLength=this.clipLengthScale(a.length),this.inTopPadding=this.topPaddingScale(a.length),this.outTopPadding=this.topPaddingScale(s.length),1===s.length?this.outYScale=function(){return d3.mean(r.Config.getVerticalRange(e.outTopPadding))}:this.outYScale=d3.scale.linear().domain([0,s.length-1]).range(r.Config.getVerticalRange(this.outTopPadding));var m=[1.001,5,15,30,49.001],x=d3.scale.threshold().domain(m).range(["16px","16px","14px","14px","12px","10px"]);this.outLabelFontSize=x(s.length);var k=[1.001,5,15,29.001],b=d3.scale.threshold().domain(k).range(["16px","16px","14px","12px","10px"]);this.inLabelFontSize=b(a.length),1===a.length?this.inYScale=function(){return d3.mean(r.Config.getVerticalRange(e.inTopPadding))}:this.inYScale=d3.scale.linear().domain([0,a.length-1]).range(r.Config.getVerticalRange(this.inTopPadding));var S=Math.min(0,d3.min(i,function(t){return t.value})),A=d3.max(i,function(t){return t.value});this.nodeRadiusScale=d3.scale.sqrt().domain([S,A]).range([r.defaults.minRadius,r.defaults.maxRadius]);var P=s.length>20?.3:1,L=Math.min(0,d3.min(s,function(t){return t.value})),w=d3.max(s,function(t){return t.value}),M=1.75*P;this.outNodeRadiusScale=d3.scale.sqrt().domain([L,w]).range([r.defaults.minRadius*M,r.defaults.maxRadius*M]);var C=Math.min(0,d3.min(s,function(t){return t.visits})),_=d3.max(s,function(t){return t.visits});this.outStrokeScale=d3.scale.linear().domain([C,_]).range([r.defaults.minLineStroke*P,r.defaults.maxLineStroke*P]),this.exitMarkerScale=d3.scale.linear().domain([0,p]).range([500,500])}}]),t}();e.Scales=o},function(t,e,i){"use strict";var n=i(2)["default"],a=i(1)["default"];Object.defineProperty(e,"__esModule",{value:!0});var r=null,s=function(){function t(e){var i=this;return a(this,t),r?r:(this.selectedPathId=null,e.on("contextchanged.state",function(){return i.selectedPathId=null}),e.on("pathclick.state",function(t){return i.selectedPathId=t.pid}),void(r=this))}return n(t,[{key:"isSelected",value:function(){return null!==this.selectedPathId}},{key:"set",value:function(t){return this.selectedPathId=t}}]),t}();e.State=s},function(t,e,i){"use strict";var n=i(2)["default"],a=i(1)["default"];Object.defineProperty(e,"__esModule",{value:!0});var r=null,s=function(){function t(e,i,n){var s=this;if(a(this,t),r)return r;if(!e)throw"selector required";if(this.el=d3.select(e),this.el.size()<=0)throw"selector cannot be found";this.state=n,this.dispatch=i,this.el.selectAll("input.filter").on("change",function(){s.state.set(null),s.dispatch.filterchanged({take:s.take(),desc:s.desc(),sort:s.sort()})}),this.el.selectAll("input.sort").on("change",function(){s.state.set(null),s.dispatch.filterchanged({take:s.take(),desc:s.desc(),sort:s.value})}),this.dispatch.on("pathclick.filterbar",function(t){s.dispatch.filterchanged({take:s.take(),desc:s.desc(),sort:s.value,path:t.pid})}),this.dispatch.on("reset.filterbar",function(){s.dispatch.filterchanged({take:s.take(),desc:s.desc(),sort:s.value})}),this.dispatch.on("nodata.filterbar",function(){s.disable()}),this.dispatch.on("baddata.filterbar",function(){s.disable()}),this.dispatch.on("dataloaded.filterbar",function(){s.enable()}),r=this}return n(t,[{key:"take",value:function(){return parseInt(this.selectedFilter().attr("data-take"))}},{key:"sort",value:function(){var t=this.el.selectAll("input.sort:checked");if(t.size()<=0)throw"cant resolve sort";return t.attr("value")}},{key:"desc",value:function(){var t=this.selectedFilter();if(t.size()<=0)throw"cant resolve desc";return"true"===t.attr("data-desc")}},{key:"selectedFilter",value:function(){var t=this.el.selectAll("input.filter:checked");if(t.size()<=0)throw"cant resolve selected filter";return t}},{key:"disable",value:function(){this.el.selectAll("input").attr("disabled",!0)}},{key:"enable",value:function(){this.el.selectAll("input").attr("disabled",null)}}]),t}();e.FilterBar=s},function(t,e,i){"use strict";var n=i(2)["default"],a=i(1)["default"];Object.defineProperty(e,"__esModule",{value:!0});var r=i(6),s=i(5),o=function(){function t(e,i,n){a(this,t),this.root=n,this.contextid=e,this.contextname=i,this.uid=Math.random(),this.visits=0,this.value=0,this.exitvalue=0,this.exitcount=0,this.exitpotential=0,this.landingsCount=0,this.landingsValue=0,this.paths=[]}return n(t,[{key:"addPath",value:function(t){var e=!1;if(this.paths.length>0)for(var i=0;i<this.paths.length;i++){var n=this.paths[i];if(n.pid===t.pid){n.merge(t),e=!0;break}}e||this.paths.push(t)}},{key:"efficiency",value:function(){return d3.round(this.value/this.visits,2)}},{key:"exitEfficiency",value:function(){return d3.round(this.exitvalue/this.exitcount,2)}},{key:"getVisiblePaths",value:function(){return t.filter(this.paths)}}],[{key:"filter",value:function(e){var i=new r.FilterBar,n=i.sort(),a=i.desc(),o=i.take(),c=e.slice(),l=new s.State;null!=l.selectedPathId&&(c=c.filter(function(t){return t.pid===l.selectedPathId}));var u=c.sort(function(e,i){return a?d3.descending(t.getSort(e,n),t.getSort(i,n)):d3.ascending(t.getSort(e,n,t.getSort(i,n)))});return u.slice(0,o)}},{key:"getSort",value:function(t,e){return"efficiency"===e?t.getEfficiency():t[e]}}]),t}();e.PathSet=o},function(t,e,i){"use strict";var n=i(2)["default"],a=i(1)["default"];Object.defineProperty(e,"__esModule",{value:!0});var r=i(3),s=function(){function t(){a(this,t)}return n(t,null,[{key:"animate",value:function(t,e,i,n){n||(n=r.metricsFormat.valueFormat),t.transition().delay(300).tween("text",function(t){var a=this,r=e(t),s=i(t),o=d3.interpolateRound(r,s);return function(t){return a.textContent=n(o(t))}})}}]),t}();e.MetricsAnimator=s},function(t,e,i){"use strict";var n=i(2)["default"],a=i(1)["default"];Object.defineProperty(e,"__esModule",{value:!0});var r=i(3),s=null,o=55,c=60,l=o/10,u=5,d=o/4,f=l/2,h=l/10,p=r.defaults.height,v=r.defaults.width,g=l/2,y=v/2-o/2+l+2*g,m=p-2*l-2*g,x=o/2+l,k=x-d+g,b=l*(1.7+.02*(c-o)),S=[{x:v/2+o/2-d+f,y:p/2-c/2},{x:v/2-o/2,y:p/2-c/2},{x:v/2-o/2,y:p/2+c/2},{x:v/2+o/2,y:p/2+c/2},{x:v/2+o/2,y:p/2-c/2+d},{x:v/2+o/2-d+h,y:p/2-c/2}],A=d3.svg.line().x(function(t){return t.x}).y(function(t){return t.y}).interpolate("linear"),P=function(){function t(){return a(this,t),s?s:void(s=this)}return n(t,[{key:"render",value:function(t){t.append("path").attr("d",A(S)).attr("class","frame").attr("opacity",0).transition().duration(1e3).attr("opacity",1);for(var e=d3.scale.linear().domain([0,u]).range([m/2-b,m/2+c-3*b]),i=0;u>i;i++)t.append("rect").attr("x",y).attr("y",e(i)).attr("width",function(){return 0===i?k:x}).attr("height",l).attr("class","innerBar").attr("opacity",0).transition().duration(1e3).attr("opacity",1)}}]),t}();e.Icon=P},function(t,e,i){"use strict";var n=i(2)["default"],a=i(1)["default"];Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(e,i){var n=this;a(this,t),this.uriResolver=e,this.dispatch=i,i.on("contextchanged.dataservice",function(t){n.loadData()})}return n(t,[{key:"getToken",value:function(){var t=d3.selectAll("input[name=__RequestVerificationToken]");return t.size()>0?t.attr("value"):""}},{key:"loadData",value:function(){var t=this;d3.json(this.uriResolver.getUri()).header("X-RequestVerificationToken",this.getToken()).header("X-Requested-With","XMLHttpRequest").get(function(e,i){return t.dataLoaded(e,i)})}},{key:"dataLoaded",value:function(t,e){return t?void this.dispatch.baddata(t):!e||!e.paths||e.paths.length<1?void this.dispatch.nodata():void this.dispatch.dataloaded(e)}}]),t}();e.DataService=r},function(t,e,i){"use strict";var n=i(2)["default"],a=i(1)["default"];Object.defineProperty(e,"__esModule",{value:!0});var r=i(21),s=i(3),o=i(4),c=(i(5),i(6),i(10),i(7),i(9),i(12)),l=i(15),u=i(16),d=i(13),f=i(14),h=new o.Scales,p=(new s.Config,new r.PathGenerator),v="spider",g=0,y=void 0,m=function(){function t(e,i,n,r){var o=this;a(this,t),this.state=n,this.translate=r,this.el=e,this.dispatch=i,this.dispatch.on("dataready",function(t){o.render(t)}),this.dispatch.on("nodata.spider",function(){o.hide()}),this.dispatch.on("baddata.spider",function(){o.hide()}),this.dispatch.on("filterchanged",function(t){o.redraw()}),this.dispatch.on("exitover",function(){o.el.selectAll("path.inPath").attr("stroke",function(t){return t.exitcount>0?s.defaults.selectedColor:h.efficiencyScale(t.getEfficiency())}),o.el.selectAll("circle.inNode").attr("stroke",function(t){return t.exitcount>0?s.defaults.selectedColor:h.efficiencyScale(t.getEfficiency())}),o.el.selectAll("text.incomingLabel").classed("label-active",function(t){return t.exitcount>0}).style("opacity",function(t){return t.exitcount>0?1:0})}),this.dispatch.on("exitout",function(){o.el.selectAll("path.inPath").attr("stroke",function(t){return h.efficiencyScale(t.getEfficiency())}),o.el.selectAll("circle.inNode").attr("stroke",function(t){return h.efficiencyScale(t.getEfficiency())}),o.el.selectAll("text.incomingLabel").classed("label-active",!1).style("opacity",s.defaults.dimmedLabelOpacity)})}return n(t,[{key:"render",value:function(t){this.spiderSelection=this.el.selectAll("#"+v).data([t],function(t){return t.uid}),this.spiderEnter=this.spiderSelection.enter();var e=this.spiderEnter.append("g").attr("id",v);this.spiderSelection.exit().remove(),e.append("g").attr({id:"pathGroups"}),this.inLabels=new d.InLabels(e,this.dispatch);var i=d3.selectAll("#metrics-container").selectAll("div").data([t],function(t){return t.uid}),n=i.enter().append("div").attr("id","metrics");i.exit().remove();var a=new u.MetricsArea(n,this.dispatch,this.state,this.translate);a.render(),this.redraw(t);var r=new c.ExitArea(e,this.dispatch,this.state,this.translate);r.render();var s=new f.Knob(e,this.dispatch,this.state,this.translate);s.render(e);var o=new l.LandingArea(e,this.dispatch,this.translate);o.render()}},{key:"redraw",value:function(t){if(!t){var e=this.el.selectAll("#"+v);if(e.size()<=0)return;t=e.datum()}h.init(t);var i=d3.selectAll("#pathGroups").selectAll("g").data(function(t){return t.getVisiblePaths()},function(t){return t.pid});i.enter().append("g").attr("class","pathGroup"),i.exit().remove();var n=i.data();y=n.map(function(t){return t.isLanding}).indexOf(!0),this.redrawInPaths(i),this.redrawInNodes(i),this.redrawRight(i),this.inLabels.render(y)}},{key:"hide",value:function(){d3.selectAll("#"+v).remove()}},{key:"activateLabels",value:function(t){t.selectAll("text").classed("label-active",!0).style("opacity",1)}},{key:"deActivateLabels",value:function(t){t.selectAll("text").classed("label-active",!1).style("opacity",s.defaults.dimmedLabelOpacity)}},{key:"redrawRight",value:function(t){var e=this,i=t.selectAll(".out").data(function(t){return t.next},function(t){return t.id}),n=i.enter(),a=n.append("g").attr({"class":"out"}).on("mouseover",function(t,i){var n={x:d3.event.clientX,y:d3.event.clientY},a=this;g=setTimeout(function(){var i=d3.select(a.parentNode);i.selectAll("circle.inNode").attr("stroke",s.defaults.selectedColor),i.selectAll("path.inPath").attr("stroke",s.defaults.selectedColor);var r=d3.select(a);r.selectAll("circle").attr("stroke",s.defaults.selectedColor),r.selectAll("path").attr("stroke",s.defaults.selectedColor),e.activateLabels(r),t.coord=n,e.dispatch.pathover(t)},s.defaults.mouseOverDelay)}).on("mouseout",function(t,i){window.clearTimeout(g);var n=d3.select(this.parentNode);n.selectAll("circle").attr("stroke",function(t){return h.efficiencyScale(t.getEfficiency())}),n.selectAll("path").attr("stroke",function(t){return h.efficiencyScale(t.getEfficiency())}),e.deActivateLabels(d3.select(this)),e.dispatch.pathout(t)}),r=a.selectAll("path.outPath").data(function(t){return[t]},function(t){return t.id});r.enter().append("path").attr({"class":"outPath",fill:"none",stroke:function(t){return h.efficiencyScale(t.getEfficiency())},"stroke-width":function(t){return Math.min(h.outStrokeScale(t.visits),h.strokeScale(t.visits))},"stroke-linecap":"round","stroke-opacity":0}),r.transition().duration(1e3).attr({d:function(t,e,i){return p.getOutLine(i)},"stroke-opacity":1});var o=a.selectAll("circle.outNode").data(function(t){return[t]},function(t){return t.id});o.enter().append("circle").attr({id:function(t){return"circle"+t.id},cx:s.Config.getRightBoundary(),cy:function(t,e,i){return h.outYScale(i)},r:function(t){return Math.min(h.outNodeRadiusScale(t.value),h.nodeRadiusScale(t.value))},stroke:function(t,e){return h.efficiencyScale(t.getEfficiency())},"stroke-width":function(t,e){return Math.min(h.outNodeRadiusScale(t.value)/3,h.nodeRadiusScale(t.value)/3)},"class":"node outNode",opacity:1}).classed("current",function(t){return t.current});var c=(o.transition().duration(1e3).attr({cy:function(t,e,i){return h.outYScale(i)},opacity:1}),a.selectAll("rect.landing-overlay").data(function(t){return[t]},function(t){return t.id})),l=(c.enter().append("rect").attr({x:s.Config.getRightBoundary()+20,y:function(t,e,i){return h.outYScale(i)-10},width:100,height:h.outLabelFontSize,"class":"landing-overlay"}),a.selectAll("text.outgoingLabel").data(function(t){return[t]},function(t){return t.id}));l.enter().append("text").text(function(t){return t.name?t.name.length>30?t.name.substring(0,30)+"...":t.name:"n/a"}).attr({id:function(t){return"label"+t.id},"class":"outgoingLabel nodeLabel",transform:function(t,e,i){var n=s.Config.getRightBoundary()+20,a=h.outYScale(i)+3;return"translate("+n+","+a+")"}}).style({opacity:s.defaults.dimmedLabelOpacity,"font-size":h.outLabelFontSize});l.transition().duration(1e3).attr({transform:function(t,e,i){var n=s.Config.getRightBoundary()+20,a=h.outYScale(i)+3;return"translate("+n+","+a+")"}}).style({opacity:s.defaults.dimmedLabelOpacity,"font-size":h.outLabelFontSize})}},{key:"redrawInPaths",value:function(t){var e=this,i=t.selectAll(".inPath").data(function(t){return t.isLanding?[]:[t]},function(t){return t.pid});i.enter().append("path").attr({"class":"inPath",fill:"none",stroke:function(t){return h.efficiencyScale(t.getEfficiency())},"stroke-width":function(t){return h.strokeScale(t.visits)},"stroke-linecap":"round","stroke-opacity":0}),i.transition().duration(1e3).attr({d:function(t,e,i){var n=i;return y>=0&&n>y&&n--,p.getInLine(n,t.getPreviousNodes().length)},"stroke-opacity":1}),i.on("mouseover",function(t,i){var n=this;g=setTimeout(function(){var i=d3.select(n.parentNode);i.selectAll("circle").attr("stroke",s.defaults.selectedColor),i.selectAll("path").attr("stroke",s.defaults.selectedColor),e.activateLabels(i),e.dispatch.pathover(t)},s.defaults.mouseOverDelay)}).on("mouseout",function(t,i){window.clearTimeout(g);var n=d3.select(this.parentNode);n.selectAll("path").attr("stroke",function(t){return h.efficiencyScale(t.getEfficiency())}),n.selectAll("circle").attr("stroke",function(t){return h.efficiencyScale(t.getEfficiency())}),e.deActivateLabels(n),e.dispatch.pathout(t)}).on("click",function(t,i){if(!e.state.isSelected()){var n=d3.select(this.parentNode);n.selectAll("path").attr("stroke",function(t){return h.efficiencyScale(t.getEfficiency())}),n.selectAll("circle").attr("stroke",function(t){return h.efficiencyScale(t.getEfficiency())}),e.deActivateLabels(n),e.dispatch.pathclick(t)}}),i.exit().transition().duration(2e3).style("stroke-opacity",0).transition().duration(300).remove()}},{key:"redrawInNodes",value:function(t){var e=this,i=t.selectAll(".inNode").data(function(t){return t.previous.sort(function(t,e){return d3.descending(t.index,e.index)})},function(t){return t.id}),n=i.enter().append("circle").attr({cx:function(t,e){return h.inXScale(e)},cy:function(t,e,i){var n=i;return y>=0&&n>y&&n--,h.inYScale(n)},r:function(t){return h.nodeRadiusScale(t.value)},stroke:function(t,e){return h.efficiencyScale(t.getEfficiency())},"stroke-width":function(t,e){return h.nodeRadiusScale(t.value)/3},"class":"node inNode",opacity:0}).classed("current",function(t){return t.current});n.on("mouseover",function(t,i){var n=this,a={x:d3.event.clientX,y:d3.event.clientY};g=setTimeout(function(){var i=d3.select(n.parentNode);i.selectAll("circle").attr("stroke",s.defaults.selectedColor),i.selectAll("path").attr("stroke",s.defaults.selectedColor),e.activateLabels(i),t.coord=a,e.dispatch.pathover(t)},s.defaults.mouseOverDelay)}).on("mouseout",function(t,i){window.clearTimeout(g);var n=d3.select(this.parentNode);n.selectAll("path").attr("stroke",function(t){return h.efficiencyScale(t.getEfficiency())}),n.selectAll("circle").attr("stroke",function(t){return h.efficiencyScale(t.getEfficiency())}),e.deActivateLabels(n),e.dispatch.pathout(t)}).on("click",function(t,i){e.state.isSelected()||e.dispatch.pathclick(t)});i.transition().duration(1e3).attr({cy:function(t,e,i){var n=i;return y>=0&&n>y&&n--,h.inYScale(n)},opacity:1}),i.exit().remove()}}]),t}();e.Spider=m},function(t,e,i){"use strict";var n=i(2)["default"],a=i(1)["default"];Object.defineProperty(e,"__esModule",{value:!0});var r=i(3),s=i(4),o=(i(5),i(8)),c=new s.Scales,l=!1,u=0,d=function(){function t(e,i,n,r){a(this,t),this.selection=e,this.translate=r,this.state=n,this.dispatch=i,this.group=e.append("g").attr("id","exits"),this.setupListeners(i)}return n(t,[{key:"setupListeners",value:function(t){var e=this,i=this;this.group.on("mouseover",function(t,e){if(!i.state.isSelected()){var n=this;u=setTimeout(function(){d3.select(n).selectAll("#exitMarker").attr("fill",r.defaults.selectedColor),i.dispatch.exitover()},r.defaults.mouseOverDelay)}}),this.group.on("mouseout",function(t,e){i.state.isSelected()||(window.clearTimeout(u),d3.select(this).selectAll("#exitMarker").attr("fill",function(t){return c.efficiencyScale(t.exitEfficiency())}),i.dispatch.exitout())}),t.on("pathover.exitarea",function(t){i.state.isSelected()||t.next!==!0&&(l=!0,t.exitcount>0&&d3.selectAll("#exitMarker").attr("fill",r.defaults.selectedColor),o.MetricsAnimator.animate(d3.selectAll("#exitCount"),function(t){return t.exitcount},function(){return t.exitcount}),o.MetricsAnimator.animate(d3.selectAll("#exitPotential"),function(t){return t.exitpotential},function(){return t.exitpotential}))}),t.on("pathclick.exitarea",function(t){t.next!==!0&&(l=!1,d3.selectAll("#exitMarker").attr({fill:function(t){return c.efficiencyScale(t.exitEfficiency())}}).transition().duration(1e3).attr({opacity:t.exitcount<=0?0:1}),o.MetricsAnimator.animate(d3.selectAll("#exitCount"),function(t){return t.exitcount},function(){return t.exitcount}),o.MetricsAnimator.animate(d3.selectAll("#exitPotential"),function(t){return t.exitpotential},function(){return t.exitpotential}))}),t.on("pathout.exitarea",function(t){i.state.isSelected()||l&&(o.MetricsAnimator.animate(d3.selectAll("#exitCount"),function(){return t.exitcount},function(t){return t.exitcount}),o.MetricsAnimator.animate(d3.selectAll("#exitPotential"),function(){return t.exitpotential},function(t){return t.exitpotential}),d3.selectAll("#exitMarker").attr("fill",function(t){return c.efficiencyScale(t.exitEfficiency())}),l=!1)}),t.on("reset.exitarea",function(){l=!1,e.group.selectAll("*").remove(),e.render()})}},{key:"render",value:function(){this.renderExitLabel(),this.renderExitMarker()}},{key:"renderExitLabel",value:function(){var t=r.defaults.width/2,e=r.defaults.height/2;e+=130,this.group.append("text").attr({id:"exitCount","class":"metrics-val",x:t,y:e,opacity:0}).text(function(t){return r.metricsFormat.valueFormat(t.exitcount)}).transition().duration(1e3).attr("opacity",1),e+=25,this.group.append("text").attr({id:"exitCountLabel",x:t,y:e,"class":"metrics-lbl",opacity:0}).text(this.translate.get("Exits")).transition().duration(1e3).attr("opacity",1),e+=40,this.group.append("text").attr({id:"exitPotential","class":"metrics-val",x:t,y:e,opacity:0}).text(function(t){return r.metricsFormat.valueFormat(t.exitpotential)}).transition().duration(1e3).attr("opacity",1),e+=25,this.group.append("text").attr({id:"exitPotentialLabel","class":"metrics-lbl",x:t,y:e,opacity:0}).text(this.translate.get("Exit Potential")).transition().duration(1e3).attr("opacity",1)}},{key:"renderExitMarker",value:function(){var t=d3.svg.symbol().type("triangle-down").size(400);this.group.append("path").attr({id:"exitMarker","class":"arrow",d:t,transform:"translate("+r.defaults.width/2+",390)",fill:function(t){return c.efficiencyScale(t.exitEfficiency())},opacity:0}).transition().duration(1e3).attr("opacity",function(t){return t.exitcount>0?1:0})}}]),t}();e.ExitArea=d},function(t,e,i){"use strict";var n=i(2)["default"],a=i(1)["default"];Object.defineProperty(e,"__esModule",{value:!0});var r=i(3),s=i(4),o=new s.Scales,c=(d3.format("0,000"),function(){function t(e,i){a(this,t),this.selection=e,this.group=e.append("g").attr({id:"inLabels"}),this.setupListeners(i)}return n(t,[{key:"setupListeners",value:function(t){var e=this;t.on("pathover.inlabels",function(t){e.group.selectAll("text.incomingLabel").classed("label-active",function(e){return e.pid===t.pid}).style("opacity",function(e){return e.pid===t.pid?1:r.defaults.dimmedLabelOpacity})}),t.on("pathout.inlabels",function(t){e.group.selectAll("text.incomingLabel").classed("label-active",!1).style("opacity",r.defaults.dimmedLabelOpacity)})}},{key:"render",value:function(t){var e=this,i=this.group.selectAll("g.labelGroup").data(function(t){return t.getVisiblePaths()},function(t){return t.pid});i.enter().append("g").attr({"class":"labelGroup"}),i.exit().remove();var n=i.selectAll("text.incomingLabel").data(function(t){return t.previous.sort(function(t,e){return d3.descending(t.index,e.index)})},function(t){return t.index}),a=o.clipLength;n.enter().append("text").attr({id:function(t){return"label"+t.id},"class":"incomingLabel",transform:function(i,n,a){var r=o.inXScale(n)+3,s=a;t>=0&&s>t&&s--;var c=e.getY(s,i);return"translate("+r+","+c+")"}}).text(function(t){return t.name?t.name.length>a?t.name.substring(0,a)+"...":t.name:"n/a"}).style({opacity:0,"font-size":o.inLabelFontSize}),n.transition().duration(1e3).attr({transform:function(i,n,a){var r=o.inXScale(n)+3,s=a;t>=0&&s>t&&s--;var c=e.getY(s,i);return"translate("+r+","+c+") rotate(300)"}}).text(function(t){return t.name?t.name.length>a?t.name.substring(0,a)+"...":t.name:"n/a"}).style({opacity:function(t,e,i){return o.inYScale(i)>50?r.defaults.dimmedLabelOpacity:0},"font-size":o.inLabelFontSize})}},{key:"getY",value:function(t,e){return o.inYScale(t)-o.nodeRadiusScale(e.value)/1.5-o.strokeScale(e.visits)/2}}]),t}());e.InLabels=c},function(t,e,i){"use strict";var n=i(2)["default"],a=i(1)["default"];Object.defineProperty(e,"__esModule",{value:!0});var r=(i(5),i(9)),s=i(3),o=10,c=function(){function t(e,i,n,r){a(this,t),this.selection=e,this.translate=r,this.state=n,this.dispatch=i,this.group=e.append("g").attr("id","knob"),this.setupListeners(i)}return n(t,[{key:"setupListeners",value:function(t){var e=this;t.on("pathclick.knob",function(t){e.group.selectAll("#back-button").transition().duration(1e3).style("opacity",1)})}},{key:"render",value:function(){var t=this;this.group.append("circle").attr({cx:s.defaults.width/2,cy:s.defaults.height/2,r:80,"class":"knob"}),this.group.append("circle").attr("id","back-button").attr("cx",s.defaults.width/2-53).attr("cy",s.defaults.height/2).attr("r",18).attr("class","back").style("opacity","0").on("click",function(e){t.state.set(null),t.dispatch.reset(),d3.select(this).transition().duration(1e3).style("opacity",0)}),this.group.append("text").attr("id","current-page-name").attr("x",s.defaults.width/2).attr("y",s.defaults.height/2-40).text(function(t){var e=t.contextname;return e&&e.length>o?e.substring(0,o)+"...":e}).attr("opacity",0).transition().duration(1e3).attr("opacity",1);var e=new r.Icon;e.render(this.group)}}]),t}();e.Knob=c},function(t,e,i){"use strict";var n=i(2)["default"],a=i(1)["default"];Object.defineProperty(e,"__esModule",{value:!0});var r=i(3),s=i(4),o=i(8),c=new s.Scales,l=!1,u=0,d=function(){function t(e,i,n){a(this,t),this.translate=n,this.selection=e,this.dispatch=i,this.group=this.selection.append("g").attr("id","landings"),this.group.append("rect").attr({x:415,y:140,width:79,height:70,"class":"landing-overlay"}),this.setupListeners()}return n(t,[{key:"setupListeners",value:function(){var t=this;this.group.on("mouseover",function(e,i){var n=this;u=setTimeout(function(){d3.select(n).selectAll("#landingMarker").attr("fill",r.defaults.selectedColor),t.selection.selectAll("path.outPath").attr("stroke",function(t){return t.isLanding?r.defaults.selectedColor:c.efficiencyScale(t.getEfficiency())}),t.selection.selectAll("circle.outNode").attr("stroke",function(t){return t.isLanding?r.defaults.selectedColor:c.efficiencyScale(t.getEfficiency())})},r.defaults.mouseOverDelay)}),this.group.on("mouseout",function(e,i){window.clearTimeout(u),d3.select(this).selectAll("#landingMarker").attr("fill",function(t){return c.efficiencyScale(t.landingsValue/t.landingsCount)}),t.selection.selectAll("path.outPath").attr({stroke:function(t){return c.efficiencyScale(t.getEfficiency())}}),t.selection.selectAll("circle.outNode").attr({stroke:function(t){return c.efficiencyScale(t.getEfficiency())}})}),this.group.on("click",function(t,e){}),this.dispatch.on("pathclick.landingarea",function(e){t.group.selectAll("text").transition().duration(1e3).attr("opacity",0),t.group.selectAll("path").transition().duration(1e3).attr("opacity",0)}),this.dispatch.on("filterchanged.landingarea",function(e){t.group.selectAll("text").transition().duration(1e3).attr("opacity",1),t.group.selectAll("path").transition().duration(1e3).attr("opacity",function(t){return t.landingsCount>0?1:0})}),this.dispatch.on("pathover.landingarea",function(t){t.isLanding&&(l=!0,o.MetricsAnimator.animate(d3.selectAll("#landingCount"),function(t){return t.landingsCount},function(){return t.visits}),d3.selectAll("#landingMarker").attr("fill",r.defaults.selectedColor))}),this.dispatch.on("pathout.landingarea",function(t){l&&(t.isLanding&&(o.MetricsAnimator.animate(d3.selectAll("#landingCount"),function(){return t.visits},function(t){return t.landingsCount}),d3.selectAll("#landingMarker").attr("fill",function(t){return c.efficiencyScale(t.landingsValue/t.landingsCount)})),l=!1)})}},{key:"redraw",value:function(){this.group.selectAll("*").remove(),this.render()}},{key:"render",value:function(){this.renderLandingLabel(),this.renderLandingMarker()}},{key:"renderLandingLabel",value:function(){var t=r.defaults.width/2,e=r.defaults.height/2-150,i=this.group.append("g").attr({id:"arrowGroup","class":"metricsLabelGroup"});i.append("text").attr({id:"landingCount","class":"metrics-val",x:t,y:e,opacity:0}).text(function(t){return r.metricsFormat.valueFormat(t.landingsCount)}).transition().duration(1e3).attr("opacity",1),e+=20,i.append("text").attr({id:"landingCountLabel","class":"metrics-lbl",x:t,y:e,opacity:0}).text(this.translate.get("Landings")).transition().duration(1e3).attr("opacity",1)}},{key:"renderLandingMarker",value:function(){var t=d3.svg.symbol().type("triangle-down").size(400);this.group.append("path").attr({id:"landingMarker","class":"arrow",d:t,transform:"translate("+r.defaults.width/2+",233)",fill:function(t){return c.efficiencyScale(t.landingsValue/t.landingsCount)},opacity:0}).transition().duration(1e3).attr("opacity",function(t){return t.landingsCount>0?1:0})}}]),t}();e.LandingArea=d},function(t,e,i){"use strict";var n=i(2)["default"],a=i(1)["default"];Object.defineProperty(e,"__esModule",{value:!0});var r=i(18),s=(i(5),i(3)),o=i(8),c=!1,l=function(){function t(e,i,n,r){a(this,t),this.container=e,this.translate=r,this.setupListeners(i),this.state=n}return n(t,[{key:"setupListeners",value:function(t){var e=this;t.on("pathclick.metrics",function(t){var i=e.getMetrics(t);o.MetricsAnimator.animate(e.container.selectAll(".currentMetric"),function(t){return t.value},function(t){return i.filter(function(e){return e.id===t.id})[0].value})}),t.on("pathover.metrics",function(t){e.state.isSelected()&&t.next!==!0||!function(){c=!0;var i=e.getMetrics(t);o.MetricsAnimator.animate(e.container.selectAll(".currentMetric"),function(t){
return t.value},function(t){return i.filter(function(e){return e.id===t.id})[0].value})}()}),t.on("nodata.metricsarea",function(){e.hide()}),t.on("reset.metricsarea",function(){var t=e.container.datum(),i=e.getMetrics(t);o.MetricsAnimator.animate(e.container.selectAll(".currentMetric"),function(t){return i.filter(function(e){return e.id===t.id})[0].value},function(t){return t.value}),c=!1}),t.on("baddata.metricsarea",function(){e.hide()}),t.on("filterchanged.metrics",function(t){e.render()}),t.on("pathout.metrics",function(t){if(!e.state.isSelected()||t.next===!0){var i=function(){if(!c)return{v:void 0};var i=e.getMetrics(t);o.MetricsAnimator.animate(e.container.selectAll(".currentMetric"),function(t){return i.filter(function(e){return e.id===t.id})[0].value},function(t){return t.value}),c=!1}();if("object"==typeof i)return i.v}})}},{key:"render",value:function(){var t=this,e=this.container.selectAll("div").data(function(e){return t.getMetrics(e)},function(t){return t.id});e.enter().append("div").attr({id:function(t){return t.id}}).append("span").text(function(t){return t.label}).append("h3").text(function(t){return t.getDisplayValue()}).classed("currentMetric",!0)}},{key:"hide",value:function(){this.container.remove()}},{key:"getMetrics",value:function(t){var e=[];return e.push(new r.Metric("visitsMetric",this.translate.get("Visits"),t.visits,s.metricsFormat.valueFormat)),e.push(new r.Metric("valueMetric",this.translate.get("Value"),t.value,s.metricsFormat.valueFormat)),e.push(new r.Metric("efficiencyMetric",this.translate.get("Value per Visit"),t.value/t.visits,s.metricsFormat.efficiencyFormat)),e}}]),t}();e.MetricsArea=l},function(t,e,i){"use strict";var n=i(2)["default"],a=i(1)["default"];Object.defineProperty(e,"__esModule",{value:!0});var r=(i(3),"tooltip"),s=function(){function t(e,i,n){a(this,t),this.el=e.append("div").attr("class",r).style("opacity",0),this.translate=n,this.setupListeners(i)}return n(t,[{key:"setupListeners",value:function(t){var e=this;t.on("pathover.popover",function(t,i){if(t.coord){e.el.transition().duration(200).style("opacity",.9);var n=e.translate.get("Original Url"),a=e.translate.get("Content Path"),r="<strong>"+t.name+"</strong><br/>"+n+": <code>"+t.url+"</code><br/>"+a+": <code>"+t.contentPath+"</code>";e.el.html(r).style("left",t.coord.x+5+"px").style("top",t.coord.y+5+"px")}}),t.on("pathout.popover",function(t,i){e.el.transition().duration(100).style("opacity",0)})}}]),t}();e.PopOver=s},function(t,e,i){"use strict";var n=i(2)["default"],a=i(1)["default"];Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(e,i,n,r){a(this,t),this.id=e,this.label=i,this.value=n,this.formatter=r}return n(t,[{key:"getDisplayValue",value:function(){return this.formatter(this.value)}}]),t}();e.Metric=r},function(t,e,i){"use strict";var n=i(2)["default"],a=i(1)["default"];Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(e,i,n){a(this,t),this.index=n,this.id=i.id+"_"+e.id,this.pid=i.id,this.name=e.name,this.url=e.url,this.contentPath=e.path,this.visits=i.visits,this.value=i.value,this.exitcount=i.exitcount,this.exitpotential=i.exitpotential}return n(t,[{key:"getEfficiency",value:function(){return d3.round(this.value/this.visits,2)}},{key:"merge",value:function(t){if(!t)throw"node is required";if(t.id!==this.id||t.index!==this.index)throw"node mismatch";this.visits+=t.visits,this.value+=t.value,this.exitcount+=t.exitcount}}]),t}();e.Node=r},function(t,e,i){"use strict";var n=i(2)["default"],a=i(1)["default"];Object.defineProperty(e,"__esModule",{value:!0});var r=(i(3),function(){function t(e,i,n,r,s){a(this,t),this.pid=e,this.visits=i.visits,this.value=i.value,this.exitcount=i.exitcount?i.exitcount:0,this.exitvalue=i.exitvalue?i.exitvalue:0,this.depth=i.depth,this.exitpotential=i.exitpotential,this.previous=n,this.next=r,this.isLanding=s}return n(t,[{key:"getEfficiency",value:function(){return d3.round(this.value/this.visits,2)}},{key:"getPreviousNodes",value:function(){return this.previous.reverse()}},{key:"merge",value:function(t){if(!t)throw"path is required";if(t.pid!==this.pid||t.previous.length!==this.previous.length)throw"paths mismatch";this.visits+=t.visits,this.value+=t.value,this.exitcount+=t.exitcount,this.exitvalue+=t.exitvalue,this.exitpotential+=t.exitpotential,this.mergeNodes(t.next,this.next),this.mergeNodes(t.previous,this.previous)}},{key:"findMatchingNode",value:function(t,e){for(var i=0;i<e.length;i++)if(e[i].id===t)return e[i]}},{key:"mergeNodes",value:function(t,e){for(var i=0;i<t.length;i++){var n=t[i],a=this.findMatchingNode(n.id,e);a?a.merge(n):e.push(n)}}}]),t}());e.Path=r},function(t,e,i){"use strict";var n=i(2)["default"],a=i(1)["default"];Object.defineProperty(e,"__esModule",{value:!0});var r=i(3),s=i(4),o=null,c=d3.svg.line().x(function(t){return t.x}).y(function(t){return t.y}).interpolate("linear"),l=r.defaults.height,u=r.defaults.width,d=new s.Scales,f=function(){function t(e){return a(this,t),o?o:void(o=this)}return n(t,[{key:"getOutLine",value:function(t){var e=d.outYScale,i=e(t),n=[{x:u/2,y:l/2},{x:u/2+r.defaults.midPadding,y:i},{x:r.Config.getRightBoundary(),y:i}];return c(n)}},{key:"getInLine",value:function(t,e){if(0>=e)return null;var i=d.inXScale(e-1);if(!i)throw"start element cannot be null";var n=d.inYScale(t),a=[{x:i,y:n},{x:u/2-r.defaults.midPadding,y:n},{x:u/2,y:l/2}];return c(a)}},{key:"getLandingLine",value:function(){var t=[{x:u/2,y:145},{x:u/2,y:l/2}];return c(t)}}]),t}();e.PathGenerator=f},function(t,e,i){"use strict";var n=i(2)["default"],a=i(1)["default"];Object.defineProperty(e,"__esModule",{value:!0});var r=i(19),s=i(20),o=i(7),c=function(){function t(e){var i=this;a(this,t),e.on("dataloaded.pathsetbuilder",function(t){e.dataready(i.build(t))})}return n(t,[{key:"build",value:function(t){if(!t)return null;for(var e=new r.Node(t.root.id,"root","",t.root.visits,t.root.value,t.root.current,!1),i=new o.PathSet(t.contextid,t.contextname,e),n=0;n<t.paths.length;n++){var a=t.paths[n];a.nodes[a.nodes.length-1].rid===i.contextid?(a.exitcount=a.visits,a.exitvalue=a.value):(a.exitcount=0,a.exitvalue=0),i.exitpotential+=a.exitpotential,i.exitcount+=a.exitcount,i.exitvalue+=a.exitvalue,i.visits+=a.visits,i.value+=a.value;for(var c=-1,l=0;l<a.nodes.length;l++)a.nodes[l].rid===i.contextid&&(c=l);a.depth=c;var u=a.nodes.slice(0,c);u.length>0?a.id=u.map(function(t){return t.id}).join("_"):a.id=t.contextid;var d=0===c;d&&(i.landingsCount+=a.visits,i.landingsValue+=a.value);for(var f=[],h=0;h<u.length;h++){var p=new r.Node(u[h],a,h);p.isLanding=d,f.push(p)}for(var v=[],g=a.nodes.slice(c+1,c+2),y=0;y<g.length;y++){var p=new r.Node(g[y],a,y);p.isLanding=d,v.push(p)}i.addPath(new s.Path(a.id,a,f,v,d))}return i}}]),t}();e.PathSetBuilder=c},function(t,e,i){"use strict";var n=i(2)["default"],a=i(1)["default"];Object.defineProperty(e,"__esModule",{value:!0});var r="/data",s="/sitecore/api/PathAnalyzer/Paths",o=null,c=function(){function t(e,i){var n=this;if(a(this,t),o)return o;this.dispatch=i,this.live=e,this.resourceUri="mid";this.dispatch.on("contextchanged.uriresolver",function(t){n.resourceUri=t}),o=this}return n(t,[{key:"getUri",value:function(){if(this.live){return s+"/"+this.resourceUri}return r+"/"+this.resourceUri+".json"}}]),t}();e.ServiceUriResolver=c},function(t,e,i){"use strict";var n=i(2)["default"],a=i(1)["default"];Object.defineProperty(e,"__esModule",{value:!0});var r=null,s=function(){function t(e){return a(this,t),r?r:(this.dictionary=e,void(r=this))}return n(t,[{key:"get",value:function(t){return this.dictionary?this.dictionary.get(t)||t:t}}]),t}();e.Translate=s},function(t,e,i){"use strict";t.exports={"default":i(26),__esModule:!0}},function(t,e,i){"use strict";var n=i(27);t.exports=function(t,e,i){return n.setDesc(t,e,i)}},function(t,e){"use strict";var i=Object;t.exports={create:i.create,getProto:i.getPrototypeOf,isEnum:{}.propertyIsEnumerable,getDesc:i.getOwnPropertyDescriptor,setDesc:i.defineProperty,setDescs:i.defineProperties,getKeys:i.keys,getNames:i.getOwnPropertyNames,getSymbols:i.getOwnPropertySymbols,each:[].forEach}}])});