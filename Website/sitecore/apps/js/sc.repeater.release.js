(function(a){a.widget("sc.repeater",{options:{enablePaging:true,page:1,pageSize:1,loadMoreHolderSelector:null,scrollHolderSelector:null,template:null,callbackid:null,data:null,sord:"asc",sidx:"",loadTemplate:"<div class='loading'><div>{{if text}}${text}{{/if}}</div><img src='/sitecore/apps/img/sc-spinner16.gif'/></div>"},_create:function(){var b=this,a=this.options;this.element.attr("data-name",this.options.name);a.activeInstance=this.element;a.cloneInstance=this.element.clone();b.settings=this.element.find("input:first");this._composeList();if(a.enablePaging){if(a.loadMoreHolderSelector!=null){b.attachLoadMore();return}b.attachScroll()}},_composeList:function(){this.options.template!=null&&this.options.data!=null&&this.options.activeInstance.prepend(this._template());return null},_template:function(){return a.tmpl(this.options.template,this.options.data)},attachScroll:function(){var b=this,e=this.options;b.options.data.length?(b.options.page=1):(b.options.page=0);b.options.data.length?a.noop():(b.options.data=[]);var c=b.element.parents(".item-shell");if(!c.length)return false;var d=c[0].scrollHeight>c.outerHeight()?c:c.parent(),f=function(){if(b.isNearBottom(d)){var h=a.tmpl(e.loadTemplate,{text:b.options.texts&&b.options.texts.loading?b.options.texts.loading:""}),f=a.tmpl(e.loadTemplate,{text:b.options.texts&&b.options.texts.loading?b.options.texts.loading:""}).clone();!a(this).find(".loading").size()&&a(this).append(f);var g=a(this);b.settings.val((b.options.page+=1)+","+(b.options.pageSize||"")+","+(b.options.sord||"")+","+(b.options.sidx||""));b.element.find("input:hidden").val(b.settings.val());a.netajax(b.element,null,false,b.options.name).done(function(g){if(g!=null){var h=b.serializeData(b.options.data);b.options.data=b.merge(true,b.options.data,g);var i=b.options.cloneInstance.clone();a(".container-group",c).size()?a.noop():a(".item-container",c).html(i.prepend(a.tmpl(b.options.template,b.options.data)).html());a(f).remove();b.serializeData(e.data)==h&&d.off("scroll");c.trigger("onDataLoad")}});return false}return undefined};d.off("scroll").on("scroll",function(){b.timeout?clearTimeout(b.timeout):a.noop();b.timeout=setTimeout(f,50)});return undefined},attachLoadMore:function(){var c=this,b=this.options;a(b.loadMoreHolderSelector).click(function(){a(b.loadMoreHolderSelector).replaceWith(a.tmpl(b.loadTemplate,{text:c.options.texts&&c.options.texts.loading?c.options.texts.loading:""}));a.getJSON(a.sc.location({},b.activeInstance).url+"\\"+b.callbackid+"\\readpage",a.sc.location({page:b.page+=1,sord:b.sord,sidx:b.sidx}).search,function(e){if(e!=null){var f=c.serializeData(b.data);b.data=c.merge(true,b.data,e);var d=b.cloneInstance.clone();d.hide();b.activeInstance.replaceWith(d.prepend(a.tmpl(b.template,b.data)));b.activeInstance=d;d.fadeIn("slow",function(){});a(b.loadMoreHolderSelector).focus();c.serializeData(b.data)==f&&a(b.loadMoreHolderSelector).hide()}});return false})},serializeData:function(b){var d="";if(a.isArray(b))for(var e=0;e<b.length;e++)d+=";"+this.serializeData(b[e]);else for(var c in b)if(a.isArray(b[c]))d+=";"+c+"="+this.serializeData(b[c]);else d+=";"+c+"="+b[c];return d},isNearBottom:function(a){return this.getDocumentHeight(a)-a.scrollTop()-20<=a.height()},getDocumentHeight:function(a){return a[0].scrollHeight},getUrl:function(b){var a=(b||this.element).parents("form").attr("action")||location.href;a=a||window.location.pathname;if(a.indexOf("?")>-1)a=a.substring(0,a.indexOf("?"));return a},merge:function(f,d,c){var e=d;if(a.isArray(c))e=a.merge(d,c);else for(var b in c){e[b]=a.merge(d[b],c[b]);f&&typeof c[b]=="object"&&this.merge(d[b],c[b])}return e},getQs:function(){var c={};if(location.search)for(var d=location.search.substr(1).split("&"),a=0;a<d.length;a++){var b=d[a].split("=");c[b[0]]=b[1]}return c},destroy:function(){return a.Widget.prototype.destroy.call(this)}})})(jQuery);if(typeof Sys!=="undefined"){Sys.Browser.WebKit={};if(navigator.userAgent.indexOf("WebKit/")>-1){Sys.Browser.agent=Sys.Browser.WebKit;Sys.Browser.version=parseFloat(navigator.userAgent.match(/WebKit\/(\d+(\.\d+)?)/)[1]);Sys.Browser.name="WebKit"}Sys.Application.notifyScriptLoaded()}
