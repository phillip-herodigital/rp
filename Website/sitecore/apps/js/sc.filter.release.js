(function(a){a.widget("sc.filterbuilder",{options:{templates:{filter:"<div class='grid-filter'><div class='header'><div class='header-inner'><div class='filter-controls'></div><ul class='filter-type'></ul></div></div></div>",body:"<div class='filter-area'></div>",filterType:"<li class='custom-filter button' data-filter-type='${filterType}'>${title}</li>",select:'<select {{if size}}size="${size}"{{/if}}><option value="-1">{{if none}}${none}{{/if}}</option>{{each options}}{{if optgroup}}<optgroup label="${optgroup}">{{/if}}<option title="${title}" value="${index}" {{if selected}} selected="" {{/if}}>${name}</option>{{if optgroupEnd}}</optgroup>{{/if}}{{/each}}</select>',customFilterList:'<ul class="filter-list custom-filters">{{if none}}<li  value="-1" class="selected"><span>${none}</span>{{/if}}{{each options}}{{if optgroup}}<li class="optgroup"><span>${optgroup}</span></li>{{/if}}<li title="${name}" value="${index}"></a><span>${name}</span><a class="btn-delete" href="#"></li>{{/each}}</ul>',predefinedFilterList:'<ul class="filter-list predefined-filters">{{each options}}{{if optgroup}}<li class="optgroup"><span>${optgroup}</span></li>{{/if}}<li data-value="${index}"><input type="checkbox"/><span>${name}</span><div class="hit-area"></div></li>{{/each}}</ul>'}},_create:function(){this.rules=[];this.value=this.element.find("input:hidden:first");this.element.attr("data-name",this.options.name);this.viewState=-1;var a=this;a._render();a._click();a._initialState()},_render:function(){this.element.closest(".ui-accordion-content").size()&&a(this.element.closest(".ui-accordion-content").children()[0]).is(this.element)?this.element.closest(".portlet").addClass("collapsed-header"):a.noop();if(this.options.filter||this.options.search){this.filter=a(this.options.templates.filter).prependTo(this.element);this.body=a(this.options.templates.body).appendTo(this.filter).hide()}return this},_click:function(){var b=this;b.filter.find("li").each(function(c){a(this).click(function(){b.viewState=b.viewState!=c?(b.viewState=c):(b.viewState=-1);if(b.options.buttonFilters.Enabled)a(this).hasClass("ui-state-active")?a(this).removeClass("ui-state-active"):a(this).addClass("ui-state-active").siblings().removeClass("ui-state-active");!b.initialization?b.value.attr("value",""):a.noop()})})},_load:function(b){var c=this;a.netajax(this.element,"").done(function(a){c.options.prefetch=a;b()});return false},_applyState:function(){},_getState:function(){return false},_initialState:function(){var b=this;b.element.unbind("initstart.filterbuilder").bind("initstart.filterbuilder",function(){b.initialization=true}).unbind("initstop.filterbuilder").bind("initstop.filterbuilder",function(){b.initialization=false});if(this.value.val()&&this.value.val().length>0){b.element.triggerHandler("initstart");b.state=this.value.val().split("¬");if(b.state.length){a.each(b.state,function(a,c){b.state[a]=eval("("+c+")")});b._applyState()}else b.element.triggerHandler("initstop")}},dumpRules:function(c){if(!this.initialization){var a=JSON.stringify(this.rules);a=a=="[]"?"":a;if(this.value.val()!=a){var b=this._getState(c);this.value.val(b&&JSON.stringify(b)!="{}"?JSON.stringify(b)+(a?"¬"+a:a):a);__doPostBack(this.options.name,"change")}}},_onchange:function(d,e,g,c){if(a(d).hasClass("ui-state-active"))return this._hide(d);if(a(this.body).hasClass("open")){var b=this;b.element.closest(".sc-overlay").size()?this.body.css({position:"absolute","z-index":"10"}):a.noop();b.element.trigger("filterbeforeclose");var f=a(b.body).height();a(this.body).animate({opacity:0},c!==undefined?c:300,function(){if(b.viewState==-1){b._hide(d);a(b.body).height(f);a(b.body).html("")}else{a(b.body).html("");b._show(f,e,g,c!==undefined?c:300)}})}else{a(this.body).html("");this._show(0,e,g,c!==undefined?c:300)}return undefined},_hide:function(d,b){var c=this;c.element.closest(".sc-overlay").size()?this.body.css({position:"absolute","z-index":"10"}):a.noop();c.element.trigger("filterbeforeclose");a(this.body).removeClass("open").stop().animate({height:"0px"},b!==undefined?b:300,function(){a(d).removeClass("ui-state-active");a(c.body).css("display","none");c.reset();a(".grid-search").fadeIn(b!==undefined?b:300)})},_show:function(e,f,g,c){var b=this;f.call();var d=a(this.body).css({height:"auto"}).height();b.element.closest(".sc-overlay").size()?this.body.css({position:"absolute","z-index":"10"}):a.noop();a(this.body).css({display:"block",height:e+"px",opacity:0}).animate({opacity:1,height:d+"px"},c!==undefined?c:300,function(){a(b.body).css("height","auto").addClass("open");b.element.closest(".sc-overlay").size()?b.body.css("position","static"):a.noop();g.call()})},reset:function(){this.rules=[];this.dumpRules()},destroy:function(){this.filter.remove();return a.Widget.prototype.destroy.call(this)}})})(jQuery);(function(a){var c=a.sc.filterbuilder.prototype;a.widget("sc.filterbuilder",a.extend({},c,{_date:function(e,d){var c=function(e,b){b=b.input!=null?b.input:b;var f=new Date,c=a.sc.datetime(a(b).datepicker("getDate"));if(d)a(b).parent().attr("data-value",c.date().toUTC().toJSON());else a(b).parent().attr("data-value",c.date().toJSON())},b=a("<div><input type='text'></input></div>");b.find("input").change(function(){c("",this)}).datepicker({buttonImage:"/sitecore/apps/img/arrow-d.png",showOn:"both",buttonImageOnly:true,dateFormat:"yy-mm-dd",currentText:""}).datepicker("setDate",new Date).trigger("change");b.val=function(c){b.find("input").datepicker("setDate",a.sc.parseDatetime(c).toSystemDate()).trigger("change")};return b},_utcDate:function(a){self._date(a,true)},_select:function(b){return a("<select></select>").append(a.tmpl("{{each rules}}<option title='${title}' value='${value}'>${title}</option>{{/each}}",a(this.options.prefetch.filters).filter(function(c,a){return a.name==b})[0]))}}));function b(a){this._d=a||new Date}b.prototype.addSeconds=function(a){this._d=new Date(this._d.getTime()+a*1e3);return this};b.prototype.toSystemDate=function(){return this._d};b.prototype.addMinutes=function(a){this._d=new Date(this._d.getTime()+a*60*1e3);return this};b.prototype.addHours=function(a){this._d=new Date(this._d.getTime()+a*60*60*1e3);return this};b.prototype.addDays=function(a){this._d=new Date(this._d.getTime()+a*24*60*60*1e3);return this};b.prototype.addMonths=function(a){if(a>0)for(var b=0;b<a;++b)this.addDays(this.getDaysInMonth(this._d.getFullYear(),this._d.getMonth()));else for(var c=0;c>a;--c)this.addDays(0-this.getDaysInMonth(this._d.getFullYear(),this._d.getMonth()));return this};b.prototype.getDaysInMonth=function(a,b){return(new Date(b,a,0)).getDate()};b.prototype.addYears=function(a){this.date.setFullYear(this.date.getFullYear()+a);return this};b.prototype.toUTC=function(){this._d=Date.UTC(this._d.getUTCFullYear(),this._d.getUTCMonth(),this._d.getUTCDate(),this._d.getUTCHours(),this._d.getUTCMinutes(),this._d.getUTCSeconds())};b.prototype.toJSON=function(){return this.format(this._d.getFullYear(),4)+this.format(this._d.getMonth()+1,2)+this.format(this._d.getDate(),2)+"T"+this.format(this._d.getHours(),2)+this.format(this._d.getMinutes(),2)+this.format(this._d.getSeconds(),2)};b.prototype.getTimezoneOffset=function(){return this._d.getTimezoneOffset()};b.prototype.date=function(){this._d.setHours(0);this._d.setMinutes(0);this._d.setSeconds(0);return this};b.prototype.format=function(c,b){var a=c.toString();while(a.length<b)a="0"+a;return a};jQuery.extend(a.sc,{datetime:function(a){return new b(a)},parseDatetime:function(c){var b=function(c,b,a){try{return parseInt(c.substring(b,a),10)}catch(d){return 0}},d=a.sc.datetime(new Date(b(c,0,4),b(c,4,6)-1,b(c,6,8),b(c,9,11),b(c,11,13),b(c,13,15)));return d.addHours(-d.getTimezoneOffset()/60)}});a.extend(true,a,{sc:{datetime:function(a){return new b(a)},parseDatetime:function(c){var b=function(c,b,a){try{return parseInt(c.substring(b,a),10)}catch(d){return 0}},d=a.sc.datetime(new Date(b(c,0,4),b(c,4,6)-1,b(c,6,8),b(c,9,11),b(c,11,13),b(c,13,15)));return d.addHours(-d.getTimezoneOffset()/60)}}})})(jQuery);(function(a){var b=a.sc.filterbuilder.prototype;a.widget("sc.filterbuilder",a.extend({},b,{_render:function(){b._render.apply(this,arguments);this.options.search&&this._renderSearch();return this},dumpRules:function(){var c=this.rules||[];this.currentType=="predefined"?(this.search=this.filter.find('.grid-search input[type="text"]').val()):a.noop();if(this.search!=undefined){if(this.search.length==0)this.rules=[];else this.rules=[{name:"*",values:[this.search],op:"search"}];if(c.length>0){for(var e=[],d=0;d<c.length;d++)if((c[d].constructor.toString().indexOf("Object")!=-1||c[d].constructor.toString().indexOf("Array")!=-1)&&c[d].op!="search")e.push(c[d]);else(c[d].constructor.toString().indexOf("Object")==-1||c[d].constructor.toString().indexOf("Array")==-1)&&e.push(c[d]);if(e.length>0)if(this.rules.length>0&&this.search.length!=0)this.rules.push("and",e);else this.rules=e}}b.dumpRules.apply(this,arguments)},_applyState:function(){var c=this,d;if(this.currentType!="custom"){d=c.state.length>1?c.state[1]:c.state[0];a.each(d,function(){if(this.name&&this.name==="*"){c.filter.find('.grid-search input[type="text"]').val(this.values[0]);c.options.lastSearchPattern=this.values[0]}})}c.state[0].custom===undefined&&c.state[0].predefined===undefined?this.element.triggerHandler("initstop"):a.noop();b._applyState.apply(this,arguments)},_renderSearch:function(){var b=this,c=this.options;if(b.filter!=null){b.searchColumns=[];a(c.colModel).each(function(){if(this.searchable==null)this.searchable=true;else if(this.searchable=="false")this.searchable=false;this.searchable&&b.searchColumns.push(this.index)});b.filter.find(".filter-controls").prepend("<div class='grid-search'><span></span><input place='"+this.options.texts.searchInList+"' type='text'/><a href='#' class='search-button'><span class='search-icon'></span></a></div>");b.filter.find(".grid-search").append(a("<div class='search-columns'></div>")).find('input[type="text"], .search-button').on("blur keydown click keypress keyup",function(d){var e=a(this);if(this.tagName=="A")e=b.filter.find('.grid-search>input[type="text"]');var f=e.val();if(f!=""){d.stopPropagation();switch(d.type){case"click":if(a(this).closest(".grid-search").hasClass("clear-input")&&this.tagName=="A"){e.attr("value","");b.search=null;b.applyValues();b.dumpRules();if(e.val().length==0)a(this).closest(".grid-search").removeClass("clear-input");else a(this).closest(".grid-search").addClass("clear-input")}break;default:if(e.val().length==0)a(this).closest(".grid-search").removeClass("clear-input");else a(this).closest(".grid-search").addClass("clear-input")}}else{d.stopPropagation();a(this).closest(".grid-search").removeClass("clear-input")}var g=function(){if(d.keyCode==null||d.keyCode==0||d.keyCode=="9"||d.keyCode=="13"){if(d.keyCode=="13"){b.element.closest("form").off("popupdialogclose");e.keypress(function(b){b.which=="13"?b.preventDefault():a.noop()})}if(d.type=="keydown"){b.search=e.val()!=null?e.val():"";b.applyValues();b.dumpRules();c.lastSearchPattern=f}}};d.type=="click"&&a(d.currentTarget).is(b.element.find('.grid-search input[type="text"]'))?a.noop():g();return this.tagName=="A"?false:undefined})}}}))})(jQuery);(function(a){var b=a.sc.filterbuilder.prototype;a.widget("sc.filterbuilder",a.extend({},b,{_render:function(){this.options=a.extend({},this.options,{requestDelay:null});b._render.apply(this,arguments);if(this.options.buttonFilters.Visible){this.addPrefetch();!this.options.buttonFilters.Enabled?this.element.find(".custom-filter").addClass("disabled"):a.noop()}return this},addPrefetch:function(){var b=this,c=this.options;a.tmpl(c.templates.filterType,{title:c.buttonFilters.Text,filterType:"predefined"}).appendTo(b.filter.find("ul.filter-type")).click(function(g,d,e){if(c.buttonFilters.Enabled==true){var f=function(){a(".grid-search").fadeIn(d!==undefined?d:300);b._onchange(this,function(){b.reset();b.renderPrefetch(c.prefetch.filters);b.currentType="predefined"},function(){b.element.trigger("filteropen")},d);e?e():a.noop()};!b.options.prefetch?b._load(function(){f()}):f()}})},renderPrefetch:function(d){var c=this;a(c.body).html("").show();var b=[];a.each(d,function(){this.rules.length?b.push(this):a.noop()});a(b).each(function(a){a<3&&this.rules.length&&c.renderColumn(this,a,-1,a,b)})},getSelectedItemIndex:function(b){for(var c=b.parentNode,a=0;a<c.childNodes.length;a++)if(c.childNodes[a]==b)return a;return-1},applyValues:function(){var c=this.options,b=[];a(".filter-area .column-filter",this.element).each(function(){var f=a("a.ui-combobox-menu-title",this).text(),d=[],e=a(c.prefetch.filters).filter(function(){return this.title==f})[0];a(".filter-list li",this).each(function(f){if(a(":first-child",this).is(":checked")){var c=e.rules[f],b;try{b=eval(c.value)}catch(g){b=(c.value||"").toString()}d.length>0&&d.push("or");d.push({name:e.name,values:a.merge([],a.isArray(b)?b:[b]),op:c.op})}});if(d.length>0){b.length>0&&b.push("and");b.push(d.length>1?d:d[0])}});this.rules=b},_getState:function(){var e=this,c={};if(this.element.find(".filter-area").size()&&this.element.find(".filter-area").hasClass("open"))if(this.currentType=="predefined"){var d=[],g=true;c.predefined=0;e.options.prefetch&&e.options.prefetch.filters?a.each(e.options.prefetch.filters,function(){d.push(1);var b=e.element.find(".filter-area .column-filter .ui-combobox-menu-title:contains("+this.title+")").size()?e.element.find(".filter-area .column-filter .ui-combobox-menu-title:contains("+this.title+")").parents(".column-filter").find(".options li"):false;a.each(this.rules,function(c){if(b)if(a(b[c]).find('input[type="checkbox"]:checked').size()){d.push(1);g=false}else d.push(0);else d.push(0)})}):a.noop();var f=1;!g?a.each(d,function(b,a){f=f<<1;c.predefined=a?c.predefined|f:c.predefined}):(c.predefined=0);return c}return b._getState.apply(this,arguments)},_applyState:function(){b._applyState.apply(this,arguments);var c=this;if(c.state[0].predefined!=undefined){c.state[0].predefined=parseInt(c.state[0].predefined,10);c.filter.find('ul.filter-type *[data-filter-type="predefined"]').trigger("click",[0,function(){var b=0;c.options.prefetch&&c.options.prefetch.filters?a.each(c.options.prefetch.filters,function(){b++;var d=c.element.find(".filter-area .column-filter .ui-combobox-menu-title:contains("+this.title+")").size()?c.element.find(".filter-area .column-filter .ui-combobox-menu-title:contains("+this.title+")").parents(".column-filter").find(".options li"):false;a.each(this.rules,function(e){b++;(c.state[0].predefined&1<<b)==1<<b?a(d[e]).find(".hit-area").trigger("click"):a.noop()})}):a.noop();c.element.triggerHandler("initstop")}])}},renderColumn:function(j,p,e,d,f){var b=this,n=this.options;a(f).each(function(){this.current=false});f[p].current=true;var c=a.tmpl(n.templates.predefinedFilterList,{none:"None",selectedNone:true,size:Math.max(j.rules.length+1,2),options:a.map(j.rules,function(a,b){return{index:b,name:a.title,title:a.title}})}),m=a("<div class='options' />").append(c);c[0].selectedItem=null;c[0].value=-1;a(".hit-area",c).click(function(){b.options.requestDelay&&clearTimeout(b.options.requestDelay);var g=c[0];g.value=this.parentNode.getAttribute("data-value");var e=this.parentNode,f=b.getSelectedItemIndex(e);if(e.selected)if(b.rules[d]&&b.rules[d][f])delete b.rules[d][f];e.selected=e.selected?false:true;e.className=e.selected?"selected":"";a(":checkbox",e).attr("checked",e.selected);b.applyValues();b.dumpRules(true)});var i=b.body.children(),h=a("<div class='column-filter'></div>");if(e>-1&&i.length>e){a(i[e]).find(".filter-combobox").combobox("destroy");a(i[e]).replaceWith(h)}else h.appendTo(b.body);d==2?h.addClass("last"):a.noop();var g=parseInt(b.body.width()/Math.min(f.length,3),10),l=b.body.width()-g*2;g=d==2?l:g;h.append(m).css({width:(d==2?"auto":g)+"px","float":d==2?"none":"left"});var k=a('<div class="filter-combobox"></div>').appendTo(a("<div class='filter-menu'></div>").prependTo(h)),o=a('<div class="menu simple"></div>').menu({data:{items:f}});k.combobox({comboboxTemplate:'<div class="ui-combobox-trigger"><div class="no-top-shadow"></div><div class="trigger-inner"><span class="ui-icon-triangle-1-s ui-icon ui-combobox-icon"></span><a href="#" class="ui-combobox-menu-title">'+j.title+"</a></div></div>",height:72,width:g,closeOnClick:true,popupTemplate:'<div class="ui-widget-content ui-combobox simple"></div>'}).on("show",function(){k.closest(".filter-menu").addClass("open")}).on("hide",function(){k.closest(".filter-menu").removeClass("open")}).combobox("getPopup").on("menuclick",function(i,g){var e=null,c=0;a(f).each(function(a){if(this.name==g.attr("name")){e=this;c=a}});b.renderColumn(e,c,d,d,f)}).combobox("getPopup").append(o);c.width(c.width()+c.width()-c[0].clientWidth);e>-1&&i.length>e&&c.trigger("change")}}))})(jQuery);(function(a){var b=a.sc.filterbuilder.prototype;a.widget("sc.filterbuilder",a.extend({},b,{_render:function(){b._render.apply(this,arguments);this.options.templates=a.extend({},this.options.templates,{filterBuilder:'<div class="filter-builder"><div class="filter-builder-header"><div class="filter-settings"><a href="#" class="button important">${buttonText}</a><div class="filter-criteria-title">${criteriaTitle}</div><div class="save-filter round-corner"><label>${saveLabel}<input type="text" class="filter-name"/></label><input type="submit" value="${buttonText}"></input></div></div><div class="filter-title favourites">${columnTitle}</div></div><div class="column-filter"></div><div class="filter-expressions"><div class="filter-builder-area"></div></div></div>'});this.options.texts.customFilter;return this},_getState:function(){var c={};if(this.element.find(".filter-area").size()&&this.element.find(".filter-area").hasClass("open"))if(this.currentType=="custom"){this.element.find(".filter-list li").each(function(b){a(this).hasClass("selected")?(c.custom=b):a.noop()});return c}return b._getState.apply(this,arguments)},_applyState:function(){b._applyState.apply(this,arguments);var c=this;if(c.state.length>1&&c.state[0].custom!=undefined){var d=c.filter.find('ul.filter-type *[data-filter-type="custom"]');c.filter.find('ul.filter-type *[data-filter-type="custom"]').trigger("click",[0,function(){c.element.find(".filter-list li")[c.state[0].custom]?a(c.element.find(".filter-list li")[c.state[0].custom]).trigger("click"):a.noop();c.element.find(".filter-builder-area").empty();var b=[],d=0;a.each(c.state[1],function(e,f){if(!b[d]){c.renderDefaultExpression();b=c.element.find(".filter-expressions .expressions")}if(typeof f!="string"){c.renderExpression(a(b[d]),this.name,this.op,this.values[0],c.state[1][e+1]);c.state[1][e+1]?a(b[d]).find(".ex-union-operator").css("display","block").parents(".expressions").find(".ex-add").css("display","none"):a(b[d]).find(".ex-add").css("display","block").parents(".expressions").find(".ex-union-operator").css("display","none");d++}});c.element.triggerHandler("initstop")}])}},addBuilder:function(){var b=this,c=this.options;a.tmpl(c.templates.filterType,{title:this.options.texts.customizeFilters,filterType:"custom"}).appendTo(b.filter.find("ul.filter-type")).click(function(f,c,d){var e=function(){a(".grid-search").fadeOut(c!==undefined?c:300).find('input[type="text"]:first').val("");b._onchange(this,function(){b.reset();b.renderBuilder();b.currentType="custom"},function(){b.element.trigger("filteropen")},c!==undefined?c:300);d?d():a.noop()};!b.options.prefetch?b._load(function(){e()}):e()})},renderBuilder:function(){var b=this,d=this.options;if(d.prefetch==null){b._load(function(){b.renderBuilder()});return}var c=a.tmpl(d.templates.filterBuilder,{buttonText:this.options.texts.saveFilter,saveLabel:b.options.texts&&b.options.texts.enterTheFilterName?b.options.texts.enterTheFilterName:"",columnTitle:this.options.texts.savedFilters,criteriaTitle:b.options.texts&&b.options.texts.filterCriteria?b.options.texts.filterCriteria:""}).appendTo(b.body);c.find(".filter-expressions");var e=a("<div class='options'></div>");c.find(".column-filter").append(e);b.renderDefaultExpression();b.re_loadCustom();b.saveCustom();b._bind()},_bind:function(){var b=this,c=this.element.find(".save-filter").parent().find("a:first");c.click(function(f){var d=b.body.find(".options>ul")[0].value,e=d=="-1"?b.options.texts&&b.options.texts.customFilter?b.options.texts.customFilter:""+(b.options.prefetch.custom.length+1):d;a.confirm({context:c,url:"/sitecore/apps/popupprompt.aspx",type:"inline",title:b.options.pleaseEnterFilter,inputValue:e,yes:b.options.texts&&b.options.texts.save?b.options.texts.save:"",no:b.options.texts&&b.options.texts.cancel?b.options.texts.cancel:""}).done(function(a){a&&b.doSaveCustom(a.val())});f.stopImmediatePropagation();return false}).on("popupdialogclose",function(b){b.stopImmediatePropagation();a(c).popupdialog("destroy");return false})},doSaveCustom:function(c){var a=this;if(c==null||c=="")c=a.options.texts&&a.options.texts.customFilter?a.options.texts.customFilter+" ":""+(sef.options.prefetch.custom.length+1);var e=a.body.find(".options>ul"),d=0;e.find("li > span").each(function(a){if(this.firstChild.nodeValue==c)d=a});var b=null;if(d>0){b=a.options.prefetch.custom[d-1];if(b.title!=c)b=null}if(b==null){b={};a.options.prefetch.custom.push(b)}b.title=c;b.exps=a.rules;a.postCustom(d,b);a.re_loadCustom(d>0?d:a.options.prefetch.custom.length);return false},saveCustom:function(){var a=this,b=this.options;a.element.find(".filter-settings>a:first").click(function(){a.updateName();return false})},postCustom:function(c,b){a.netajax(this.element,"save:"+c+":"+b.title)},updateName:function(){var b=this,d=this.element.find(".save-filter"),c=d.fadeOut(300).parent().find("a:first");c.click(function(){var d=b.body.find(".options>ul")[0].value,e=d=="-1"?b.options.texts&&b.options.texts.customFilter?b.options.texts.customFilter+" ":""+(b.options.prefetch.custom.length+1):d;a.confirm({context:c,url:"/sitecore/apps/popupprompt.aspx",type:"inline",inputValue:e,yes:b.options.texts&&b.options.texts.save?b.options.texts.save:"",no:b.options.texts&&b.options.texts.cancel?b.options.texts.cancel:""}).done(function(a){a&&b.doSaveCustom(a.val())});return false})},getListSelectedIndex:function(a){if(a)for(var b=0;b<a.parentNode.childNodes.length;b++)if(a.parentNode.childNodes[b]==a)return b;return-1},re_loadCustom:function(e){var f=e||0,b=this,d=this.options,c=a.tmpl(d.templates.customFilterList,{none:b.options.texts&&b.options.texts.none?b.options.texts.none:"None",selectedNone:true,options:a.map(d.prefetch.custom,function(a){return{title:a.title,index:a.title,name:a.title}})}).appendTo(b.body.find(".options").off().html(""));a("li",c).removeClass("selected");c[0].selectedItem=c[0].childNodes[f]||null;c[0].value=c[0].selectedItem?c[0].selectedItem.getAttribute("value"):"-1";c[0].selectedItem.className="selected";a("li > span",c).hover(function(){var a=this.parentNode;this.offsetWidth>a.offsetWidth&&a.setAttribute("title",a.getAttribute("_title"))});a(".btn-delete",c).click(function(){var c=this.parentNode,e=b.getListSelectedIndex(c)-1;a.confirm({context:a(this),type:"inline",yes:b.options.texts&&b.options.texts["delete"]?b.options.texts["delete"]:"",no:b.options.texts&&b.options.texts.cancel?b.options.texts.cancel:"",title:b.options.texts&&b.options.texts.doDelete?b.options.texts.doDelete:""}).done(function(f){if(f=="yes"){a.netajax(b.element,"remove:"+e);d.prefetch.custom.splice(e,1);c.parentNode.removeChild(c);b.re_loadCustom()}});return false}).on("popupdialogclose",function(b){b.stopImmediatePropagation();a(this).popupdialog("destroy");return false});a("li",c).click(function(){var f=this.parentNode;if(this==f.selectedItem)return;if(f.selectedItem)f.selectedItem.className="";this.className="selected";f.selectedItem=this;f.value=this.getAttribute("value");b.body.find(".filter-builder-area").off().html("");var h=b.getListSelectedIndex(this);if(h>0){var c=d.prefetch.custom[h-1].exps;if(c!=null&&c.length>0){var e=0;while(e<c.length){var g=c[e];++e;var i=c.length>e?c[e]:"or";++e;b.renderExpression(a("<div class='expressions'></div>").appendTo(b.body.find(".filter-builder-area")),g.name,g.op,g.values[0],i)}b.body.find(".expressions").trigger("sortupdate")}else b.renderDefaultExpression()}else b.renderDefaultExpression();b.updateName(true);b.applyCustom()})},renderDefaultExpression:function(){this.renderExpression(a("<div class='expressions'></div>").appendTo(this.body.find(".filter-builder-area")))},applyCustom:function(){var b=this,e=this.options;b.rules=[];var d=b.body.find(".expressions"),c=0;d.each(function(){var d=a(this);b.rules.push({name:d.find(".ex-column>select").val(),values:[d.find(".ex-value>[data-value]").attr("data-value")||d.find(".ex-value>input, .ex-value>select").val()]||"",op:d.find(".ex-operator>select").val()});++c;b.rules.push(d.find(".ex-union-operator>a").attr("rel"));++c});b.rules.pop();b.dumpRules()},renderExpression:function(b,e,d,f,g){var c=this,h=this.options;this.renderRemoveExpression(b);this.renderExpressionColumn(b,e);this.renderExpressionOperators(b,d,f,g);b.off().on("blur change",function(){c.applyCustom()});b.parent().off("sortupdate").sortable("destroy").sortable().on("sortupdate",function(){var b=a(this).find(".expressions");b.each(function(c){if(c<b.length-1){a(this).find(".ex-add").hide();a(this).find(".ex-union-operator").show()}else{a(this).find(".ex-add").show();a(this).find(".ex-union-operator").hide()}});c.applyCustom()})},renderExpressionColumn:function(c,d){var e=this,f=this.options,b=[];a(f.prefetch.filters).each(function(){this.index=this.name;this.selected=this.name==d;b.push(this)});e.renderChoice(c,b,d||(b[0]||{index:""}).index,"ex-column").on("change",function(){e.renderExpressionValue(c)})},renderExpressionOperators:function(a,c,d,e){var b=this,f=this.options;this.renderChoice(a,this.options.prefetch.operators,c||(this.options.prefetch.operators[0]||{index:""}).index,"ex-operator").on("change",function(c){if(c.currentTarget.hasClass("ex-operator"))b.renderExpressionValue(a,a.find(".ex-value").val());else b.renderExpressionValue(a)});this.renderExpressionValue(a,d);this.renderUnionOperator(a,e);this.renderAddExpression(a)},renderExpressionValue:function(a,b){var d=this.options,c=a.find(".ex-operator>select")[0].selectedIndex;this.renderChoice(a,null,null,"ex-value",this.getType(a.find(".ex-column>select").val(),b))},getType:function(c,e){var b=a(this.options.prefetch.filters).filter(function(b,a){return a.name==c})[0]||{};b.type=b.type||"input";var d=this["_"+b.type]?this["_"+b.type](c):this._input(c);e&&d.val(e);return d},_input:function(){return a("<input type='text'></input>")},renderUnionOperator:function(d,c){var b=this.options.texts;if(!c)c="or";this.renderChoice(d,null,null,"ex-union-operator",a('<a href="#" rel="'+c+'">'+(c=="or"?b.or:b.and)+"</a>").click(function(d){var c=a(this);if(c.attr("rel")=="or")c.text(b&&b.and?b.and:"").attr("rel","and");else c.text(b&&b.or?b.or:"").attr("rel","or");a(this).trigger("change",[d,this]);return false})).hide()},renderAddExpression:function(b){var c=this;this.renderChoice(b,null,null,"ex-add",a('<span class="ui-icon ui-icon-plus"></span>').hover(function(){a(this).parent().addClass("ui-state-hover")},function(){a(this).parent().removeClass("ui-state-hover")})).click(function(){b.find(".ex-remove").css("visibility","visible");b.find(".ex-add").hide();b.find(".ex-union-operator").show();c.renderDefaultExpression();return false});c.element.trigger("addexpression")},renderRemoveExpression:function(b){var c=this;this.renderChoice(b,null,null,"ex-remove",a('<span class="ui-icon ui-icon-minus"></span>').hover(function(){a(this).parent().addClass("ui-state-hover")},function(){a(this).parent().removeClass("ui-state-hover")})).click(function(){if(b.next().length==0){b.prev().find(".ex-add").show();b.prev().find(".ex-union-operator").hide()}var a=b.parent();b.remove();c.element.trigger("removeexpression");a.find(".ex-remove").length==1&&a.find(".ex-remove").css("visibility","hidden");c.applyCustom();return false});if(b.siblings().length<1)b.find(".ex-remove").css("visibility","hidden");else b.siblings().length==1&&b.siblings().find(".ex-remove").css("visibility","visible")},renderChoice:function(e,b,i,f,g){var j=this,h=this.options,c=e.find("div."+f).off().html("");if(c.length==0)c=a("<div class='"+f+"'></div>").appendTo(e);if(g==null){var d=false;c.append(a.tmpl(h.templates.select,{options:a.map(b,function(a,c){a.selected=a.index==i;if(c==0){d=a.group||false;a.optgroup=d||false}else if(c<b.length-1&&b[c+1].group&&b[c+1].group!=d){a.optgroupEnd=true;d=b[c+1].group;b[c+1].optgroup=d}if(c==b.length-1)a.optgroupEnd=true;return a})}))}else c.append(g);c.find("ex-add").click(function(){a(this).trigger("change")});return c}}))})(jQuery);if(typeof Sys!=="undefined"){Sys.Browser.WebKit={};if(navigator.userAgent.indexOf("WebKit/")>-1){Sys.Browser.agent=Sys.Browser.WebKit;Sys.Browser.version=parseFloat(navigator.userAgent.match(/WebKit\/(\d+(\.\d+)?)/)[1]);Sys.Browser.name="WebKit"}Sys.Application.notifyScriptLoaded()}
