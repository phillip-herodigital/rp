!function(){"use strict";angular.module("unobtrusive.validation",[]).provider("validation",[function(){function a(a){return e[a]}var e={};this.$get=["$injector","$sce",function(e,t){function n(a,e){return a.slice(0,e.length)==e}function r(a){return a.charAt(0).toLowerCase()+a.slice(1)}function i(i,s,u,o){var d=Object.keys(i).sort(),l={};return angular.forEach(d,function(d){if("val"!=d&&"valIf"!=d&&"valRealtime"!=d&&n(d,"val")){var c=!1;if(d.substr(3).charAt(0).toLowerCase()!=d.substr(3).charAt(0)){var f=r(d.substr(3));if(angular.forEach(l,function(a,e){return n(f,e)?(a.parameters[r(f.substr(e.length))]=i[d],void(c=!0)):void 0}),!c){var F=a(f);F?(l[f]={name:f,validate:F.validate,message:t.trustAsHtml(i[d]),parameters:[],injected:{},attributes:i,scope:u,ngModel:o,fail:function(a){s.fail(f,a)},pass:function(){s.pass(f)}},F.inject&&angular.forEach(F.inject,function(a){l[f].injected[a]=e.get(a)})):console.log("WARNING: Unhandled validation attribute: "+f)}}}}),l}var s={ensureValidation:function(a){return a["$$ validation"]=a["$$ validation"]||{cancelSuppress:!1,messages:{},data:{}},a["$$ validation"]},buildValidation:function(a,e,n,r){var u=!0,o=n.name;r.suppressValidationMessages=!0,r.validationMessages={};var d,l={enable:function(){u=!0,l.runValidations(s.dataValue(a,o)),l.populateMessages()},disable:function(){u=!1,r.validationMessages={},angular.forEach(d,function(a,e){l.pass(e)}),l.populateMessages()},populateMessages:function(){r.suppressValidationMessages||s.messageArray(a,o,r.validationMessages)},runValidations:function(e){return s.dataValue(a,o,e),u&&(r.validationMessages={},angular.forEach(d,function(a){a.validate(e,a)?a.pass():a.fail()}),l.populateMessages()),e},cancelSuppress:function(){r.suppressValidationMessages=!1,l.populateMessages()},enableSuppress:function(){r.suppressValidationMessages=!0},fail:function(a,e){u&&(r.$setValidity(a,!1),r.validationMessages[a]=e?t.trustAsHtml(e):d[a].message)},pass:function(a){r.$setValidity(a,!0)},showValidationSummary:!1};return d=i(n,l,a,r),l},messageArray:function(a,e,t){return e?(void 0!==t&&(s.ensureValidation(a).messages[e]=t),s.ensureValidation(a).messages[e]):s.ensureValidation(a).messages},dataValue:function(a,e,t){return e?(void 0!==t&&(s.ensureValidation(a).data[e]=t),s.ensureValidation(a).data[e]):s.ensureValidation(a).data},hasCancelledSuppress:function(a){return s.ensureValidation(a).cancelSuppress},cancelSuppress:function(a){s.ensureValidation(a).cancelSuppress=!0},clearDotNetName:function(a,e){s.ensureValidation(a);delete s.ensureValidation(a).messages[e],delete s.ensureValidation(a).data[e]}};return s}],this.getValidationType=a,this.addValidator=function(a,t,n){e[a]={validate:t,inject:n}}}]).directive("val",["validation",function(a){var e=function(e,t,n,r){if("true"==n.val){var i=n.name,s=a.buildValidation(e,t,n,r);r.$parsers.unshift(s.runValidations),r.$formatters.unshift(s.runValidations);var u=[e.$watch(a.hasCancelledSuppress,function(a){a&&s.cancelSuppress()})];n.valIf?u.push(e.$watch(n.valIf,function(a){a?s.enable():s.disable()})):s.enable(),t.on("$destroy",function(){delete a.clearDotNetName(e,i);for(var t in u)u[t]()}),t.on("blur",function(){s.cancelSuppress(),e.$digest()}),n.hasOwnProperty("valRealtime")?t.on("focus",function(){s.cancelSuppress(),e.$digest()}):t.on("focus",function(){s.enableSuppress()})}};return{restrict:"A",require:"ngModel",link:e}}]).directive("form",["validation",function(a){return{restrict:"E",link:function(e){a.ensureValidation(e)}}}]).directive("valSubmit",["validation",function(a){return{restrict:"A",require:"^?form",link:function(e,t,n,r){t.on("click",function(t){r.$invalid&&(t.preventDefault(),a.showValidationSummary=!0,a.cancelSuppress(e),e.$digest())})}}}]).directive("valmsgSummary",["validation",function(a){return{restrict:"A",scope:{},template:'<div class="alert alert-error" ng-if="started" ng-show="validationSummary.length">   <ul>       <li data-ng-repeat="err in validationSummary" data-ng-bind-html="err"></span>   </ul></div><div class="alert alert-error" ng-transclude ng-if="!started"></div>',transclude:!0,link:function(e,t){e.started=!1,e.validationSummary=[];var n=e.$parent.$watchCollection(a.messageArray,function(n){if(a.showValidationSummary){var r=[],i=n;angular.forEach(i,function(a,t){i.hasOwnProperty(t)&&(e.started=!0,angular.forEach(a,function(a){a&&-1==r.indexOf(a)&&r.push(a)}))}),e.validationSummary=r,e.started&&(r.length?(t.removeClass("validation-summary-valid"),t.addClass("validation-summary-errors")):(t.addClass("validation-summary-valid"),t.removeClass("validation-summary-errors")))}});t.on("$destroy",function(){n()})}}}]).directive("valBindMessages",["validation","$parse","$sce",function(a,e,t){return{restrict:"A",link:function(n,r,i){var s=(e(i.valBindMessages),[n.$watchCollection(i.valBindMessages,function(e){var r=a.ensureValidation(n).messages={};angular.forEach(e,function(a){r[a.memberName]=r[a.memberName]||[],r[a.memberName].push(t.trustAsHtml(a.text))})})]);r.on("$destroy",function(){angular.forEach(s,function(a){a()})})}}}]).directive("valError",["validation",function(a){return{restrict:"A",link:function(e,t,n){var r=e.$watchCollection(function(){return a.messageArray(e,n.valError)},function(a){a&&Object.keys(a).length?t.addClass("error"):t.removeClass("error")});t.on("$destroy",function(){r()})}}}]).directive("valmsgFor",["validation",function(a){return{restrict:"A",scope:{valmsgFor:"@"},template:'<span for="{{valmsgFor}}" data-ng-repeat="err in messages" generated="true" data-ng-bind-html="err"></span><span ng-transclude ng-if="!messages"></span>',transclude:!0,link:function(e,t){e.validationSummary=[];var n=e.$parent.$watchCollection(function(){return a.messageArray(e.$parent,e.valmsgFor)},function(a){e.messages=a,void 0!==a&&(e.started=!0),e.started&&(a&&!Object.keys(a).length?(t.addClass("field-validation-valid"),t.removeClass("field-validation-error")):(t.removeClass("field-validation-valid"),t.addClass("field-validation-error")))});t.on("$destroy",function(){n()})}}}]).config(["validationProvider",function(a){function e(a){return a.substr(0,a.lastIndexOf(".")+1)}function t(a,e){return 0===a.indexOf("*.")&&(a=a.replace("*.",e)),a}a.addValidator("required",function(a){return!!a}),a.addValidator("regex",function(a,e){return!a||new RegExp(e.parameters.pattern).exec(a)}),a.addValidator("email",function(a){return!a||/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+$/.test(a)}),a.addValidator("creditcard",function(a){if(!a)return!0;if(/[^0-9 \-]+/.test(a))return!1;var e,t,n=0,r=0,i=!1;if(a=a.replace(/\D/g,""),a.length<13||a.length>19)return!1;for(e=a.length-1;e>=0;e--)t=a.charAt(e),r=parseInt(t,10),i&&(r*=2)>9&&(r-=9),n+=r,i=!i;return n%10===0}),a.addValidator("date",function(a){return a?!/Invalid|NaN/.test(new Date(a).toString()):!0}),a.addValidator("digits",function(a){return a?/^\d+$/.test(a):!0}),a.addValidator("number",function(a){return a?/^-?(?:\d+|\d{1,3}(?:,\d{3})+)?(?:\.\d+)?$/.test(a):!0}),a.addValidator("url",function(a){return a?/^(https?|s?ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(a):!0}),a.addValidator("minlength",function(a,e){return a?a.length>=parseInt(e.parameters.min):!0}),a.addValidator("maxlength",function(a,e){return a?a.length<=parseInt(e.parameters.max):!0}),a.addValidator("length",function(a,e){return a?(!e.parameters.min||a.length>=parseInt(e.parameters.min))&&(!e.parameters.max||a.length<=parseInt(e.parameters.max)):!0}),a.addValidator("range",function(a,e){if(!a)return!0;var t=parseFloat(a);return t<=parseFloat(e.parameters.max)&&t>=parseFloat(e.parameters.min)}),a.addValidator("password",function(a,e){function t(a,e){var t=a.match(/\W/g);return t&&t.length>=e}return a?!(e.parameters.min&&!(a.length>=e.parameters.min)||e.parameters.nonalphamin&&!t(a,e.parameters.nonalphamin)||e.parameters.regex&&!new RegExp(e.parameters.regex).exec(a)):!0}),a.addValidator("equalto",function(a,n){var r=e(n.attributes.name),i=n.parameters.other,s=t(i,r),u=n.injected.validation.dataValue(n.scope,s);return u==a},["validation"]),a.addValidator("notequalto",function(a,n){var r=e(n.attributes.name),i=n.parameters.other,s=t(i,r),u=n.injected.validation.dataValue(n.scope,s);return u!=a},["validation"]),a.addValidator("extension",function(a,e){if(!a)return!0;var t="string"==typeof e.parameters.extension?e.parameters.extension.replace(/,/g,"|"):"png|jpe?g|gif";return a.match(new RegExp("\\.("+t+")$","i"))}),a.addValidator("remote",function(a,n){if(n.ngModel.remoteTimeout&&n.ngModel.remoteTimeout.resolve(),!a)return!0;var r=e(n.attributes.name),i={};i[n.attributes.name]=a,angular.forEach((n.parameters.additionalfields||"").split(","),function(a){var e=t(a,r);i[e]=n.injected.validation.dataValue(n.scope,e)});var s=n.injected.$q.defer();return n.ngModel.remoteTimeout=s,n.injected.$http({method:n.parameters.type,url:n.parameters.url,data:i,cache:!0,timeout:s.promise,responseType:"json"}).success(function(a){a!==!0&&"true"!==a&&n.fail(a)}),!0},["validation","$http","$q"])}])}();