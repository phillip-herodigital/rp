@{
    var mobileSettings = Sitecore.Context.Database.GetItem("/sitecore/content/Data/Settings/Mobile Enrollment Options");
    var showSprint = !String.IsNullOrEmpty(mobileSettings.Fields["Sprint Buy Phone"].Value) || !String.IsNullOrEmpty(mobileSettings.Fields["Sprint BYOD"].Value);
    var item = Sitecore.Context.Database.GetItem("/sitecore/content/Data/Components/Shared/Coverage Map");
    var dataCalculator = Sitecore.Context.Database.GetItem("/sitecore/content/Data/Components/Marketing/Mobile/Mobile Usage Calculator");
}

<div id="phoneFlowPlans" class="enrollment" ng-show="stepsService.isStepVisible('phoneFlowPlans')" ng-controller="MobileEnrollmentConfigureDataCtrl" ng-init="setTimeRemaining('phoneFlowPlans', '@Html.Sitecore().Field("Remaining Minutes Number")');">
    @Html.Partial("~/Views/Components/Mobile Enrollment/Progress Bar.cshtml", new StreamEnergy.MyStream.Models.MobileEnrollment.ProgressBar { StepNumber = 2, StepTextField = "Step 2 Description Text" })
    @* Two-column layout for Configure Data *@
    <div class="layout plan-selection">
        <div class="wrapper cols-2">
            <section>
                <article class="enrollment__box enrollment__configure-data">
                    <header ng-hide="showChangeLocation">
                        <div >
                            <h1 class="success-message">@Html.Sitecore().Field("Congratulations")</h1>
                            <div compile="deviceResponseMessage"></div>
                            @Html.Sitecore().Field("Eligible Device Message")
                        </div>                    
                    </header>   
                    <div class="content bring-your-own">
                        <div class="plan-error" ng-show="(mobileEnrollment.requestedPlanId != '' && !requestedPlanAvailable && !planSelection.selectedOffers.Mobile && currentMobileLocationInfo().offerInformationByType) || excludedStates">
                            <span ng-show="requestedPlanNetwork == networkType && !excludedStates">@Html.Sitecore().Field("Requested Plan Unavailable")</span>
                            <span ng-show="requestedPlanNetwork != networkType && !excludedStates">@Html.Sitecore().Field("Requested Network Unavailable")</span>
                            <span ng-show="excludedStates">@Html.Sitecore().Field("Location Unavailable")</span>
                        </div>
                        <div class="plan-error" ng-show="zipCodeInvalid">
                            @Html.Sitecore().Field("Invalid Zip Code Message")
                        </div>
                        <div class="item" ng-hide="showChangeLocation">
                            <div class="btn-group-options my-device-container">
                                <i class="icon-my-device"></i>
                                <label class="my-device">@Html.Sitecore().Field("My Device")</label>
                                <div class="edit-remove">
                                    <a href="" ng-click="editDeviceNumber(location, item)">@Html.Sitecore().Field("Edit")</a> | <a href="" ng-click="deleteMobileDevice(location, item)">@Html.Sitecore().Field("Remove")</a>
                                </div>
                                <p class="IMEI">
                                    <span class="heading">@Html.Sitecore().Field("MEID IMEI Number")</span> <span id="DeviceID">{{ phoneOptions.imeiNumber }}</span>
                                </p>
                            </div>
                            <div class="item select-phone-type" ng-show="phoneOptions.showIccid">
                                <hr />
                                <label>
                                    @Html.Sitecore().Field("Select Phone Type")
                                </label>
                                <div class="btn-group btn-group-options">
                                    <a class="button btn-phone-type" ng-model="phoneOptions.phoneOS" ng-click="phoneType='Apple'" btn-radio="'Apple'" data-val="true" data-val-required data-val-if="networkType == 'CDMA' && phoneOptions.showIccid">
                                        <i class="icon-apple"></i>
                                        @Html.Sitecore().Field("Apple")
                                    </a>
                                    <a class="button btn-phone-type" ng-model="phoneOptions.phoneOS" ng-click="phoneType='Android'" btn-radio="'Android'" data-val="true" data-val-required data-val-if="networkType == 'CDMA' && phoneOptions.showIccid">
                                        <i class="icon-android"></i>
                                        @Html.Sitecore().Field("Android")
                                    </a>
                                    <a class="button btn-phone-type" ng-model="phoneOptions.phoneOS" ng-click="phoneType='Other'" btn-radio="'Other'" data-val="true" data-val-required data-val-if="networkType == 'CDMA' && phoneOptions.showIccid">
                                        @Html.Sitecore().Field("Other")
                                    </a>
                                </div>
                            </div>
                            <div class="item verify-your-ICCID" ng-show="phoneOptions.showIccid" ng-class="{ disabled : phoneOptions.showIccid && phoneOptions.phoneOS == null }">
                                <hr />
                                <div class="label-and-description">
                                    <label>
                                        @Html.Sitecore().Field("Header - ICCID Number")
                                    </label>
                                    <p class="label-description">@Html.Sitecore().Field("Text - ICCID Number Note")</p>
                                </div>
                                <div class="btn-group-options iccid" data-val-error="iccid">
                                    <div class="label" ng-class="{ disabled : phoneOptions.missingIccid }">@Html.Sitecore().Field("Label - ICCID Number")</div>
                                    <a class="what-is-this" href="" ng-click="showModal('instructions/iccid')">@Html.Sitecore().Field("What is this Text")</a>
                                    <input type="text" name="iccid" ng-disabled="phoneOptions.missingIccid" ng-model="phoneOptions.iccidNumber" data-val="true" ng-blur="validateIccid()" data-val-required data-val-regex data-val-regex-pattern="^(8901)(120|490)" data-val-if="networkType == 'CDMA' && phoneOptions.showIccid && !phoneOptions.missingIccid" />
                                </div>
                                <div class="clearfix"></div>
                                <div>
                                    <input type="checkbox" ng-model="phoneOptions.missingIccid" /> @Html.Sitecore().Field("I dont have ICCID")
                                    <div class="device-error" ng-show="phoneOptions.missingIccid && phoneOptions.phoneOS != 'Apple'">
                                        @Html.Sitecore().Field("ICC Error Message")
                                    </div>
                                    <div class="device-error" ng-show="iccidInvalid && phoneOptions.phoneOS != 'Apple' && !phoneOptions.missingIccid">
                                        @Html.Sitecore().Field("ICC Invalid Message")
                                    </div>
                                    <div class="device-error" ng-show="iccidInvalid && phoneOptions.phoneOS == 'Apple' && !phoneOptions.missingIccid">
                                        @Html.Sitecore().Field("ICC Invalid Message Apple")
                                    </div>
                                    <div class="missing-iccid" ng-show="phoneOptions.missingIccid  && phoneOptions.phoneOS == 'Apple'">
                                        @Html.Sitecore().Field("ICC Activation Message")
                                    </div>
                                </div>
                            </div>
                            <div class="item phone-number" ng-class="{ disabled : phoneNumberDisabled() }">
                                <hr />
                                <div class="label-and-description">
                                    <label>
                                        @Html.Sitecore().Field("Phone Number")<br />
                                    </label>
                                    <p class="label-description">@Html.Sitecore().Field("Phone Number Description")</p>
                                </div>
                                <div class="btn-group btn-group-options">
                                    <button type="button" class="button btn-phone-number" ng-model="phoneOptions.transferInfo.type" ng-disabled="phoneNumberDisabled()" btn-radio="'new'" data-val="true" data-val-required ng-change="phoneOptions.transferInfo.value = ''">@Html.Sitecore().Field("Assign New Number")</button>
                                    <button type="button" class="button btn-phone-number" ng-model="phoneOptions.transferInfo.type" ng-disabled="phoneNumberDisabled()" btn-radio="'existing'" data-val="true" data-val-required ng-change="phoneOptions.transferInfo.value = ''">@Html.Sitecore().Field("Transfer My Number")</button>
                                </div>
                            </div>
                            <div class="clearfix"></div>
                            <div class="item transfer-number" ng-if="phoneOptions.transferInfo.type == 'existing'">
                                <hr class="content-divider" />
                                <div class="notice alert" ng-if="mobileEnrollmentService.selectedNetwork.value == 'att' && '@Html.Sitecore().Field("Transfer Alert").ToString().Length' != '0'">
                                    @Html.Sitecore().Field("Transfer Alert")
                                </div>
                                <div class="notice alert" ng-if="mobileEnrollmentService.selectedNetwork.value == 'sprint' && '@Html.Sitecore().Field("Transfer Alert CDMA").ToString().Length' != '0'">
                                    @Html.Sitecore().Field("Transfer Alert CDMA")
                                </div>
                                <hr ng-if="(mobileEnrollmentService.selectedNetwork.value == 'att' && '@Html.Sitecore().Field("Transfer Alert").ToString().Length' != '0') || (mobileEnrollmentService.selectedNetwork.value == 'sprint' && '@Html.Sitecore().Field("Transfer Alert CDMA").ToString().Length' != '0')" />
                                <div class="group transfer-header">
                                    @Html.Sitecore().Field("Transfer Header")
                                </div>
                                <div class="group">
                                    <div class="item group-col" data-val-error="TransferInfo.PhoneNumber">
                                        <label>@Html.Sitecore().Field("Label - Enter Existing Number")</label>
                                        <input name="TransferInfo.PhoneNumber" type="text" ng-model="phoneOptions.transferInfo.phoneNumber" data-val="true" data-val-regex data-val-regex-pattern="^\d{3}[^\d]?\d{3}[^\d]?\d{4}$" data-val-if="mobileEnrollment.phoneTypeTab == 'existing' && phoneOptions.transferInfo.type == 'existing'" data-val-required="" />
                                    </div>
                                    <div class="item group-col" data-val-error="TransferInfo.CurrentProvider">
                                        <label>@Html.Sitecore().Field("Label - Previous Service Provider")</label>
                                        <select name="TransferInfo.CurrentProvider" ng-model="phoneOptions.transferInfo.currentProvider" ng-options="provider.name as provider.display for provider in previousServiceProviders" data-val="true" data-val-if="mobileEnrollment.phoneTypeTab == 'existing' && phoneOptions.transferInfo.type == 'existing'" data-val-required></select>
                                    </div>
                                </div>
                                <div class="group">
                                    <div class="item group-col" data-val-error="TransferInfo.AccountNumber">
                                        <label>@Html.Sitecore().Field("Label - Current Account Number")</label>
                                        <input name="TransferInfo.AccountNumber" type="text" ng-model="phoneOptions.transferInfo.accountNumber" data-val="true" data-val-regex data-val-regex-pattern="^\d*$" data-val-if="mobileEnrollment.phoneTypeTab == 'existing' && phoneOptions.transferInfo.type == 'existing'" data-val-required="" />
                                    </div>
                                    <div class="item group-col" data-val-error="TransferInfo.Password">
                                        <label>@Html.Sitecore().Field("Label - Current PIN")</label>
                                        <input name="TransferInfo.Password" type="password" ng-model="phoneOptions.transferInfo.password" data-val="true" data-val-regex data-val-regex-pattern="^.+$" data-val-if="mobileEnrollment.phoneTypeTab == 'existing' && phoneOptions.transferInfo.type == 'existing'" data-val-required="" />
                                        <div class="help-text">@Html.Sitecore().Field("Help - Current PIN")</div>
                                    </div>
                                </div>
                                <div class="group">
                                    <div class="item group-col" data-val-error="TransferInfo.FirstName">
                                        <label>@Html.Sitecore().Field("Label - First Name")</label>
                                        <input name="TransferInfo.FirstName" type="text" ng-model="phoneOptions.transferInfo.firstName" data-val="true" data-val-if="mobileEnrollment.phoneTypeTab == 'existing' && phoneOptions.transferInfo.type == 'existing'" data-val-required="" />
                                        <div class="help-text">@Html.Sitecore().Field("Help - First Name")</div>
                                    </div>
                                    <div class="item group-col" data-val-error="TransferInfo.LastName">
                                        <label>@Html.Sitecore().Field("Label - Last Name")</label>
                                        <input name="TransferInfo.LastName" type="text" ng-model="phoneOptions.transferInfo.lastName" data-val="true" data-val-if="mobileEnrollment.phoneTypeTab == 'existing' && phoneOptions.transferInfo.type == 'existing'" data-val-required="" />
                                        <div class="help-text">@Html.Sitecore().Field("Help - Last Name")</div>
                                    </div>
                                </div>
                                @*<div class="item" data-val-error="TransferInfo.SSN">
                        <label>@Html.Sitecore().Field("Label - Social Security Number")</label>
                        <input name="TransferInfo.SSN" type="text" ng-model="phoneOptions.transferInfo.ssn" data-val="true" data-val-regex data-val-regex-pattern="^\d{3}\D*\d{2}\D*\d{4}$" data-val-if="mobileEnrollment.phoneTypeTab == 'existing' && phoneOptions.transferInfo.type == 'existing'" data-val-required="" />
                    </div>*@
                                <div class="group">
                                    <div class="item street-number" data-val-error="TransferInfo.BillingAddressStreetNumber">
                                        <label>@Html.Sitecore().Field("Label - Street Number")</label>
                                        <input name="TransferInfo.BillingAddressStreetNumber" type="text" ng-model="phoneOptions.transferInfo.billingAddressStreetNumber" data-val="true" data-val-regex data-val-regex-pattern="^\d*$" data-val-if="mobileEnrollment.phoneTypeTab == 'existing' && phoneOptions.transferInfo.type == 'existing'" data-val-required="" />
                                        <div class="help-text">@Html.Sitecore().Field("Help - Street Number")</div>
                                    </div>
                                    <div class="item street-name" data-val-error="TransferInfo.BillingAddressStreetName">
                                        <label>@Html.Sitecore().Field("Label - Street Name")</label>
                                        <input name="TransferInfo.BillingAddressStreetName" type="text" ng-model="phoneOptions.transferInfo.billingAddressStreetName" data-val="true" data-val-if="mobileEnrollment.phoneTypeTab == 'existing' && phoneOptions.transferInfo.type == 'existing'" data-val-required="" />
                                        <div class="help-text">@Html.Sitecore().Field("Help - Street Name")</div>
                                    </div>
                                    <div class="item" data-val-error="TransferInfo.BillingAddressStreetDirection">
                                        <label>@Html.Sitecore().Field("Label - Street Direction")</label>
                                        @Html.Sitecore().Field("Street Direction Select")
                                        <div class="help-text">@Html.Sitecore().Field("Help - Street Direction")</div>
                                    </div>
                                    <div class="item street-line-2" data-val-error="TransferInfo.BillingAddressLine2">
                                        <label>@Html.Sitecore().Field("Label - Address Line 2")</label>
                                        <input name="TransferInfo.BillingAddressLine2" type="text" ng-model="phoneOptions.transferInfo.billingAddressLine2" data-val="true" data-val-if="mobileEnrollment.phoneTypeTab == 'new' && phoneOptions.transferInfo.type == 'existing'" />
                                        <div class="help-text">@Html.Sitecore().Field("Help - Address Line 2")</div>
                                    </div>
                                </div>
                                <div class="group">
                                    <div class="item group-col" data-val-error="TransferInfo.BillingAddressCity">
                                        <label>@Html.Sitecore().Field("Label - City")</label>
                                        <input name="TransferInfo.BillingAddressCity" type="text" ng-model="phoneOptions.transferInfo.billingAddressCity" data-val="true" data-val-if="mobileEnrollment.phoneTypeTab == 'existing' && phoneOptions.transferInfo.type == 'existing'" data-val-required="" />
                                    </div>
                                    <div class="item" data-val-error="TransferInfo.BillingAddressState">
                                        <label>@Html.Sitecore().Field("Label - State")</label>
                                        <select name="TransferInfo.BillingAddressState" ng-model="phoneOptions.transferInfo.billingAddressState" data-val="true" data-val-if="mobileEnrollment.phoneTypeTab == 'existing' && phoneOptions.transferInfo.type == 'existing'" data-val-required="" ng-options="state.abbreviation as state.display for state in usStates">
                                            <option value="">@Html.Sitecore().Field("Text - Please Choose")</option>
                                        </select>
                                    </div>
                                    <div class="item zip-code" data-val-error="TransferInfo.BillingAddressZip">
                                        <label>@Html.Sitecore().Field("Label - Zip")</label>
                                        <input name="TransferInfo.BillingAddressZip" class="small" type="text" ng-model="phoneOptions.transferInfo.billingAddressZip" data-val="true" data-val-regex data-val-regex-pattern="^[0-9]{5}$" data-val-if="mobileEnrollment.phoneTypeTab == 'existing' && phoneOptions.transferInfo.type == 'existing'" data-val-required="" />
                                    </div>
                                </div>
                            </div>
                            <div class="clearfix"></div>
                            <div class="item plan-select" ng-show="currentMobileLocationInfo().offerInformationByType.length > 0 && !excludedStates && !zipCodeInvalid">
                                <hr />
                                <div class="label">
                                    <label>Select Your Rate Plan</label>
                                    <span class="location-text" ng-show="!showChangeLocation">
                                        @Html.Sitecore().Field("It looks like youre in") {{ geoLocation.city }}, {{ geoLocation.state }} {{ geoLocation.postalCode5 }} <a href="" ng-click="showChangeLocation = true">@Html.Sitecore().Field("Change Text")</a>
                                    </span>
                                </div>
                                <div>
                                    <div data-ng-repeat="typedOffers in currentMobileLocationInfo().offerInformationByType" ng-include src="'indPlanList/' + typedOffers.key"></div>
                                </div>
                                <div class="button full" ng-show="!showPlanDetails" ng-click="showPlanDetails = true">
                                    <a>@Html.Sitecore().Field("Show Plan Details")</a>
                                </div>
                                <div class="plan-details" ng-show="showPlanDetails">
                                    <div class="open collapsed">
                                        <div class="box">
                                            <h3>
                                                @Html.Sitecore().Field("Data Plans Header")
                                            </h3>
                                            <ul>
                                                @Html.Sitecore().Field("Individual Plans Details")
                                            </ul>
                                        </div>
                                        <div class="footnotes">
                                            @Html.Sitecore().Field("Footnotes")
                                        </div>
                                    </div>
                                </div>
                                <div class="button full hideDetails" ng-click="showPlanDetails = false" ng-show="showPlanDetails">
                                    <a>@Html.Sitecore().Field("Hide Plan Details")</a>
                                </div>
                            </div>
                            <div class="line-summary clearfix">
                                <div class="not-cost">
                                    <label>Line Summary</label>
                                    <div ng-show="selectedPlan">
                                        <p class="description">Individual Plan + {{selectedPlan.data}}
                                        <span ng-hide="selectedPlan.data == 'Unlimited'">GB</span> Data Plan</p>
                                        <div class="international-calling clearfix">
                                            <p class="includes-international" ng-show="selectedPlan.includesInternational">
                                                <i class="icon-international-phone"></i>
                                                Includes Stream International Plus
                                            </p>
                                        </div>
                                    </div>
                                </div>
                                <div class="monthy-cost">
                                    <p>Monthly Cost</p>
                                    <div ng-show="selectedPlan">
                                        <p class="cost">{{selectedPlan.rates[0].rateAmount | currency}}/mo</p>
                                    </div>
                                </div>
                                <div class="get-international clearfix" ng-show="!selectedPlan.includesInternational">
                                    <i class="icon-international-phone-large"></i>
                                    <div class="text">
                                        <p class="title">Stream International Plus</p>
                                        <p>Unlimited lorem ipsem dolor sit $4.99/mo</p>
                                        <a href="">show details</a>
                                    </div>
                                    <button class="button" ng-click="addInternational()">Add for $4.99/mo</button>
                                </div>
                            </div>
                        </div>
                    </div>
                        <div class="location-section clearfix">
                            <div class="clearfix" ng-show="showChangeLocation">
                                <div class="location-container">
                                    <div class="location-input" >
                                        <form name="lookupZipForm">
                                            <span>@Html.Sitecore().Field("Enter Zip Code Message")</span>
                                            <input type="text" name="zipCode" data-val="true" data-val-regex data-val-regex-pattern="^[0-9]{5}$" data-val-if="showChangeLocation" data-val-required="" class="zip-code" ng-model="postalCode5" ng-keyup="$event.keyCode == 13 && lookupZip()">
                                            <a href="" ng-click="lookupZip()">@Html.Sitecore().Field("Go Text")</a>
                                        </form>
                                    </div>
                                </div>
                                <a href="" class="view-coverage" ng-click="showCoverageMapOverlay()">@Html.Sitecore().Field("View Coverage Text")</a>
                            </div>
                        </div>
                    <footer class="clearfix" ng-hide="showChangeLocation">
                        <a class="back" href="">Back</a>
                        <button class="button" ng-click="completeStep()">Check Out</button>
                        <button class="button add-line" ng-click="addLine()" ng-disabled="addDevice.$invalid">+Add Another Line</button>
                    </footer>
                </article>
            </section>
            <aside>
                <div ng-include src="'cart-template'"></div>
            </aside>
        </div>
    </div>
</div>


<div class="coverage-map-container hidden-map">
    <div class="inner">
        <div class="modal-header">
            <a class="close" onclick="$('.coverage-map-container').addClass('hidden-map')">X</a>
            <h2>&nbsp;</h2>
        </div>

        <script src="//maps.googleapis.com/maps/api/js?libraries=places&sensor=false"></script>
        <div class="wrapper">
            <article class="coverage-map" ng-controller="MobileEnrollmentConfigureDataCtrl">
                <div class="form">
                    <div class="item">
                        <label for="gmap-search-input">@item.Fields["Enter Zip Code"].Value</label>
                        <div id="gmap-search"></div>
                    </div>
                </div>
                <ui-gmap-google-map center="map.center" zoom="map.zoom" options="map.options" events="map.events" control="map.control">
                    <ui-gmap-search-box template="searchbox.template" events="searchbox.events" parentdiv="'gmap-search'"></ui-gmap-search-box>
                </ui-gmap-google-map>
                <ul class="layer-toggle">
                    <li>
                        <input type="checkbox" id="sprint_voice" ng-model="layers.sprint.sprint_voice_roam" /> <label for="sprint_voice">@item.Fields["Voice"].Value</label>
                    </li>
                    <li>
                        <input type="checkbox" id="sprint_data" ng-model="layers.sprint.sprint_data_roam" /> <label for="sprint_data">@item.Fields["Data"].Value</label>
                    </li>
                    <li>
                        <input type="checkbox" id="sprint_lte" ng-model="layers.sprint.sprint_lte" /> <label for="sprint_lte">@item.Fields["LTE"].Value</label>
                    </li>
                </ul>
            </article>
        </div>
    </div>
</div>
<div class="coverage-map-fade"></div>

<div class="data-calculator-container hidden">
    <a class="close" onclick="$('.data-calculator-container').addClass('hidden')" href=""><i class="icon-close"></i></a>
    <div class="inner">
        @Html.Partial("~/Views/Components/Marketing/Mobile/Mobile Usage Calculator.cshtml", new StreamEnergy.MyStream.Models.Marketing.UsageCalculator { IsModal = true, ShowManualCalculator = true, IsJavascriptSubmit = true })
    </div>
    
</div>
<div class="data-calculator-fade"></div>

<script type="text/ng-template" id="indPlanList/Mobile">
    <div class="btn-group btn-group-options mobile-plans">
        <div class="button" ng-class="{selected: selectedPlan.data === plan.data}" ng-click="selectPlan(plan.id)" data-uncheckable ng-repeat="plan in typedOffers.value.availableOffers | filter:filterPlans | orderBy:'sortOrder'" ng-class="{'is-recommended':plan.recommended}">
            <div class="size-speed">
                <div class="size">{{ plan.data }} <span ng-if="plan.data != 'Unlimited'">@Html.Sitecore().Field("GB Text")</span></div>
                <div class="speed">4G LTE DATA</div>
            </div>
            <hr />
            <div class="price">
                <div class="cost">${{plan.rates[0].rateAmount}}</div>
                <div class="duration">@Html.Sitecore().Field("Per Month Text")</div>
            </div>
            <div class="extra-info">
                <div ng-if="plan.includesInternational">
                    <hr />
                    <span>
                        <i class="icon-international-phone"></i>
                        Stream International Plus*
                    </span>
                </div>
            </div>
            <hr />
            <button class="button" ng-hide="selectedPlan.id == plan.id">@Html.Sitecore().Field("Select Text")</button>
            <div ng-show="selectedPlan.id == plan.id" class="check"></div>
        </div>
    </div>
</script>

<script type="text/ng-template" id="indPlanList/TexasElectricity">
</script>
<script type="text/ng-template" id="groupPlanList/TexasElectricity">
</script>
<script type="text/ng-template" id="indPlanList/GeorgiaGas">
</script>
<script type="text/ng-template" id="groupPlanList/GeorgiaGas">
</script>

<script type="text/ng-template" id="searchbox.tpl.html">
    <input type="text" id="gmap-search-input" placeholder="" />
</script>