@model StreamEnergy.DomainModels.Enrollments.UserContext
<div id="utilityFlowService" class="enrollment" ng-show="stepsService.isStepVisible('utilityFlowService')" ng-controller="EnrollmentServiceInformationCtrl" ng-init="setTimeRemaining('utilityFlowService', '@Html.Sitecore().Field("Remaining Minutes Number")');">
    @Html.Partial("~/Views/Components/Enrollment/Progress Bar.cshtml", new StreamEnergy.MyStream.Models.Enrollment.ProgressBar { StepNumber = 1, StepTextField = "Step 1 Description Text", HideCart = true })
    <div class="layout">
        <div class="wrapper cols-2">
            <section>
                <form data-val-bind-messages="validations" ng-submit="completeStep();">
                    <article class="form enrollment__box">
                        <header>
                            @Html.Sitecore().Field("Header Text")
                        </header>
                        <div class="content">
                            <div ng-if="errorMessage" ng-cloak>
                                <div class="notice error" ng-if="data.serviceState == 'TX'">
                                    @Html.Sitecore().Field("Invalid Address Message Text")
                                </div>
                                <div class="notice error" ng-if="data.serviceState == 'GA'">
                                    @Html.Sitecore().Field("GA Invalid Address Message Text")
                                </div>
                                <div class="notice error" ng-if="data.serviceState != 'GA' && data.serviceState != 'TX' && !commercialAddress">
                                    The address you selected is not a valid service address.
                                </div>
                                <div class="notice alert" ng-if="commercialAddress">
                                    For commercial enrollments go somewhere else.
                                </div>
                                <hr class="content-divider" />
                            </div>
                            <div ng-if="isDuplicateAddress(data.serviceLocation.address)" ng-cloak>
                                <div class="notice error">
                                    @Html.Sitecore().Field("Duplicate Address Message Text")
                                </div>
                                <hr class="content-divider" />
                            </div>
                            @Html.Sitecore().Field("Body Text")

                            @using (var currentService = Html.ClientRepeater(m => m.Services, "getActiveServiceIndex()"))
                            {
                                <div class="item full service-address">
                                    <div class="input-group">
                                        <div class="input-group-control" ng-if="data.serviceState === 'GA' || data.serviceState === 'TX'">
                                            <label for="@currentService.IdFor(s => s.Location)" >
                                                <span ng-show="data.serviceState === 'TX'">@Html.Sitecore().Field("TX Address Label")</span><span ng-show="data.serviceState === 'GA'">@Html.Sitecore().Field("GA Address Label")</span>:
                                            </label>
                                            @currentService.TextBoxFor(s => s.Location, new
                                        {
                                            @class = "typeahead state-select-typeahead",
                                            ng_model = "data.serviceLocation",
                                            placeholder = Html.Sitecore().CurrentItem.Fields["Address Placeholder"].Value,
                                            typeahead = "location as location.address|address for location in getLocation(data.serviceState, $viewValue)",
                                            ng_disabled = "data.serviceState == ''",
                                            typeahead_loading = "loadingServiceAddress",
                                            ng_class = "{'loading' : loadingServiceAddress}",
                                            autocomplete = "off"
                                        })
                                        </div>
                                        <div class="input-group-control" ng-if="data.serviceState != 'GA' && data.serviceState != 'TX'">
                                            <label for="@currentService.IdFor(s => s.Location)">
                                                <span>Address:</span>
                                            </label>
                                            @currentService.TextBoxFor(s => s.Location, new
                                       {
                                           @class = "typeahead state-select-typeahead",
                                           ng_model = "typeAheadModel",
                                           placeholder = Html.Sitecore().CurrentItem.Fields["Address Placeholder"].Value,
                                           typeahead = "location as location for location in getLocation(data.serviceState, $viewValue)",
                                           ng_disabled = "data.serviceState == ''",
                                           typeahead_loading = "loadingServiceAddress",
                                           ng_class = "{'loading' : loadingServiceAddress}",
                                           typeahead_on_select = "selectTypeAheadAddress($item)",
                                           autocomplete = "off"
                                       })
                                        </div>
                                        <div class="input-group-btn" id="state-select" dropdown-select dropdown-items="supportedUtilityStates" value="data.serviceState" data-alignment="right"></div>
                                        @currentService.ValidationMessageFor(s => s.Location)
                                    </div>
                                    <div class="input-group" ng-if="showUnitNumber">
                                        <div class="input-group-control" ng-if="data.serviceState != 'GA' && data.serviceState != 'TX'">
                                            <label for="@currentService.IdFor(s => s.Location.Address.UnitNumber)">
                                                <span>Apt or Unit number</span>
                                            </label>
                                            @currentService.TextBoxFor(s => s.Location.Address.UnitNumber, new
                                       {
                                           ng_model = "data.serviceLocation.address.unitNumber",
                                           ng_required = "showUnitNumber",
                                           placeholder = "Apt or Unit number",
                                       })
                                        </div>
                                    </div>
                                </div>
                            }
                            <div class="item warning" ng-if="isCartFull && isNewServiceAddress">
                                @Html.Sitecore().Field("Maximum Addresses Message Text")
                            </div>
                            <hr ng-show="data.serviceState === 'GA' || data.serviceState === 'TX'">
                            <div class="item" ng-show="data.serviceState === 'GA' || data.serviceState === 'TX'">
                                <label>@Html.Sitecore().Field("Options Label") <a href="" tooltip="@Html.Sitecore().Field("Options Tooltip")"><i class="icon-tooltip"></i></a></label>
                                <ul class="checkbox-list">
                                    <li>
                                        <input type="radio" ng-model="data.isNewService" id="switching-providers" ng-value="false">
                                        <label for="switching-providers" class="enroll-options">@Html.Sitecore().Field("Switch Electricity Label")</label>
                                    </li>
                                    <li>
                                        <input type="radio" ng-model="data.isNewService" id="setting-up-new-service" ng-value="true">
                                        <label for="setting-up-new-service" class="enroll-options">@Html.Sitecore().Field("New Service Label")</label>
                                    </li>
                                </ul>
                            </div>
                        </div>
                        <footer>
                            <div class="buttons">
                                <button type="submit" class="primary" ng-disabled="!isFormValid()" data-val-submit>@Html.Sitecore().Field("Continue Button Label")</button>
                            </div>
                        </footer>
                    </article>
                </form>
                <div class="hide-medium-large time-remaining-mobile">
                    <p class="time-remaining">@Html.Sitecore().Field("Time Remaining")</p>
                    <p><a href="">@Html.Sitecore().Field("Completion Info Question")</a></p>
                </div>
            </section>
            <aside>
                <div ng-include ng-if="true" src="'cart-template'"></div>
            </aside>
        </div>
    </div>
</div>
